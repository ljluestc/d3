#d3-formatEvernoticedhowsometimesJavaScriptdoesn’tdisplaynumbersthewayyouexpect?Like,youtriedtoprinttenthswithasimpleloop:```jsfor(leti=0;i<10;++i){console.log(0.1*i);}```Andyougotthis:```00.10.20.300000000000000040.40.50.60000000000000010.70000000000000010.80.9```Welcometo[binaryfloatingpoint](https://en.wikipedia.org/wiki/Double-precision_floating-point_format)!ಠ_ಠYetroundingerrorisnottheonlyreasontocustomizenumberformatting.Atableofnumbersshouldbeformattedconsistentlyforcomparison;above,0.0wouldbebetterthan0.Largenumbersshouldhavegroupeddigits(e.g.,42,000)orbeinscientificormetricnotation(4.2e+4,42k).Currenciesshouldhavefixedprecision($3.50).Reportednumericalresultsshouldberoundedtosignificantdigits(4021becomes4000).Numberformatsshouldappropriatetothereader’slocale(42.000,00or42,000.00).Thelistgoeson.Formattingnumbersforhumanconsumptionisthepurposeofd3-format,whichismodeledafterPython3’s[formatspecificationmini-language](https://docs.python.org/3/library/string.html#format-specification-mini-language)([PEP3101](https://www.python.org/dev/peps/pep-3101/)).Revisitingtheexampleabove:```jsconstf=d3.format(".1f");for(leti=0;i<10;++i){console.log(f(0.1*i));}```Nowyougetthis:```0.00.10.20.30.40.50.60.70.80.9```Butd3-formatismuchmorethananaliasfor[number.toFixed](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toFixed)!Afewmoreexamples:```jsd3.format(".0%")(0.123)//roundedpercentage,"12%"``````jsd3.format("($.2f")(-3.5)//localizedfixed-pointcurrency,"(£3.50)"``````jsd3.format("+20")(42)//space-filledandsigned,"+42"``````jsd3.format(".^20")(42)//dot-filledandcentered,".........42........."``````jsd3.format(".2s")(42e6)//SI-prefixwithtwosignificantdigits,"42M"``````jsd3.format("#x")(48879)//prefixedlowercasehexadecimal,"0xbeef"``````jsd3.format(",.2r")(4223)//groupedthousandswithtwosignificantdigits,"4,200"```See[*locale*.format](#locale_format)foradetailedspecification,andtryrunning[d3.formatSpecifier](#formatSpecifier)ontheaboveformatstodecodetheirmeaning.Alsosee[*number*.toLocaleString](https://observablehq.com/@mbostock/number-formatting).##format(*specifier*){#format}```jsconstf=d3.format(".2f");```[Source](https://github.com/d3/d3-format/blob/main/src/defaultLocale.js)·Analiasfor[*locale*.format](#locale_format)onthe[defaultlocale](#formatDefaultLocale).##formatPrefix(*specifier*,*value*){#formatPrefix}```jsconstf=d3.formatPrefix(",.0",1e-6);```[Source](https://github.com/d3/d3-format/blob/main/src/defaultLocale.js)·Analiasfor[*locale*.formatPrefix](#locale_formatPrefix)onthe[defaultlocale](#formatDefaultLocale).##formatLocale(*definition*){#formatLocale}```jsconstenUs=d3.formatLocale({thousands:",",grouping:[3],currency:["$",""]});```[Source](https://github.com/d3/d3-format/blob/main/src/locale.js)·Returnsa*locale*objectforthespecified*definition*with[*locale*.format](#locale_format)and[*locale*.formatPrefix](#locale_formatPrefix)methods.The*definition*mustincludethefollowingproperties:*`decimal`-thedecimalpoint(e.g.,`"."`).*`thousands`-thegroupseparator(e.g.,`","`).*`grouping`-thearrayofgroupsizes(e.g.,`[3]`),cycledasneeded.*`currency`-thecurrencyprefixandsuffix(e.g.,`["$",""]`).*`numerals`-optional;anarrayoftenstringstoreplacethenumerals0-9.*`percent`-optional;thepercentsign(defaultsto`"%"`).*`minus`-optional;theminussign(defaultsto`"−"`).*`nan`-optional;thenot-a-numbervalue(defaults`"NaN"`).Notethatthe*thousands*propertyisamisnomer,asthegroupingdefinitionallowsgroupsotherthanthousands.##formatDefaultLocale(*definition*){#formatDefaultLocale}```jsconstenUs=d3.formatDefaultLocale({thousands:",",grouping:[3],currency:["$",""]});```[Source](https://github.com/d3/d3-format/blob/main/src/defaultLocale.js)·Equivalentto[d3.formatLocale](#formatLocale),exceptitalsoredefines[d3.format](#format)and[d3.formatPrefix](#formatPrefix)tothenewlocale’s[*locale*.format](#locale_format)and[*locale*.formatPrefix](#locale_formatPrefix).Ifyoudonotsetadefaultlocale,itdefaultsto[U.S.English](https://github.com/d3/d3-format/blob/main/locale/en-US.json).##*locale*.format(*specifier*){#locale_format}```jsconstf=d3.format(".2f");```[Source](https://github.com/d3/d3-format/blob/main/src/locale.js)·Returnsanewformatfunctionforthegivenstring*specifier*.Thereturnedfunctiontakesanumberastheonlyargument,andreturnsastringrepresentingtheformattednumber.Thegeneralformofaspecifieris:```[​[fill]align][sign][symbol][0][width][,][.precision][~][type]```The*fill*canbeanycharacter.Thepresenceofafillcharacterissignaledbythe*align*characterfollowingit,whichmustbeoneofthefollowing:*`>`-Forcesthefieldtoberight-alignedwithintheavailablespace.(Defaultbehavior).*`<`-Forcesthefieldtobeleft-alignedwithintheavailablespace.*`^`-Forcesthefieldtobecenteredwithintheavailablespace.*`=`-like`>`,butwithanysignandsymboltotheleftofanypadding.The*sign*canbe:*`-`-nothingforzeroorpositiveandaminussignfornegative.(Defaultbehavior.)*`+`-aplussignforzeroorpositiveandaminussignfornegative.*`(`-nothingforzeroorpositiveandparenthesesfornegative.*` `(space)-aspaceforzeroorpositiveandaminussignfornegative.The*symbol*canbe:*`$`-applycurrencysymbolsperthelocaledefinition.*`#`-forbinary,octal,orhexadecimalnotation,prefixby`0b`,`0o`,or`0x`,respectively.The*zero*(`0`)optionenableszero-padding;thisimplicitlysets*fill*to`0`and*align*to`=`.The*width*definestheminimumfieldwidth;ifnotspecified,thenthewidthwillbedeterminedbythecontent.The*comma*(`,`)optionenablestheuseofagroupseparator,suchasacommaforthousands.Dependingonthe*type*,the*precision*eitherindicatesthenumberofdigitsthatfollowthedecimalpoint(types`f`and`%`),orthenumberofsignificantdigits(types`​`,`e`,`g`,`r`,`s`and`p`).Iftheprecisionisnotspecified,itdefaultsto6foralltypesexcept`​`(none),whichdefaultsto12.Precisionisignoredforintegerformats(types`b`,`o`,`d`,`x`,and`X`)andcharacterdata(type`c`).See[precisionFixed](#precisionFixed)and[precisionRound](#precisionRound)forhelppickinganappropriateprecision.The`~`optiontrimsinsignificanttrailingzerosacrossallformattypes.Thisismostcommonlyusedinconjunctionwithtypes`r`,`e`,`s`and`%`.Forexample:```jsd3.format("s")(1500)//"1.50000k"``````jsd3.format("~s")(1500)//"1.5k"```Theavailable*type*valuesare:*`e`-exponentnotation.*`f`-fixedpointnotation.*`g`-eitherdecimalorexponentnotation,roundedtosignificantdigits.*`r`-decimalnotation,roundedtosignificantdigits.*`s`-decimalnotationwithan[SIprefix](#locale_formatPrefix),roundedtosignificantdigits.*`%`-multiplyby100,andthendecimalnotationwithapercentsign.*`p`-multiplyby100,roundtosignificantdigits,andthendecimalnotationwithapercentsign.*`b`-binarynotation,roundedtointeger.*`o`-octalnotation,roundedtointeger.*`d`-decimalnotation,roundedtointeger.*`x`-hexadecimalnotation,usinglower-caseletters,roundedtointeger.*`X`-hexadecimalnotation,usingupper-caseletters,roundedtointeger.*`c`-characterdata,forastringoftext.Thetype`​`(none)isalsosupportedasshorthandfor`~g`(withadefaultprecisionof12insteadof6),andthetype`n`isshorthandfor`,g`.Forthe`g`,`n`and`​`(none)types,decimalnotationisusediftheresultingstringwouldhave*precision*orfewerdigits;otherwise,exponentnotationisused.Forexample:```jsd3.format(".2")(42)//"42"``````jsd3.format(".2")(4.2)//"4.2"``````jsd3.format(".1")(42)//"4e+1"``````jsd3.format(".1")(4.2)//"4"```##*locale*.formatPrefix(*specifier*,*value*){#locale_formatPrefix}```jsconstf=d3.formatPrefix(",.0",1e-6);```[Source](https://github.com/d3/d3-format/blob/main/src/locale.js)·Equivalentto[*locale*.format](#locale_format),exceptthereturnedfunctionwillconvertvaluestotheunitsoftheappropriate[SIprefix](https://en.wikipedia.org/wiki/Metric_prefix#List_of_SI_prefixes)forthespecifiednumericreference*value*beforeformattinginfixedpointnotation.Thefollowingprefixesaresupported:*`y`-yocto,10⁻²⁴*`z`-zepto,10⁻²¹*`a`-atto,10⁻¹⁸*`f`-femto,10⁻¹⁵*`p`-pico,10⁻¹²*`n`-nano,10⁻⁹*`µ`-micro,10⁻⁶*`m`-milli,10⁻³*`​`(none)-10⁰*`k`-kilo,10³*`M`-mega,10⁶*`G`-giga,10⁹*`T`-tera,10¹²*`P`-peta,10¹⁵*`E`-exa,10¹⁸*`Z`-zetta,10²¹*`Y`-yotta,10²⁴Unlike[*locale*.format](#locale_format)withthe`s`formattype,thismethodreturnsaformatterwithaconsistentSIprefix,ratherthancomputingtheprefixdynamicallyforeachnumber.Inaddition,the*precision*forthegiven*specifier*representsthenumberofdigitspastthedecimalpoint(aswith`f`fixedpointnotation),notthenumberofsignificantdigits.Forexample:```jsconstf=d3.formatPrefix(",.0",1e-6);f(0.00042);//"420µ"f(0.0042);//"4,200µ"```Thismethodisusefulwhenformattingmultiplenumbersinthesameunitsforeasycomparison.See[precisionPrefix](#precisionPrefix)forhelppickinganappropriateprecision.##formatSpecifier(*specifier*){#formatSpecifier}```jsd3.formatSpecifier(".1f")```[Source](https://github.com/d3/d3-format/blob/main/src/formatSpecifier.js)·Parsesthespecified*specifier*,returninganobjectwithexposedfieldsthatcorrespondtothe[formatspecificationmini-language](#locale_format)andatoStringmethodthatreconstructsthespecifier.Forexample,`formatSpecifier("s")`returns:```jsFormatSpecifier{"fill":"","align":">","sign":"-","symbol":"","zero":false,"width":undefined,"comma":false,"precision":undefined,"trim":false,"type":"s"}```Thismethodisusefulforunderstandinghowformatspecifiersareparsedandforderivingnewspecifiers.Forexample,youmightcomputeanappropriateprecisionbasedonthenumbersyouwanttoformatusing[precisionFixed](#precisionFixed)andthencreateanewformat:```jsconsts=d3.formatSpecifier("f");s.precision=d3.precisionFixed(0.01);constf=d3.format(s);f(42);//"42.00";```##newd3.FormatSpecifier(*specifier*){#FormatSpecifier}```jsnewd3.FormatSpecifier({type:"f",precision:1})```[Source](https://github.com/d3/d3-format/blob/main/src/formatSpecifier.js)·Giventhespecified*specifier*object,returninganobjectwithexposedfieldsthatcorrespondtothe[formatspecificationmini-language](#locale_format)andatoStringmethodthatreconstructsthespecifier.Forexample,`newFormatSpecifier({type:"s"})`returns:```jsFormatSpecifier{"fill":"","align":">","sign":"-","symbol":"","zero":false,"width":undefined,"comma":false,"precision":undefined,"trim":false,"type":"s"}```##precisionFixed(*step*){#precisionFixed}```jsd3.precisionFixed(0.01)//2```[Source](https://github.com/d3/d3-format/blob/main/src/precisionFixed.js)·Returnsasuggesteddecimalprecisionforfixedpointnotationgiventhespecifiednumeric*step*value.The*step*representstheminimumabsolutedifferencebetweenvaluesthatwillbeformatted.(Thisassumesthatthevaluestobeformattedarealsomultiplesof*step*.)Forexample,giventhenumbers1,1.5,and2,the*step*shouldbe0.5andthesuggestedprecisionis1:```jsconstp=d3.precisionFixed(0.5);constf=d3.format("."+p+"f");f(1);//"1.0"f(1.5);//"1.5"f(2);//"2.0"```Whereasforthenumbers1,2and3,the*step*shouldbe1andthesuggestedprecisionis0:```jsconstp=d3.precisionFixed(1);constf=d3.format("."+p+"f");f(1);//"1"f(2);//"2"f(3);//"3"```Note:forthe`%`formattype,subtracttwo:```jsconstp=Math.max(0,d3.precisionFixed(0.05)-2);constf=d3.format("."+p+"%");f(0.45);//"45%"f(0.50);//"50%"f(0.55);//"55%"```##precisionPrefix(*step*,*value*){#precisionPrefix}```jsd3.precisionPrefix(1e5,1.3e6)//1```[Source](https://github.com/d3/d3-format/blob/main/src/precisionPrefix.js)·Returnsasuggesteddecimalprecisionforusewith[*locale*.formatPrefix](#locale_formatPrefix)giventhespecifiednumeric*step*andreference*value*.The*step*representstheminimumabsolutedifferencebetweenvaluesthatwillbeformatted,and*value*determineswhichSIprefixwillbeused.(Thisassumesthatthevaluestobeformattedarealsomultiplesof*step*.)Forexample,giventhenumbers1.1e6,1.2e6,and1.3e6,the*step*shouldbe1e5,the*value*couldbe1.3e6,andthesuggestedprecisionis1:```jsconstp=d3.precisionPrefix(1e5,1.3e6);constf=d3.formatPrefix("."+p,1.3e6);f(1.1e6);//"1.1M"f(1.2e6);//"1.2M"f(1.3e6);//"1.3M"```##precisionRound(*step*,*max*){#precisionRound}```jsd3.precisionRound(0.01,1.01)//3```[Source](https://github.com/d3/d3-format/blob/main/src/precisionRound.js)·Returnsasuggesteddecimalprecisionforformattypesthatroundtosignificantdigitsgiventhespecifiednumeric*step*and*max*values.The*step*representstheminimumabsolutedifferencebetweenvaluesthatwillbeformatted,andthe*max*representsthelargestabsolutevaluethatwillbeformatted.(Thisassumesthatthevaluestobeformattedarealsomultiplesof*step*.)Forexample,giventhenumbers0.99,1.0,and1.01,the*step*shouldbe0.01,the*max*shouldbe1.01,andthesuggestedprecisionis3:```jsconstp=d3.precisionRound(0.01,1.01);constf=d3.format("."+p+"r");f(0.99);//"0.990"f(1.0);//"1.00"f(1.01);//"1.01"```Whereasforthenumbers0.9,1.0,and1.1,the*step*shouldbe0.1,the*max*shouldbe1.1,andthesuggestedprecisionis2:```jsconstp=d3.precisionRound(0.1,1.1);constf=d3.format("."+p+"r");f(0.9);//"0.90"f(1.0);//"1.0"f(1.1);//"1.1"```Note:forthe`e`formattype,subtractone:```jsconstp=Math.max(0,d3.precisionRound(0.01,1.01)-1);constf=d3.format("."+p+"e");f(0.01);//"1.00e-2"f(1.01);//"1.01e+0"```