#ForcesimulationsAforcesimulationimplementsa[velocityVerlet](https://en.wikipedia.org/wiki/Verlet_integration)numericalintegratorforsimulatingphysicalforcesonparticles(nodes).ThesimulationassumesaconstantunittimestepΔ*t*=1foreachstepandaconstantunitmass*m*=1forallparticles.Asaresult,aforce*F*actingonaparticleisequivalenttoaconstantacceleration*a*overthetimeintervalΔ*t*,andcanbesimulatedsimplybyaddingtotheparticle’svelocity,whichisthenaddedtotheparticle’sposition.##forceSimulation(*nodes*){#forceSimulation}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·Createsanewsimulationwiththespecifiedarrayof[*nodes*](#simulation_nodes)andno[forces](#simulation_force).If*nodes*isnotspecified,itdefaultstotheemptyarray.:::warningThisfunctionisimpure;itmutatesthepassed-in*nodes*.See[*simulation*.nodes](#simulation_nodes).:::```jsconstsimulation=d3.forceSimulation(nodes);```Thesimulator[starts](#simulation_restart)automatically;use[*simulation*.on](#simulation_on)tolistenfortickeventsasthesimulationruns.Ifyouwishtorunthesimulationmanuallyinstead,call[*simulation*.stop](#simulation_stop),andthencall[*simulation*.tick](#simulation_tick)asdesired.##*simulation*.restart(){#simulation_restart}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·Restartsthesimulation’sinternaltimerandreturnsthesimulation.Inconjunctionwith[*simulation*.alphaTarget](#simulation_alphaTarget)or[*simulation*.alpha](#simulation_alpha),thismethodcanbeusedto“reheat”thesimulationduringinteraction,suchaswhendragginganode,ortoresumethesimulationaftertemporarilypausingitwith[*simulation*.stop](#simulation_stop).##*simulation*.stop(){#simulation_stop}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·Stopsthesimulation’sinternaltimer,ifitisrunning,andreturnsthesimulation.Ifthetimerisalreadystopped,thismethoddoesnothing.Thismethodisusefulforrunningthesimulationmanually;see[*simulation*.tick](#simulation_tick).##*simulation*.tick(*iterations*){#simulation_tick}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·Manuallystepsthesimulationbythespecifiednumberof*iterations*,andreturnsthesimulation.If*iterations*isnotspecified,itdefaultsto1(singlestep).Foreachiteration,itincrementsthecurrent[*alpha*](#simulation_alpha)by([*alphaTarget*](#simulation_alphaTarget)-*alpha*)×[*alphaDecay*](#simulation_alphaDecay);theninvokeseachregistered[force](#simulation_force),passingthenew*alpha*;thendecrementseach[node](#simulation_nodes)’svelocityby*velocity*×[*velocityDecay*](#simulation_velocityDecay);lastlyincrementseachnode’spositionby*velocity*.Thismethoddoesnotdispatch[events](#simulation_on);eventsareonlydispatchedbytheinternaltimerwhenthesimulationisstartedautomaticallyupon[creation](#forceSimulation)orbycalling[*simulation*.restart](#simulation_restart).Thenaturalnumberoftickswhenthesimulationisstartedis⌈*log*([*alphaMin*](#simulation_alphaMin))/*log*(1-[*alphaDecay*](#simulation_alphaDecay))⌉;bydefault,thisis300.Thismethodcanbeusedinconjunctionwith[*simulation*.stop](#simulation_stop)tocomputea[staticforcelayout](https://observablehq.com/@d3/static-force-directed-graph).Forlargegraphs,staticlayoutsshouldbecomputed[inawebworker](https://observablehq.com/@d3/force-directed-web-worker)toavoidfreezingtheuserinterface.##*simulation*.nodes(*nodes*){#simulation_nodes}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·If*nodes*isspecified,setsthesimulation’snodestothespecifiedarrayofobjects,initializingtheirpositionsandvelocitiesifnecessary,andthen[re-initializes](#force_initialize)anybound[forces](#simulation_force);returnsthesimulation.If*nodes*isnotspecified,returnsthesimulation’sarrayofnodesasspecifiedtothe[constructor](#forceSimulation).:::warningThisfunctionisimpure;itmutatesthepassed-in*nodes*toassigntheindex*node*.index,theposition*node*.x&*node*.y,andthevelocity*node*.vx&*node*.vy.Thepositionandvelocityarefurtherupdatedasthesimulationrunsby[*simulation*.tick](#simulation_tick).:::Each*node*mustbeanobject.Thefollowingpropertiesareassignedbythesimulation:*`index`-thenode’szero-basedindexinto*nodes**`x`-thenode’scurrent*x*-position*`y`-thenode’scurrent*y*-position*`vx`-thenode’scurrent*x*-velocity*`vy`-thenode’scurrent*y*-velocityTheposition⟨*x*,*y*⟩andvelocity⟨*vx*,*vy*⟩maybesubsequentlymodifiedby[forces](#custom-forces)andbythesimulation.Ifeither*vx*or*vy*isNaN,thevelocityisinitializedto⟨0,0⟩.Ifeither*x*or*y*isNaN,thepositionisinitializedina[phyllotaxisarrangement](https://observablehq.com/@d3/force-layout-phyllotaxis),sochosentoensureadeterministic,uniformdistribution.Tofixanodeinagivenposition,youmayspecifytwoadditionalproperties:*`fx`-thenode’sfixed*x*-position*`fy`-thenode’sfixed*y*-positionAttheendofeach[tick](#simulation_tick),aftertheapplicationofanyforces,anodewithadefined*node*.fxhas*node*.xresettothisvalueand*node*.vxsettozero;likewise,anodewithadefined*node*.fyhas*node*.yresettothisvalueand*node*.vysettozero.Tounfixanodethatwaspreviouslyfixed,set*node*.fxand*node*.fytonull,ordeletetheseproperties.Ifthespecifiedarrayof*nodes*ismodified,suchaswhennodesareaddedtoorremovedfromthesimulation,thismethodmustbecalledagainwiththenew(orchanged)arraytonotifythesimulationandboundforcesofthechange;thesimulationdoesnotmakeadefensivecopyofthespecifiedarray.##*simulation*.alpha(*alpha*){#simulation_alpha}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·*alpha*isroughlyanalogoustotemperaturein[simulatedannealing](https://en.wikipedia.org/wiki/Simulated_annealing#Overview).Itdecreasesovertimeasthesimulation“coolsdown”.When*alpha*reaches*alphaMin*,thesimulationstops;see[*simulation*.restart](#simulation_restart).If*alpha*isspecified,setsthecurrentalphatothespecifiednumberintherange[0,1]andreturnsthissimulation.If*alpha*isnotspecified,returnsthecurrentalphavalue,whichdefaultsto1.##*simulation*.alphaMin(*min*){#simulation_alphaMin}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·If*min*isspecified,setstheminimum*alpha*tothespecifiednumberintherange[0,1]andreturnsthissimulation.If*min*isnotspecified,returnsthecurrentminimum*alpha*value,whichdefaultsto0.001.Thesimulation’sinternaltimerstopswhenthecurrent[*alpha*](#simulation_alpha)islessthantheminimum*alpha*.Thedefault[alphadecayrate](#simulation_alphaDecay)of~0.0228correspondsto300iterations.##*simulation*.alphaDecay(*decay*){#simulation_alphaDecay}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·If*decay*isspecified,setsthe[*alpha*](#simulation_alpha)decayratetothespecifiednumberintherange[0,1]andreturnsthissimulation.If*decay*isnotspecified,returnsthecurrent*alpha*decayrate,whichdefaultsto0.0228…=1-*pow*(0.001,1/300)where0.001isthedefault[minimum*alpha*](#simulation_alphaMin).Thealphadecayratedetermineshowquicklythecurrentalphainterpolatestowardsthedesired[target*alpha*](#simulation_alphaTarget);sincethedefaulttarget*alpha*iszero,bydefaultthiscontrolshowquicklythesimulationcools.Higherdecayratescausethesimulationtostabilizemorequickly,butriskgettingstuckinalocalminimum;lowervaluescausethesimulationtotakelongertorun,buttypicallyconvergeonabetterlayout.Tohavethesimulationrunforeveratthecurrent*alpha*,setthe*decay*ratetozero;alternatively,seta[target*alpha*](#simulation_alphaTarget)greaterthanthe[minimum*alpha*](#simulation_alphaMin).##*simulation*.alphaTarget(*target*){#simulation_alphaTarget}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·If*target*isspecified,setsthecurrenttarget[*alpha*](#simulation_alpha)tothespecifiednumberintherange[0,1]andreturnsthissimulation.If*target*isnotspecified,returnsthecurrenttargetalphavalue,whichdefaultsto0.##*simulation*.velocityDecay(*decay*){#simulation_velocityDecay}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·If*decay*isspecified,setsthevelocitydecayfactortothespecifiednumberintherange[0,1]andreturnsthissimulation.If*decay*isnotspecified,returnsthecurrentvelocitydecayfactor,whichdefaultsto0.4.Thedecayfactorisakintoatmosphericfriction;aftertheapplicationofanyforcesduringa[tick](#simulation_tick),eachnode’svelocityismultipliedby1-*decay*.Aswithloweringthe[alphadecayrate](#simulation_alphaDecay),lessvelocitydecaymayconvergeonabettersolution,butrisksnumericalinstabilitiesandoscillation.##*simulation*.force(*name*,*force*){#simulation_force}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·If*force*isspecified,assignsthe[force](#custom-forces)forthespecified*name*andreturnsthissimulation.If*force*isnotspecified,returnstheforcewiththespecifiedname,orundefinedifthereisnosuchforce.(Bydefault,newsimulationshavenoforces.)Forexample,tocreateanewsimulationtolayoutagraph,youmightsay:```jsconstsimulation=d3.forceSimulation(nodes).force("charge",d3.forceManyBody()).force("link",d3.forceLink(links)).force("center",d3.forceCenter());```Toremovetheforcewiththegiven*name*,passnullasthe*force*.Forexample,toremovethechargeforce:```jssimulation.force("charge",null);```##*simulation*.find(*x*,*y*,*radius*){#simulation_find}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·Returnsthenodeclosesttotheposition⟨*x*,*y*⟩withthegivensearch*radius*.If*radius*isnotspecified,itdefaultstoinfinity.Ifthereisnonodewithinthesearcharea,returnsundefined.##*simulation*.randomSource(*source*){#simulation_randomSource}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js"Source"))If*source*isspecified,setsthefunctionusedtogeneraterandomnumbers;thisshouldbeafunctionthatreturnsanumberbetween0(inclusive)and1(exclusive).If*source*isnotspecified,returnsthissimulation’scurrentrandomsourcewhichdefaultstoafixed-seed[linearcongruentialgenerator](https://en.wikipedia.org/wiki/Linear_congruential_generator).Seealso[*random*.source](../d3-random.md#random_source).##*simulation*.on(*typenames*,*listener*){#simulation_on}[Source](https://github.com/d3/d3-force/blob/main/src/simulation.js)·If*listener*isspecified,setstheevent*listener*forthespecified*typenames*andreturnsthissimulation.Ifaneventlistenerwasalreadyregisteredforthesametypeandname,theexistinglistenerisremovedbeforethenewlistenerisadded.If*listener*isnull,removesthecurrenteventlistenersforthespecified*typenames*,ifany.If*listener*isnotspecified,returnsthefirstcurrently-assignedlistenermatchingthespecified*typenames*,ifany.Whenaspecifiedeventisdispatched,each*listener*willbeinvokedwiththe`this`contextasthesimulation.The*typenames*isastringcontainingoneormore*typename*separatedbywhitespace.Each*typename*isa*type*,optionallyfollowedbyaperiod(`.`)anda*name*,suchas`tick.foo`and`tick.bar`;thenameallowsmultiplelistenerstoberegisteredforthesame*type*.The*type*mustbeoneofthefollowing:*`tick`-aftereachtickofthesimulation’sinternaltimer.*`end`-afterthesimulation’stimerstopswhen*alpha*<[*alphaMin*](#simulation_alphaMin).Notethat*tick*eventsarenotdispatchedwhen[*simulation*.tick](#simulation_tick)iscalledmanually;eventsareonlydispatchedbytheinternaltimerandareintendedforinteractiverenderingofthesimulation.Toaffectthesimulation,register[forces](#simulation_force)insteadofmodifyingnodes’positionsorvelocitiesinsideatickeventlistener.See[*dispatch*.on](../d3-dispatch.md#dispatch_on)fordetails.##CustomforcesA*force*isafunctionthatmodifiesnodes’positionsorvelocities.Itcansimulateaphysicalforcesuchaselectricalchargeorgravity,oritcanresolveageometricconstraintsuchaskeepingnodeswithinaboundingboxorkeepinglinkednodesafixeddistanceapart.Forexample,hereisaforcethatmovesnodestowardstheorigin:```jsfunctionforce(alpha){for(leti=0,n=nodes.length,node,k=alpha*0.1;i<n;++i){node=nodes[i];node.vx-=node.x*k;node.vy-=node.y*k;}}```Forcestypicallyreadthenode’scurrentposition⟨*x*,*y*⟩andthenmutatethenode’svelocity⟨*vx*,*vy*⟩.Forcesmayalso“peekahead”totheanticipatednextpositionofthenode,⟨*x*+*vx*,*y*+*vy*⟩;thisisnecessaryforresolvinggeometricconstraintsthrough[iterativerelaxation](https://en.wikipedia.org/wiki/Relaxation_\(iterative_method\)).Forcesmayalsomodifythepositiondirectly,whichissometimesusefultoavoidaddingenergytothesimulation,suchaswhenrecenteringthesimulationintheviewport.###*force*(*alpha*){#_force}Appliesthisforce,optionallyobservingthespecified*alpha*.Typically,theforceisappliedtothearrayofnodespreviouslypassedto[*force*.initialize](#force_initialize),however,someforcesmayapplytoasubsetofnodes,orbehavedifferently.Forexample,[forceLink](./link.md)appliestothesourceandtargetofeachlink.###*force*.initialize(*nodes*){#force_initialize}Suppliesthearrayof*nodes*and*random*sourcetothisforce.Thismethodiscalledwhenaforceisboundtoasimulationvia[*simulation*.force](#simulation_force)andwhenthesimulation’snodeschangevia[*simulation*.nodes](#simulation_nodes).Aforcemayperformnecessaryworkduringinitialization,suchasevaluatingper-nodeparameters,toavoidrepeatedlyperformingworkduringeachapplicationoftheforce.