#ProjectionsProjectionstransformsphericalpolygonalgeometrytoplanarpolygonalgeometry.D3providesimplementationsofseveralclassesofstandardprojections:*[Azimuthalprojections](./azimuthal.md)*[Conicprojections](./conic.md)*[Cylindricalprojections](./cylindrical.md)Formoreprojections,see[d3-geo-projection](https://github.com/d3/d3-geo-projection)and[d3-geo-polygon](https://github.com/d3/d3-geo-polygon).Youcanimplement[customprojections](#raw-projections)using[geoProjection](#geoProjection)or[geoProjectionMutator](#geoProjectionMutator).##*projection*(*point*){#_projection}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Returnsanewarray[*x*,*y*](typicallyinpixels)representingtheprojectedpointofthegiven*point*.Thepointmustbespecifiedasatwo-elementarray[*longitude*,*latitude*]indegrees.Mayreturnnullifthespecified*point*hasnodefinedprojectedposition,suchaswhenthepointisoutsidetheclippingboundsoftheprojection.##*projection*.invert(*point*){#projection_invert}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Returnsanewarray[*longitude*,*latitude*]indegreesrepresentingtheunprojectedpointofthegivenprojected*point*.Thepointmustbespecifiedasatwo-elementarray[*x*,*y*](typicallyinpixels).Mayreturnnullifthespecified*point*hasnodefinedprojectedposition,suchaswhenthepointisoutsidetheclippingboundsoftheprojection.Thismethodisonlydefinedoninvertibleprojections.##*projection*.stream(*stream*){#projection_stream}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Returnsa[projectionstream](./stream.md)forthespecifiedoutput*stream*.Anyinputgeometryisprojectedbeforebeingstreamedtotheoutputstream.Atypicalprojectioninvolvesseveralgeometrytransformations:theinputgeometryisfirstconvertedtoradians,rotatedonthreeaxes,clippedtothesmallcircleorcutalongtheantimeridian,andlastlyprojectedtotheplanewithadaptiveresampling,scaleandtranslation.##*projection*.preclip(*preclip*){#projection_preclip}If*preclip*isspecified,setstheprojection’ssphericalclippingtothespecifiedfunctionandreturnstheprojection;*preclip*isafunctionthattakesa[projectionstream](./stream.md)andreturnsaclippedstream.If*preclip*isnotspecified,returnsthecurrentsphericalclippingfunction.Preclippingiscommonlyusedtocutalongtheantimeridianlineoralongasmallcircle.##*projection*.postclip(*postclip*){#projection_postclip}If*postclip*isspecified,setstheprojection’sCartesianclippingtothespecifiedfunctionandreturnstheprojection;*postclip*isafunctionthattakesa[projectionstream](./stream.md)andreturnsaclippedstream.If*postclip*isnotspecified,returnsthecurrentCartesianclippingfunction.Post-clippingoccursontheplane,whenaprojectionisboundedtoacertainextentsuchasarectangle.##*projection*.clipAngle(*angle*){#projection_clipAngle}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*angle*isspecified,setstheprojection’sclippingcircleradiustothespecifiedangleindegreesandreturnstheprojection.If*angle*isnull,switchesto[antimeridiancutting](https://observablehq.com/@d3/antimeridian-cutting)ratherthansmall-circleclipping.If*angle*isnotspecified,returnsthecurrentclipanglewhichdefaultstonull.Small-circleclippingisindependentofviewportclippingvia[*projection*.clipExtent](#projection_clipExtent).Seealso[*projection*.preclip](#projection_preclip),[geoClipAntimeridian](#geoClipAntimeridian),[geoClipCircle](#geoClipCircle).##*projection*.clipExtent(*extent*){#projection_clipExtent}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*extent*isspecified,setstheprojection’sviewportclipextenttothespecifiedboundsinpixelsandreturnstheprojection.The*extent*boundsarespecifiedasanarray\[\[<i>x₀</i>,<i>y₀</i>\],\[<i>x₁</i>,<i>y₁</i>\]\],where<i>x₀</i>istheleft-sideoftheviewport,<i>y₀</i>isthetop,<i>x₁</i>istherightand<i>y₁</i>isthebottom.If*extent*isnull,noviewportclippingisperformed.If*extent*isnotspecified,returnsthecurrentviewportclipextentwhichdefaultstonull.Viewportclippingisindependentofsmall-circleclippingvia[*projection*.clipAngle](#projection_clipAngle).Seealso[*projection*.postclip](#projection_postclip),[geoClipRectangle](#geoClipRectangle).##*projection*.scale(*scale*){#projection_scale}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*scale*isspecified,setstheprojection’sscalefactortothespecifiedvalueandreturnstheprojection.If*scale*isnotspecified,returnsthecurrentscalefactor;thedefaultscaleisprojection-specific.Thescalefactorcorrespondslinearlytothedistancebetweenprojectedpoints;however,absolutescalefactorsarenotequivalentacrossprojections.##*projection*.translate(*translate*){#projection_translate}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*translate*isspecified,setstheprojection’stranslationoffsettothespecifiedtwo-elementarray[<i>t<sub>x</sub></i>,<i>t<sub>y</sub></i>]andreturnstheprojection.If*translate*isnotspecified,returnsthecurrenttranslationoffsetwhichdefaultsto[480,250].Thetranslationoffsetdeterminesthepixelcoordinatesoftheprojection’s[center](#projection_center).Thedefaulttranslationoffsetplaces⟨0°,0°⟩atthecenterofa960×500area.##*projection*.center(*center*){#projection_center}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*center*isspecified,setstheprojection’scentertothespecified*center*,atwo-elementarrayof[*longitude*,*latitude*]indegreesandreturnstheprojection.If*center*isnotspecified,returnsthecurrentcenter,whichdefaultsto⟨0°,0°⟩.##*projection*.angle(*angle*){#projection_angle}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*angle*isspecified,setstheprojection’spost-projectionplanarrotationangletothespecified*angle*indegreesandreturnstheprojection.If*angle*isnotspecified,returnstheprojection’scurrentangle,whichdefaultsto0°.Notethatitmaybefastertorotateduringrendering(e.g.,using[*context*.rotate](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/rotate))ratherthanduringprojection.##*projection*.reflectX(*reflect*){#projection_reflectX}If*reflect*isspecified,setswhetherornotthe*x*-dimensionisreflected(negated)intheoutput.If*reflect*isnotspecified,returnstrueif*x*-reflectionisenabled,whichdefaultstofalse.Thiscanbeusefultodisplayskyandastronomicaldatawiththeorbseenfrombelow:rightascension(easterndirection)willpointtotheleftwhenNorthispointingup.##*projection*.reflectY(*reflect*){#projection_reflectY}If*reflect*isspecified,setswhetherornotthe*y*-dimensionisreflected(negated)intheoutput.If*reflect*isnotspecified,returnstrueif*y*-reflectionisenabled,whichdefaultstofalse.Thisisespeciallyusefulfortransformingfromstandard[spatialreferencesystems](https://en.wikipedia.org/wiki/Spatial_reference_system),whichtreatpositive*y*aspointingup,todisplaycoordinatesystemssuchasCanvasandSVG,whichtreatpositive*y*aspointingdown.##*projection*.rotate(*angles*){#projection_rotate}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*rotation*isspecified,setstheprojection’s[three-axissphericalrotation](https://observablehq.com/@d3/three-axis-rotation)tothespecified*angles*,whichmustbeatwo-orthree-elementarrayofnumbers[*lambda*,*phi*,*gamma*]specifyingtherotationanglesindegreesabout[eachsphericalaxis](https://observablehq.com/@d3/three-axis-rotation).(Thesecorrespondto[yaw,pitchandroll](https://en.wikipedia.org/wiki/Aircraft_principal_axes).)Iftherotationangle*gamma*isomitted,itdefaultsto0.Seealso[geoRotation](./math.md#geoRotation).If*rotation*isnotspecified,returnsthecurrentrotationwhichdefaults[0,0,0].##*projection*.precision(*precision*){#projection_precision}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·If*precision*isspecified,setsthethresholdfortheprojection’s[adaptiveresampling](https://observablehq.com/@d3/adaptive-sampling)tothespecifiedvalueinpixelsandreturnstheprojection.Thisvaluecorrespondstothe[Douglas–Peucker](https://en.wikipedia.org/wiki/Ramer–Douglas–Peucker_algorithm)distance.If*precision*isnotspecified,returnstheprojection’scurrentresamplingprecisionwhichdefaultsto√0.5≅0.70710…##*projection*.fitExtent(*extent*,*object*){#projection_fitExtent}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Setstheprojection’s[scale](#projection_scale)and[translate](#projection_translate)tofitthespecifiedGeoJSON*object*inthecenterofthegiven*extent*.Theextentisspecifiedasanarray\[\[x₀,y₀\],\[x₁,y₁\]\],wherex₀istheleftsideoftheboundingbox,y₀isthetop,x₁istherightandy₁isthebottom.Returnstheprojection.Forexample,toscaleandtranslatethe[NewJerseyStatePlaneprojection](https://observablehq.com/@d3/new-jersey-state-plane)tofitaGeoJSONobject*nj*inthecenterofa960×500boundingboxwith20pixelsofpaddingoneachside:```jsvarprojection=d3.geoTransverseMercator().rotate([74+30/60,-38-50/60]).fitExtent([[20,20],[940,480]],nj);```Any[clipextent](#projection_clipExtent)isignoredwhendeterminingthenewscaleandtranslate.The[precision](#projection_precision)usedtocomputetheboundingboxofthegiven*object*iscomputedataneffectivescaleof150.##*projection*.fitSize(*size*,*object*){#projection_fitSize}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Aconveniencemethodfor[*projection*.fitExtent](#projection_fitExtent)wherethetop-leftcorneroftheextentis[0,0].Thefollowingtwostatementsareequivalent:```jsprojection.fitExtent([[0,0],[width,height]],object);projection.fitSize([width,height],object);```##*projection*.fitWidth(*width*,*object*){#projection_fitWidth}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Aconveniencemethodfor[*projection*.fitSize](#projection_fitSize)wheretheheightisautomaticallychosenfromtheaspectratioof*object*andthegivenconstrainton*width*.##*projection*.fitHeight(*height*,*object*){#projection_fitHeight}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Aconveniencemethodfor[*projection*.fitSize](#projection_fitSize)wherethewidthisautomaticallychosenfromtheaspectratioof*object*andthegivenconstrainton*height*.##Rawprojections{#raw-projections}Rawprojectionsarepointtransformationfunctionsthatareusedtoimplementcustomprojections;theytypicallypassedto[geoProjection](#geoProjection)or[geoProjectionMutator](#geoProjectionMutator).Theyareexposedheretofacilitatethederivationofrelatedprojections.Rawprojectionstakesphericalcoordinates[*lambda*,*phi*]inradians(notdegrees!)andreturnapoint[*x*,*y*],typicallyintheunitsquarecenteredaroundtheorigin.###*project*(*lambda*,*phi*){#_project}Projectsthespecifiedpoint[<i>lambda</i>,<i>phi</i>]inradians,returninganewpoint[*x*,*y*]inunitlesscoordinates.###*project*.invert(*x*,*y*){#project_invert}Theinverseof[*project*](#_project).##geoProjection(*project*){#geoProjection}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Constructsanewprojectionfromthespecified[rawprojection](#raw-projections),*project*.The*project*functiontakesthe*longitude*and*latitude*ofagivenpointin[radians](http://mathworld.wolfram.com/Radian.html),oftenreferredtoas*lambda*(λ)and*phi*(φ),andreturnsatwo-elementarray[*x*,*y*]representingitsunitprojection.The*project*functiondoesnotneedtoscaleortranslatethepoint,astheseareappliedautomaticallyby[*projection*.scale](#projection_scale),[*projection*.translate](#projection_translate),and[*projection*.center](#projection_center).Likewise,the*project*functiondoesnotneedtoperformanysphericalrotation,as[*projection*.rotate](#projection_rotate)isappliedpriortoprojection.Forexample,asphericalMercatorprojectioncanbeimplementedas:```jsvarmercator=d3.geoProjection(function(x,y){return[x,Math.log(Math.tan(Math.PI/4+y/2))];});```Ifthe*project*functionexposesan*invert*method,thereturnedprojectionwillalsoexpose[*projection*.invert](#projection_invert).##geoProjectionMutator(*factory*){#geoProjectionMutator}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/index.js)·Constructsanewprojectionfromthespecified[rawprojection](#_project)*factory*andreturnsa*mutate*functiontocallwhenevertherawprojectionchanges.The*factory*mustreturnarawprojection.Thereturned*mutate*functionreturnsthewrappedprojection.Forexample,aconicprojectiontypicallyhastwoconfigurableparallels.Asuitable*factory*function,suchas[geoConicEqualAreaRaw](./conic.md#geoConicEqualArea),wouldhavetheform:```js//y0andy1representtwoparallelsfunctionconicFactory(phi0,phi1){returnfunctionconicRaw(lambda,phi){return[…,…];};}```Usingd3.geoProjectionMutator,youcanimplementastandardprojectionthatallowstheparallelstobechanged,reassigningtherawprojectionusedinternallyby[geoProjection](#geoProjection):```jsfunctionconicCustom(){varphi0=29.5,phi1=45.5,mutate=d3.geoProjectionMutator(conicFactory),projection=mutate(phi0,phi1);projection.parallels=function(_){returnarguments.length?mutate(phi0=+_[0],phi1=+_[1]):[phi0,phi1];};returnprojection;}```Whencreatingamutableprojection,the*mutate*functionistypicallynotexposed.##geoTransform(*methods*){#geoTransform}[Source](https://github.com/d3/d3-geo/blob/main/src/transform.js)·Definesanarbitrarytransformusingthemethodsdefinedonthespecified*methods*object.Anyundefinedmethodswillusepass-throughmethodsthatpropagateinputstotheoutputstream.Forexample,toreflectthe*y*-dimension(seealso[*projection*.reflectY](#projection_reflectY)):```jsconstreflectY=d3.geoTransform({point(x,y){this.stream.point(x,-y);}});```Ortodefineanaffinematrixtransformation:```jsfunctionmatrix(a,b,c,d,tx,ty){returnd3.geoTransform({point(x,y){this.stream.point(a*x+b*y+tx,c*x+d*y+ty);}});}```Atransformisageneralizedprojection;itimplements[*projection*.stream](#projection_stream)andcanbepassedto[*path*.projection](./path.md#path_projection).However,itimplementsonlyasubsetoftheotherprojectionmethods,andrepresentarbitrarygeometrictransformationsratherthanprojectionsfromsphericaltoplanarcoordinates.##geoIdentity(){#geoIdentity}[Source](https://github.com/d3/d3-geo/blob/main/src/projection/identity.js)·Theidentitytransformcanbeusedtoscale,translateandclipplanargeometry.Itimplements[*projection*.scale](#projection_scale),[*projection*.translate](#projection_translate),[*projection*.fitExtent](#projection_fitExtent),[*projection*.fitSize](#projection_fitSize),[*projection*.fitWidth](#projection_fitWidth),[*projection*.fitHeight](#projection_fitHeight),[*projection*.clipExtent](#projection_clipExtent),[*projection*.angle](#projection_angle),[*projection*.reflectX](#projection_reflectX)and[*projection*.reflectY](#projection_reflectY).##geoClipAntimeridian{#geoClipAntimeridian}[Source](https://github.com/d3/d3-geo/blob/main/src/clip/antimeridian.js)·Aclippingfunctionwhichtransformsastreamsuchthatgeometries(linesorpolygons)thatcrosstheantimeridianlinearecutintwo,oneoneachside.Typicallyusedforpre-clipping.##geoClipCircle(*angle*){#geoClipCircle}[Source](https://github.com/d3/d3-geo/blob/main/src/clip/circle.js)·Generatesaclippingfunctionwhichtransformsastreamsuchthatgeometriesareboundedbyasmallcircleofradius*angle*aroundtheprojection’s[center](#projection_center).Typicallyusedforpre-clipping.##geoClipRectangle(*x0*,*y0*,*x1*,*y1*){#geoClipRectangle}[Source](https://github.com/d3/d3-geo/blob/main/src/clip/rectangle.js)·Generatesaclippingfunctionwhichtransformsastreamsuchthatgeometriesareboundedbyarectangleofcoordinates[[<i>x0</i>,<i>y0</i>],[<i>x1</i>,<i>y1</i>]].Typicallyusedforpost-clipping.