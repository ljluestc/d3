<scriptsetup>import*asPlotfrom"@observablehq/plot";import*asd3from"d3";import{shallowRef}from"vue";importPlotRenderfrom"../components/PlotRender.js";constrandom=d3.randomNormal.source(d3.randomLcg(42))();constpoints=Array.from({length:1000},()=>[random(),random()]);constfindState=shallowRef({x:0,y:0,i:-1});constneighborsState=shallowRef({i:-1,N:[]});</script>#Delaunaytriangulations<PlotRenderdefer:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.delaunayMesh(points,{strokeOpacity:0.3})]}'/>TheDelaunaytriangulationisatriangularmeshformedfromasetofpointsin*x*and*y*.Nopointisinsidethecircumcircleofanytriangle,whichisanicegeometricpropertyforcertainapplications,andtendstoavoid“sliver”triangles.TheDelaunaytriangulationisthedualofthe[Voronoidiagram](./voronoi.md).##newDelaunay(*points*){#Delaunay}[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·ReturnstheDelaunaytriangulationforthegivenflatarray[*x0*,*y0*,*x1*,*y1*,…]of*points*.```jsconstdelaunay=newd3.Delaunay(Float64Array.of(0,0,0,1,1,0,1,1));```Thegiven*points*maybeanyarray-liketype,butistypicallyaFloat64Array.###*delaunay*.points{#delaunay_points}Thecoordinatesofthepointsasanarray[*x0*,*y0*,*x1*,*y1*,…].###*delaunay*.halfedges{#delaunay_halfedges}ThehalfedgeindexesasanInt32Array[*j0*,*j1*,…].Foreachindex0≤*i*<*halfedges*.length,thereisahalfedgefromtrianglevertex*j*=*halfedges*[*i*]totrianglevertex*i*.Equivalently,thismeansthattriangle⌊*i*/3⌋isadjacenttotriangle⌊*j*/3⌋.If*j*isnegative,thentriangle⌊*i*/3⌋isanexteriortriangleonthe[convexhull](#delaunay_hull).Forexample,torendertheinternaledgesoftheDelaunaytriangulation:```jsconst{points,halfedges,triangles}=delaunay;for(leti=0,n=halfedges.length;i<n;++i){constj=halfedges[i];if(j<i)continue;constti=triangles[i];consttj=triangles[j];context.moveTo(points[ti*2],points[ti*2+1]);context.lineTo(points[tj*2],points[tj*2+1]);}```Seealso[*delaunay*.render](#delaunay_render).###*delaunay*.hull{#delaunay_hull}AnInt32Arrayofpointindexesthatformtheconvexhullincounterclockwiseorder.Ifthepointsarecollinear,returnsthemordered.Seealso[*delaunay*.renderHull](#delaunay_renderHull).###*delaunay*.triangles{#delaunay_triangles}ThetrianglevertexindexesasanUint32Array[*i0*,*j0*,*k0*,*i1*,*j1*,*k1*,…].Eachcontiguoustripletofindexes*i*,*j*,*k*formsacounterclockwisetriangle.Thecoordinatesofthetriangle’spointscanbefoundbygoingthrough[*delaunay*.points](#delaunay_points).Forexample,torendertriangle*i*:```jsconst{points,triangles}=delaunay;constt0=triangles[i*3+0];constt1=triangles[i*3+1];constt2=triangles[i*3+2];context.moveTo(points[t0*2],points[t0*2+1]);context.lineTo(points[t1*2],points[t1*2+1]);context.lineTo(points[t2*2],points[t2*2+1]);context.closePath();```Seealso[*delaunay*.renderTriangle](#delaunay_renderTriangle).###*delaunay*.inedges{#delaunay_inedges}TheincominghalfedgeindexesasaInt32Array[*e0*,*e1*,*e2*,…].Foreachpoint*i*,*inedges*[*i*]isthehalfedgeindex*e*ofanincominghalfedge.Forcoincidentpoints,thehalfedgeindexis-1;forpointsontheconvexhull,theincominghalfedgeisontheconvexhull;forotherpoints,thechoiceofincominghalfedgeisarbitrary.The*inedges*tablecanbeusedtotraversetheDelaunaytriangulation;seealso[*delaunay*.neighbors](#delaunay_neighbors).##Delaunay.from(*points*,*fx*,*fy*,*that*){#Delaunay_from}:::tipDelaunay.fromistypicallyslowerthan[newDelaunay](#Delaunay)becauseitrequiresmaterializinganewflatarrayof*xy*coordinates.:::[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·ReturnstheDelaunaytriangulationforthegivenarrayoriterableof*points*.If*fx*and*fy*arenotspecified,then*points*isassumedtobeanarrayoftwo-elementarraysofnumbers:[[*x0*,*y0*],[*x1*,*y1*],…].```jsconstdelaunay=d3.Delaunay.from([[0,0],[0,1],[1,0],[1,1]]);```Otherwise,*fx*and*fy*arefunctionsthatareinvokedforeachelementinthe*points*arrayinorder,andmustreturntherespectivexandycoordinateforeachpoint.```jsconstdelaunay=d3.Delaunay.from([{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:1}],(d)=>d.x,(d)=>d.y);```If*that*isspecified,thefunctions*fx*and*fy*areinvokedwith*that*as*this*.(See[Array.from](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/from)forreference.)##*delaunay*.find(*x*,*y*,*i*){#delaunay_find}<PlotRenderdeferv-once:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.delaunayMesh(points,{strokeOpacity:0.3}),Plot.line(points,{stroke:"red",strokeWidth:3,markerStart:"dot",markerEnd:"arrow",render(index,scales,values,dimensions,context,next){const{x:X,y:Y}=values;constdelaunay=d3.Delaunay.from(points,(d,i)=>X[i],(d,i)=>Y[i]);functionupdate(x,y){letj=0,i,path=[j];while((i=delaunay._step(j,x,y))>=0&&i!==j)path.push(j=i);findState={x,y,i};returnnext(path,scales,values,dimensions,context);}letline=update(0,0);context.ownerSVGElement.addEventListener("pointermove",(event)=>{const[x,y]=d3.pointer(event);constnewline=update(Math.round(x),Math.round(y));line.replaceWith(newline);line=newline;});returnline;}}),]}'/>```js-vuedelaunay.find({{findState.x}},{{findState.y}})//{{findState.i}}```[Examples](https://observablehq.com/@d3/delaunay-find)·[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Returnstheindexoftheinputpointthatisclosesttothespecifiedpoint⟨*x*,*y*⟩.Thesearchisstartedatthespecifiedpoint*i*.If*i*isnotspecified,itdefaultstozero.##*delaunay*.neighbors(*i*){#delaunay_neighbors}<PlotRenderdeferv-once:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.delaunayMesh(points,{strokeOpacity:0.3}),Plot.link(points,{x1:(d)=>d[0],y1:(d)=>d[1],x2:(d)=>d[0],y2:(d)=>d[1],stroke:"red",strokeWidth:2,markerStart:"dot",markerEnd:"arrow",render(index,scales,values,dimensions,context,next){const{x1:X,y1:Y}=values;constdelaunay=d3.Delaunay.from(points,(d,i)=>X[i],(d,i)=>Y[i]);functionupdate(x,y){consti=delaunay.find(x,y);constN=Array.from(delaunay.neighbors(i));neighborsState={i,N};returnnext(d3.range(N.length),scales,{x1:N.map(()=>X[i]),x2:N.map((j)=>X[j]),y1:N.map(()=>Y[i]),y2:N.map((j)=>Y[j])},dimensions,context);}letline=update(0,0);context.ownerSVGElement.addEventListener("pointermove",(event)=>{const[x,y]=d3.pointer(event);constnewline=update(Math.round(x),Math.round(y));line.replaceWith(newline);line=newline;});returnline;}}),]}'/>```js-vuedelaunay.neighbors({{neighborsState.i}})//[{{neighborsState.N.join(",")}}]```[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Returnsaniterableovertheindexesoftheneighboringpointstothespecifiedpoint*i*.Theiterableisemptyif*i*isacoincidentpoint.##*delaunay*.render(*context*){#delaunay_render}<PlotRenderdefer:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.delaunayMesh(points,{strokeOpacity:1})]}'/>[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·RenderstheedgesoftheDelaunaytriangulationtothespecified*context*.Thespecified*context*mustimplementthe*context*.moveToand*context*.lineTomethodsfromthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods).Ifa*context*isnotspecified,anSVGpathstringisreturnedinstead.##*delaunay*.renderHull(*context*){#delaunay_renderHull}<PlotRenderdefer:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.hull(points,{strokeOpacity:1})]}'/>[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·RenderstheconvexhulloftheDelaunaytriangulationtothespecified*context*.Thespecified*context*mustimplementthe*context*.moveToand*context*.lineTomethodsfromthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods).Ifa*context*isnotspecified,anSVGpathstringisreturnedinstead.##*delaunay*.renderTriangle(*i*,*context*){#delaunay_renderTriangle}<PlotRenderdefer:options='{axis:null,width:688,height:688,color:{scheme:$dark?"turbo":"orrd",reverse:true},x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.geo([],{stroke:"black",strokeOpacity:0.2,initializer(data,facets,channels,{x,y}){constdelaunay=d3.Delaunay.from(points,(d)=>x(d[0]),(d)=>y(d[1]));constpolygons=Array.from(delaunay.trianglePolygons());constindex=d3.range(polygons.length);return{data:polygons,facets:[index],channels:{geometry:{value:polygons.map((ring)=>({type:"Polygon",coordinates:[ring.map(([px,py])=>[x.invert(px),y.invert(py)])]})),scale:false//TODOallowscale:truehere},fill:{value:index,scale:true}}};}}),Plot.dot(points,{r:2,fill:"black"})]}'/>[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Renderstriangle*i*oftheDelaunaytriangulationtothespecified*context*.Thespecified*context*mustimplementthe*context*.moveTo,*context*.lineToand*context*.closePathmethodsfromthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods).Ifa*context*isnotspecified,anSVGpathstringisreturnedinstead.##*delaunay*.renderPoints(*context*,*radius*){#delaunay_renderPoints}<PlotRenderdefer:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"})]}'/>[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·RenderstheinputpointsoftheDelaunaytriangulationtothespecified*context*ascircleswiththespecified*radius*.If*radius*isnotspecified,itdefaultsto2.Thespecified*context*mustimplementthe*context*.moveToand*context*.arcmethodsfromthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods).Ifa*context*isnotspecified,anSVGpathstringisreturnedinstead.##*delaunay*.hullPolygon(){#delaunay_hullPolygon}[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Returnstheclosedpolygon[[*x0*,*y0*],[*x1*,*y1*],…,[*x0*,*y0*]]representingtheconvexhull.Seealso[*delaunay*.renderHull](#delaunay_renderHull).##*delaunay*.trianglePolygons(){#delaunay_trianglePolygons}[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Returnsaniterableoverthe[polygonsforeachtriangle](#delaunay_trianglePolygon),inorder.Seealso[*delaunay*.renderTriangle](#delaunay_renderTriangle).##*delaunay*.trianglePolygon(*i*){#delaunay_trianglePolygon}[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Returnstheclosedpolygon[[*x0*,*y0*],[*x1*,*y1*],[*x2*,*y2*],[*x0*,*y0*]]representingthetriangle*i*.Seealso[*delaunay*.renderTriangle](#delaunay_renderTriangle).##*delaunay*.update(){#delaunay_update}[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Recomputesthetriangulationafterthepointshavebeenmodifiedin-place.##*delaunay*.voronoi(*bounds*){#delaunay_voronoi}[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·Returnsthe[Voronoidiagram](./voronoi.md)forthegivenDelaunaytriangulation.Whenrendering,thediagramwillbeclippedtothespecified*bounds*=[*xmin*,*ymin*,*xmax*,*ymax*].```jsconstdelaunay=d3.Delaunay.from(points);constvoronoi=delaunay.voronoi([0,0,640,480]);```If*bounds*isnotspecified,itdefaultsto[0,0,960,500].TheVoronoidiagramisreturnedevenindegeneratecaseswherenotriangulationexists—namely0,1or2points,andcollinearpoints.