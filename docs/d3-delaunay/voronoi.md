<scriptsetup>import*asPlotfrom"@observablehq/plot";import*asd3from"d3";import{shallowRef}from"vue";importPlotRenderfrom"../components/PlotRender.js";constrandom=d3.randomNormal.source(d3.randomLcg(42))();constpoints=Array.from({length:1000},()=>[random(),random()]);constneighborsState=shallowRef({i:-1,N:[]});</script>#Voronoidiagrams<PlotRenderdefer:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.voronoiMesh(points,{strokeOpacity:0.3})]}'/>Givenasetofpoints,theVoronoidiagrampartitionstheplaneintocellsrepresentingtheregionoftheplanethatisclosesttothecorrespondingpoint.TheVoronoidiagramisthedualofthe[Delaunaytriangulation](./delaunay.md).##*delaunay*.voronoi(*bounds*){#delaunay_voronoi}[Source](https://github.com/d3/d3-delaunay/blob/main/src/delaunay.js)·ReturnstheVoronoidiagramforthegiven[Delaunaytriangulation](./delaunay.md).Whenrendering,thediagramwillbeclippedtothespecified*bounds*=[*xmin*,*ymin*,*xmax*,*ymax*].```jsconstdelaunay=d3.Delaunay.from([[0,0],[0,100],[100,0],[100,100]]);constvoronoi=delaunay.voronoi([0,0,640,480]);```If*bounds*isnotspecified,itdefaultsto[0,0,960,500].TheVoronoidiagramisreturnedevenindegeneratecaseswherenotriangulationexists—namely0,1or2points,andcollinearpoints.###*voronoi*.delaunay{#voronoi_delaunay}TheVoronoidiagram’sassociated[Delaunaytriangulation](./delaunay.md).###*voronoi*.circumcenters{#voronoi_circumcenters}The[circumcenters](http://mathworld.wolfram.com/Circumcenter.html)oftheDelaunaytrianglesasaFloat64Array[*cx0*,*cy0*,*cx1*,*cy1*,…].Eachcontiguouspairofcoordinates*cx*,*cy*isthecircumcenterforthecorrespondingtriangle.ThesecircumcentersformthecoordinatesoftheVoronoicellpolygons.###*voronoi*.vectors{#voronoi_vectors}AFloat64Array[*vx0*,*vy0*,*wx0*,*wy0*,…]whereeachnon-zeroquadrupledescribesanopen(infinite)cellontheouterhull,givingthedirectionsoftwoopenhalf-lines.###*voronoi*.xmin<br>*voronoi*.ymin<br>*voronoi*.xmax<br>*voronoi*.ymax{#voronoi_bounds}Theboundsoftheviewport[*xmin*,*ymin*,*xmax*,*ymax*]forrenderingtheVoronoidiagram.Thesevaluesonlyaffecttherenderingmethods([*voronoi*.render](#voronoi_render),[*voronoi*.renderBounds](#voronoi_renderBounds),[*voronoi*.renderCell](#voronoi_renderCell)).##*voronoi*.contains(*i*,*x*,*y*){#voronoi_contains}[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·Returnstrueifthecellwiththespecifiedindex*i*containsthespecifiedpoint⟨*x*,*y*⟩;*i.e.*,whetherthepoint*i*istheclosestpointinthediagramtothespecifiedpoint.(ThismethodisnotaffectedbytheassociatedVoronoidiagram’sviewport[bounds](#voronoi_bounds).)##*voronoi*.neighbors(*i*){#voronoi_neighbors}<PlotRenderdeferv-once:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.voronoiMesh(points,{strokeOpacity:0.3}),Plot.link(points,{x1:(d)=>d[0],y1:(d)=>d[1],x2:(d)=>d[0],y2:(d)=>d[1],stroke:"red",strokeWidth:2,markerStart:"dot",markerEnd:"arrow",render(index,scales,values,dimensions,context,next){const{x1:X,y1:Y}=values;constdelaunay=d3.Delaunay.from(points,(d,i)=>X[i],(d,i)=>Y[i]);constvoronoi=delaunay.voronoi([0,0,dimensions.width,dimensions.height]);functionupdate(x,y){consti=delaunay.find(x,y);constN=Array.from(voronoi.neighbors(i));neighborsState={i,N};returnnext(d3.range(N.length),scales,{x1:N.map(()=>X[i]),x2:N.map((j)=>X[j]),y1:N.map(()=>Y[i]),y2:N.map((j)=>Y[j])},dimensions,context);}letline=update(0,0);context.ownerSVGElement.addEventListener("pointermove",(event)=>{const[x,y]=d3.pointer(event);constnewline=update(Math.round(x),Math.round(y));line.replaceWith(newline);line=newline;});returnline;}}),]}'/>```js-vuevoronoi.neighbors({{neighborsState.i}})//[{{neighborsState.N.join(",")}}]```[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·Returnsaniterableovertheindexesofthecellsthatshareacommonedgewiththespecifiedcell*i*.VoronoineighborsarealwaysneighborsontheDelaunaygraph,buttheconverseisfalsewhenthecommonedgehasbeenclippedoutbytheVoronoidiagram’sviewport.##*voronoi*.render(*context*){#voronoi_render}<PlotRenderdefer:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor"}),Plot.voronoiMesh(points,{strokeOpacity:1})]}'/>[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·RendersthemeshofVoronoicellstothespecified*context*.Thespecified*context*mustimplementthe*context*.moveToand*context*.lineTomethodsfromthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods).Ifa*context*isnotspecified,anSVGpathstringisreturnedinstead.##*voronoi*.renderBounds(*context*){#voronoi_renderBounds}<PlotRenderdefer:options='{axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},marks:[Plot.dot(points,{r:2,fill:"currentColor",clip:true}),Plot.frame()]}'/>[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·Renderstheviewportextenttothespecified*context*.Thespecified*context*mustimplementthe*context*.rectmethodfromthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods).Equivalentto*context*.rect(*voronoi*.xmin,*voronoi*.ymin,*voronoi*.xmax-*voronoi*.xmin,*voronoi*.ymax-*voronoi*.ymin).Ifa*context*isnotspecified,anSVGpathstringisreturnedinstead.##*voronoi*.renderCell(*i*,*context*){#voronoi_renderCell}<PlotRenderdefer:options='{style:{overflow:"hidden"},axis:null,width:688,height:688,x:{domain:[-4,3.5]},y:{domain:[-3,3.5]},color:{scheme:$dark?"turbo":"orrd"},marks:[Plot.voronoi(Array.from(d3.union(d3.Delaunay.from(points).triangles),(i)=>points[i]),{fill:(d,i)=>-i}),Plot.dot(points,{r:2,fill:"black"}),Plot.voronoiMesh(points,{stroke:"black",strokeOpacity:1}),Plot.frame({stroke:"black"}),]}'/>[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·Rendersthecellwiththespecifiedindex*i*tothespecified*context*.Thespecified*context*mustimplementthe*context*.moveTo,*context*.lineToand*context*.closePathmethodsfromthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods).Ifa*context*isnotspecified,anSVGpathstringisreturnedinstead.##*voronoi*.cellPolygons(){#voronoi_cellPolygons}[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·Returnsaniterableoverthenon-empty[polygonsforeachcell](#voronoi_cellPolygon),withthecellindexasproperty.Seealso[*voronoi*.renderCell](#voronoi_renderCell).##*voronoi*.cellPolygon(*i*){#voronoi_cellPolygon}[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·Returnstheconvex,closedpolygon[[*x0*,*y0*],[*x1*,*y1*],…,[*x0*,*y0*]]representingthecellforthespecifiedpoint*i*.Seealso[*voronoi*.renderCell](#voronoi_renderCell).##*voronoi*.update(){#voronoi_update}[Source](https://github.com/d3/d3-delaunay/blob/main/src/voronoi.js)·UpdatestheVoronoidiagramandunderlyingtriangulationafterthepointshavebeenmodifiedin-place—usefulforLloyd’srelaxation.Calls[*delaunay*.update](./delaunay.md#delaunay_update)ontheunderlyingDelaunaytriangulation.