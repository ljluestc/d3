#d3-drag[Examples](https://observablehq.com/collection/@d3/d3-drag)·[Drag-and-drop](https://en.wikipedia.org/wiki/Drag_and_drop)isapopularinteractionmethodformanipulatingspatialelements:movethepointertoanobject,pressandholdtograbit,“drag”theobjecttoanewlocation,andreleaseto“drop”.D3’sdragbehaviorprovidesaflexibleabstractionfordrag-and-drop.Forexample,youcandragnodesina[force-directedgraph](./d3-force.md):[<imgalt="Force-DirectedGraph"src="https://raw.githubusercontent.com/d3/d3-drag/master/img/force-graph.png"width="420"height="219">](https://observablehq.com/@d3/force-directed-graph/2?intent=fork)Orasimulationofcollidingcircles:[<imgalt="ForceDraggingII"src="https://raw.githubusercontent.com/d3/d3-drag/master/img/force-collide.png"width="420"height="219">](https://observablehq.com/@d3/drag-collisions)Thedragbehaviorisn’tjustformovingelementsaround;thereareavarietyofwaystorespondtoadraggesture.Forexample,youcanuseittolassoelementsinascatterplot,ortopaintlinesonacanvas:[<imgalt="LineDrawing"src="https://raw.githubusercontent.com/d3/d3-drag/master/img/drawing.png"width="420"height="219">](https://observablehq.com/@d3/draw-me)Thedragbehaviorcanbecombinedwithotherbehaviors,suchas[d3-zoom](./d3-zoom.md)forzooming:[<imgalt="Drag&ZoomII"src="https://raw.githubusercontent.com/d3/d3-drag/master/img/dots.png"width="420"height="219">](https://observablehq.com/@d3/drag-zoom)ThedragbehaviorisagnosticabouttheDOM,soyoucanuseitwithSVG,HTMLorevenCanvas!Andyoucanextenditwithadvancedselectiontechniques,suchasaVoronoioverlayoraclosest-targetsearch:[<imgalt="CircleDraggingIV"src="https://raw.githubusercontent.com/d3/d3-drag/master/img/voronoi.png"width="420"height="219">](https://observablehq.com/@d3/circle-dragging-iii)[<imgalt="CircleDraggingII"src="https://raw.githubusercontent.com/d3/d3-drag/master/img/canvas.png"width="420"height="219">](https://observablehq.com/@d3/circle-dragging-ii)Thedragbehaviorunifiesmouseandtouchinputandavoidsbrowserquirks.Inthefuturethedragbehaviorwillsupport[PointerEvents](https://www.w3.org/TR/pointerevents/),too.##drag(){#drag}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·Createsanewdragbehavior.Thereturnedbehavior,[*drag*](#_drag),isbothanobjectandafunction,andistypicallyappliedtoselectedelementsvia[*selection*.call](./d3-selection/control-flow.md#selection_call).```jsconstdrag=d3.drag();```##*drag*(*selection*){#_drag}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·Appliesthisdragbehaviortothespecified[*selection*](./d3-selection.md).Thisfunctionistypicallynotinvokeddirectly,andisinsteadinvokedvia[*selection*.call](./d3-selection/control-flow.md#selection_call).Forexample,toinstantiateadragbehaviorandapplyittoaselection:```jsd3.selectAll(".node").call(d3.drag().on("start",started));```Internally,thedragbehavioruses[*selection*.on](./d3-selection/events.md#selection_on)tobindthenecessaryeventlistenersfordragging.Thelistenersusethename`.drag`,soyoucansubsequentlyunbindthedragbehaviorasfollows:```jsselection.on(".drag",null);```Applyingthedragbehavioralsosetsthe[-webkit-tap-highlight-color](https://developer.apple.com/library/mac/documentation/AppleApplications/Reference/SafariWebContent/AdjustingtheTextSize/AdjustingtheTextSize.html#//apple_ref/doc/uid/TP40006510-SW5)styletotransparent,disablingthetaphighlightoniOS.Ifyouwantadifferenttaphighlightcolor,removeorre-applythisstyleafterapplyingthedragbehavior.##*drag*.container(*container*){#drag_container}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·If*container*isspecified,setsthecontaineraccessortothespecifiedobjectorfunctionandreturnsthedragbehavior.If*container*isnotspecified,returnsthecurrentcontaineraccessor,whichdefaultsto:```jsfunctioncontainer(){returnthis.parentNode;}```The*container*ofadraggesturedeterminesthecoordinatesystemofsubsequent[dragevents](#drag-events),affecting*event*.xand*event*.y.Theelementreturnedbythecontaineraccessorissubsequentlypassedto[pointer](./d3-selection/events.md#pointer)todeterminethelocalcoordinatesofthepointer.Thedefaultcontaineraccessorreturnstheparentnodeoftheelementintheoriginatingselection(see[*drag*](#_drag))thatreceivedtheinitiatinginputevent.ThisisoftenappropriatewhendraggingSVGorHTMLelements,sincethoseelementsaretypicallypositionedrelativetoaparent.FordragginggraphicalelementswithaCanvas,however,youmaywanttoredefinethecontainerastheinitiatingelementitself:```jsfunctioncontainer(){returnthis;}```Alternatively,thecontainermaybespecifiedastheelementdirectly,suchas`drag.container(canvas)`.##*drag*.filter(*filter*){#drag_filter}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·If*filter*isspecified,setstheeventfiltertothespecifiedfunctionandreturnsthedragbehavior.If*filter*isnotspecified,returnsthecurrentfilter,whichdefaultsto:```jsfunctionfilter(event){return!event.ctrlKey&&!event.button;}```Ifthefilterreturnsfalsey,theinitiatingeventisignoredandnodraggesturesarestarted.Thus,thefilterdetermineswhichinputeventsareignored;thedefaultfilterignoresmousedowneventsonsecondarybuttons,sincethosebuttonsaretypicallyintendedforotherpurposes,suchasthecontextmenu.##*drag*.touchable(*touchable*){#drag_touchable}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·If*touchable*isspecified,setsthetouchsupportdetectortothespecifiedfunctionandreturnsthedragbehavior.If*touchable*isnotspecified,returnsthecurrenttouchsupportdetector,whichdefaultsto:```jsfunctiontouchable(){returnnavigator.maxTouchPoints||("ontouchstart"inthis);}```Toucheventlistenersareonlyregisteredifthedetectorreturnstruthyforthecorrespondingelementwhenthedragbehavioris[applied](#_drag).Thedefaultdetectorworkswellformostbrowsersthatarecapableoftouchinput,butnotall;Chrome’smobiledeviceemulator,forexample,failsdetection.##*drag*.subject(*subject*){#drag_subject}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·If*subject*isspecified,setsthesubjectaccessortothespecifiedobjectorfunctionandreturnsthedragbehavior.If*subject*isnotspecified,returnsthecurrentsubjectaccessor,whichdefaultsto:```jsfunctionsubject(event,d){returnd==null?{x:event.x,y:event.y}:d;}```The*subject*ofadraggesturerepresents*thethingbeingdragged*.Itiscomputedwhenaninitiatinginputeventisreceived,suchasamousedownortouchstart,immediatelybeforethedraggesturestarts.Thesubjectisthenexposedas*event*.subjectonsubsequent[dragevents](#drag-events)forthisgesture.Thedefaultsubjectisthe[datum](./d3-selection/joining.md#selection_datum)oftheelementintheoriginatingselection(see[*drag*](#_drag))thatreceivedtheinitiatinginputevent;ifthisdatumisundefined,anobjectrepresentingthecoordinatesofthepointeriscreated.WhendraggingcircleelementsinSVG,thedefaultsubjectisthusthedatumofthecirclebeingdragged.With[Canvas](https://html.spec.whatwg.org/multipage/scripting.html#the-canvas-element),thedefaultsubjectisthecanvaselement’sdatum(regardlessofwhereonthecanvasyouclick).Inthiscase,acustomsubjectaccessorwouldbemoreappropriate,suchasonethatpickstheclosestcircletothemousewithinagivensearch*radius*:```jsfunctionsubject(event){letn=circles.length,i,dx,dy,d2,s2=radius*radius,circle,subject;for(i=0;i<n;++i){circle=circles[i];dx=event.x-circle.x;dy=event.y-circle.y;d2=dx*dx+dy*dy;if(d2<s2)subject=circle,s2=d2;}returnsubject;}```:::tipIfnecessary,theabovecanbeacceleratedusing[*quadtree*.find](./d3-quadtree.md#quadtree_find),[*simulation*.find](./d3-force/simulation.md#simulation_find)or[*delaunay*.find](./d3-delaunay/delaunay.md#delaunay_find).:::Thereturnedsubjectshouldbeanobjectthatexposes`x`and`y`properties,sothattherelativepositionofthesubjectandthepointercanbepreservedduringthedraggesture.Ifthesubjectisnullorundefined,nodraggestureisstartedforthispointer;however,otherstartingtouchesmayyetstartdraggestures.Seealso[*drag*.filter](#drag_filter).Thesubjectofadraggesturemaynotbechangedafterthegesturestarts.Thesubjectaccessorisinvokedwiththesamecontextandargumentsas[*selection*.on](./d3-selection/events.md#selection_on)listeners:thecurrentevent(`event`)anddatum`d`,withthe`this`contextasthecurrentDOMelement.Duringtheevaluationofthesubjectaccessor,`event`isabeforestart[dragevent](#drag-events).Use*event*.sourceEventtoaccesstheinitiatinginputeventand*event*.identifiertoaccessthetouchidentifier.The*event*.xand*event*.yarerelativetothe[container](#drag_container),andarecomputedusing[pointer](./d3-selection/events.md#pointer).##*drag*.clickDistance(*distance*){#drag_clickDistance}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·If*distance*isspecified,setsthemaximumdistancethatthemousecanmovebetweenmousedownandmouseupthatwilltriggerasubsequentclickevent.Ifatanypointbetweenmousedownandmouseupthemouseisgreaterthanorequalto*distance*fromitspositiononmousedown,theclickeventfollowingmouseupwillbesuppressed.If*distance*isnotspecified,returnsthecurrentdistancethreshold,whichdefaultstozero.Thedistancethresholdismeasuredinclientcoordinates([*event*.clientX](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/clientX)and[*event*.clientY](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/clientY)).##*drag*.on(*typenames*,*listener*){#drag_on}[Source](https://github.com/d3/d3-drag/blob/main/src/drag.js)·If*listener*isspecified,setstheevent*listener*forthespecified*typenames*andreturnsthedragbehavior.Ifaneventlistenerwasalreadyregisteredforthesametypeandname,theexistinglistenerisremovedbeforethenewlistenerisadded.If*listener*isnull,removesthecurrenteventlistenersforthespecified*typenames*,ifany.If*listener*isnotspecified,returnsthefirstcurrently-assignedlistenermatchingthespecified*typenames*,ifany.Whenaspecifiedeventisdispatched,each*listener*willbeinvokedwiththesamecontextandargumentsas[*selection*.on](./d3-selection/events.md#selection_on)listeners:thecurrentevent(`event`)anddatum`d`,withthe`this`contextasthecurrentDOMelement.The*typenames*isastringcontainingoneormore*typename*separatedbywhitespace.Each*typename*isa*type*,optionallyfollowedbyaperiod(`.`)anda*name*,suchas`drag.foo`and`drag.bar`;thenameallowsmultiplelistenerstoberegisteredforthesame*type*.The*type*mustbeoneofthefollowing:*`start`-afteranewpointerbecomesactive(onmousedownortouchstart).*`drag`-afteranactivepointermoves(onmousemoveortouchmove).*`end`-afteranactivepointerbecomesinactive(onmouseup,touchendortouchcancel).See[*dispatch*.on](./d3-dispatch.md#dispatch_on)formore.Changestoregisteredlistenersvia*drag*.onduringadraggesture*donotaffect*thecurrentdraggesture.Instead,youmustuse[*event*.on](#event_on),whichalsoallowsyoutoregistertemporaryeventlistenersforthecurrentdraggesture.**Separateeventsaredispatchedforeachactivepointer**duringadraggesture.Forexample,ifsimultaneouslydraggingmultiplesubjectswithmultiplefingers,astarteventisdispatchedforeachfinger,evenifbothfingersstarttouchingsimultaneously.See[DragEvents](#drag-events)formore.##dragDisable(*window*){#dragDisable}[Source](https://github.com/d3/d3-drag/blob/main/src/nodrag.js)·Preventsnativedrag-and-dropandtextselectiononthespecified*window*.Asanalternativetopreventingthedefaultactionofmousedownevents(see[#9](https://github.com/d3/d3-drag/issues/9)),thismethodpreventsundesirabledefaultactionsfollowingmousedown.Insupportedbrowsers,thismeanscapturingdragstartandselectstartevents,preventingtheassociateddefaultactions,andimmediatelystoppingtheirpropagation.Inbrowsersthatdonotsupportselectionevents,theuser-selectCSSpropertyissettononeonthedocumentelement.Thismethodisintendedtobecalledonmousedown,followedby[dragEnable](#dragEnable)onmouseup.##dragEnable(*window*,*noclick*){#dragEnable}[Source](https://github.com/d3/d3-drag/blob/main/src/nodrag.js)·Allowsnativedrag-and-dropandtextselectiononthespecified*window*;undoestheeffectof[dragDisable](#dragDisable).Thismethodisintendedtobecalledonmouseup,precededby[dragDisable](#dragDisable)onmousedown.If*noclick*istrue,thismethodalsotemporarilysuppressesclickevents.Thesuppressionofclickeventsexpiresafterazero-millisecondtimeout,suchthatitonlysuppresstheclickeventthatwouldimmediatelyfollowthecurrentmouseupevent,ifany.##DrageventsWhena[drageventlistener](#drag_on)isinvoked,itreceivesthecurrentdrageventasitsfirstargument.The*event*objectexposesseveralfields:*`target`-theassociated[dragbehavior](#drag).*`type`-thestring“start”,“drag”or“end”;see[*drag*.on](#drag_on).*`subject`-thedragsubject,definedby[*drag*.subject](#drag_subject).*`x`-thenew*x*-coordinateofthesubject;see[*drag*.container](#drag_container).*`y`-thenewycoordinateofthesubject;see[*drag*.container](#drag_container).*`dx`-thechangein*x*-coordinatesincethepreviousdragevent.*`dy`-thechangeinycoordinatesincethepreviousdragevent.*`identifier`-thestring“mouse”,oranumeric[touchidentifier](https://www.w3.org/TR/touch-events/#widl-Touch-identifier).*`active`-thenumberofcurrentlyactivedraggestures(onstartandend,notincludingthisone).*`sourceEvent`-theunderlyinginputevent,suchasmousemoveortouchmove.The*event*.activefieldisusefulfordetectingthefirststarteventandthelastendeventinasequenceofconcurrentdraggestures:itiszerowhenthefirstdraggesturestarts,andzerowhenthelastdraggestureends.The*event*objectalsoexposesthe[*event*.on](#event_on)method.Thistabledescribeshowthedragbehaviorinterpretsnativeevents:|Event|ListeningElement|DragEvent|DefaultPrevented?||------------|-----------------|----------|------------------||mousedown⁵|selection|start|no¹||mousemove²|window¹|drag|yes||mouseup²|window¹|end|yes||dragstart²|window|-|yes||selectstart²|window|-|yes||click³|window|-|yes||touchstart|selection|start|no⁴||touchmove|selection|drag|yes||touchend|selection|end|no⁴||touchcancel|selection|end|no⁴|Thepropagationofallconsumedeventsis[immediatelystopped](https://dom.spec.whatwg.org/#dom-event-stopimmediatepropagation).Ifyouwanttopreventsomeeventsfrominitiatingadraggesture,use[*drag*.filter](#drag_filter).¹Necessarytocaptureeventsoutsideaniframe;see[#9](https://github.com/d3/d3-drag/issues/9).<br>²Onlyappliesduringanactive,mouse-basedgesture;see[#9](https://github.com/d3/d3-drag/issues/9).<br>³Onlyappliesimmediatelyaftersomemouse-basedgestures;see[*drag*.clickDistance](#drag_clickDistance).<br>⁴Necessarytoallow[clickemulation](https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/HandlingEvents/HandlingEvents.html#//apple_ref/doc/uid/TP40006511-SW7)ontouchinput;see[#9](https://github.com/d3/d3-drag/issues/9).<br>⁵Ignoredifwithin500msofatouchgestureending;assumes[clickemulation](https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/HandlingEvents/HandlingEvents.html#//apple_ref/doc/uid/TP40006511-SW7).##*event*.on(*typenames*,*listener*){#event_on}[Source](https://github.com/d3/d3-drag/blob/main/src/event.js)·Equivalentto[*drag*.on](#drag_on),butonlyappliestothecurrentdraggesture.Beforethedraggesturestarts,a[copy](./d3-dispatch.md#dispatch_copy)ofthecurrentdrag[eventlisteners](#drag_on)ismade.Thiscopyisboundtothecurrentdraggestureandmodifiedby*event*.on.Thisisusefulfortemporarylistenersthatonlyreceiveeventsforthecurrentdraggesture.Forexample,thisstarteventlistenerregisterstemporarydragandendeventlistenersasclosures:```jsfunctionstarted(event){constcircle=d3.select(this).classed("dragging",true);constdragged=(event,d)=>circle.raise().attr("cx",d.x=event.x).attr("cy",d.y=event.y);constended=()=>circle.classed("dragging",false);event.on("drag",dragged).on("end",ended);}```