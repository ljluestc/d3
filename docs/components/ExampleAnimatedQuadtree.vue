<scriptsetup>import*asd3from"d3";importquadtree_visitParentfrom"./quadtreeVisitParent.js";</script><script>constwidth=688;constheight=width;asyncfunctionrender(node,{points}){consttree=d3.quadtree([],(i)=>points[i][0],(i)=>points[i][1]);tree.cover(d3.min(points,([x])=>x),d3.min(points,([,y])=>y));tree.cover(d3.max(points,([x])=>x),d3.max(points,([,y])=>y));constx=d3.scaleLinear([tree._x0,tree._x1],[0.5,width-0.5]);consty=d3.scaleLinear([tree._y0,tree._y1],[height-0.5,0.5]);constsvg=d3.select(node);constg=svg.append("g").attr("stroke","currentColor").attr("fill","none");g.append("rect").attr("x",x(tree._x0)).attr("y",y(tree._y1)).attr("width",x(tree._x1)-x(tree._x0)).attr("height",y(tree._y0)-y(tree._y1));constnodes=newSet();for(leti=0;i<points.length;++i){tree.add(i);lett=svg.transition();svg.append("circle").attr("fill","currentColor").attr("stroke","var(--vp-c-bg-alt)").attr("cx",x(points[i][0])).attr("cy",y(points[i][1])).attr("r",0).transition(t).attr("r",2.5);quadtree_visitParent.call(tree,(x0,y0,x1,y1)=>{constkey=[x0,y0,x1,y1].join();if(nodes.has(key))return;nodes.add(key);t=t.transition();constxm=(x0+x1)/2;constym=(y0+y1)/2;g.append("line").attr("x1",x(xm)).attr("y1",y(ym)).attr("x2",x(xm)).attr("y2",y(ym)).transition(t).attr("x1",x(x0));g.append("line").attr("x1",x(xm)).attr("y1",y(ym)).attr("x2",x(xm)).attr("y2",y(ym)).transition(t).attr("x2",x(x1));g.append("line").attr("x1",x(xm)).attr("y1",y(ym)).attr("x2",x(xm)).attr("y2",y(ym)).transition(t).attr("y1",y(y0));g.append("line").attr("x1",x(xm)).attr("y1",y(ym)).attr("x2",x(xm)).attr("y2",y(ym)).transition(t).attr("y2",y(y1));});awaitt.end();if(!node.isConnected)return;}}exportdefault{props:{points:{type:Array,default:[]},},mounted(){render(this.$el.querySelector("svg"),this);}}</script><template><divstyle="margin:1em0;"><svg:width="width":height="height":viewBox="[0,0,width,height].join('')"style="max-width:100%;height:auto;"></svg><ahref="https://observablehq.com/@d3/animated-quadtree?intent=fork"style="font-size:smaller;"target="_blank">Fork↗︎</a></div></template>