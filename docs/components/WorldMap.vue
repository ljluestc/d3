<scriptsetup>import*asd3from"d3";import*astopojsonfrom"topojson-client";importdeferRenderfrom"./deferRender.js";</script><script>constoutline={type:"Sphere"};constgraticule=d3.geoGraticule10();letlandPromises={};asyncfunctionrender(node,{projection,rotate,resolution,width,feature}){feature=awaitfeature;rotate=rotate&&resolution==="110m"&&projection.rotate();constpath=d3.geoPath(projection);constsvg=d3.select(node);letframe;letx0=0;letx1=0;functionupdate(){svg.selectAll("[name='outline']").attr("d",path(outline));svg.selectAll("[name='graticule']").attr("d",path(graticule));svg.selectAll("[name='feature']").attr("d",path(feature));}svg.on("pointerenter",rotate&&((event)=>{constdx=x1-x0;([x1]=d3.pointer(event));x0=x1-dx;//donâ€™tjumponpointerenter})).on("pointermove",rotate&&((event)=>{if(!frame)frame=requestAnimationFrame(rerender);([x1]=d3.pointer(event));}));functionrerender(){frame=null;projection.rotate([rotate[0]+(x1-x0)/width*20,rotate[1],rotate[2]]);update();}update();}exportdefault{props:{projection:{type:Function},land:{type:Boolean,default:true},rotate:{type:Boolean,default:false},resolution:{type:String,default:"110m"},width:{type:Number,default:688},height:{type:Number,default:400},},mounted(){if(this.land)this.feature=landPromises[this.resolution]??=d3.json(`https://cdn.jsdelivr.net/npm/world-atlas@2.0.2/land-${this.resolution}.json`).then((world)=>topojson.feature(world,world.objects.land));this.disconnect=deferRender(this.$el,async()=>render(this.$el,this));},updated(){render(this.$el,this);},unmounted(){if(this.disconnect)this.disconnect();}}</script><template><svg:width="width":height="height":viewBox="[0,0,width,height].join('')"style="max-width:100%;height:auto;"><pathname="outline"fill="var(--vp-c-bg-alt)"/><pathname="graticule"stroke="currentColor"stroke-opacity="0.2"fill="none"/><pathname="feature"fill="currentColor"/><pathname="outline"stroke="currentColor"fill="none"/></svg></template>