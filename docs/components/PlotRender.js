import*asPlotfrom"@observablehq/plot";import{h,withDirectives}from"vue";classDocument{constructor(){this.documentElement=newElement(this,"html");}createElementNS(namespace,tagName){returnnewElement(this,tagName);}createElement(tagName){returnnewElement(this,tagName);}createTextNode(value){returnnewTextNode(this,value);}querySelector(){returnnull;}querySelectorAll(){return[];}}classStyle{staticempty=newStyle();setProperty(){}removeProperty(){}}classElement{constructor(ownerDocument,tagName){this.ownerDocument=ownerDocument;this.tagName=tagName;this.attributes={};this.children=[];this.parentNode=null;}setAttribute(name,value){this.attributes[name]=String(value);}setAttributeNS(namespace,name,value){this.setAttribute(name,value);}getAttribute(name){returnthis.attributes[name];}getAttributeNS(name){returnthis.getAttribute(name);}hasAttribute(name){returnnameinthis.attributes;}hasAttributeNS(name){returnthis.hasAttribute(name);}removeAttribute(name){deletethis.attributes[name];}removeAttributeNS(namespace,name){this.removeAttribute(name);}addEventListener(){//ignored;interactionneedsrealDOM}removeEventListener(){//ignored;interactionneedsrealDOM}dispatchEvent(){//ignored;interactionneedsrealDOM}appendChild(child){this.children.push(child);child.parentNode=this;returnchild;}insertBefore(child,after){if(after==null){this.children.push(child);}else{consti=this.children.indexOf(after);if(i<0)thrownewError("insertBeforereferencenodenotfound");this.children.splice(i,0,child);}child.parentNode=this;returnchild;}querySelector(){returnnull;}querySelectorAll(){return[];}settextContent(value){this.children=[this.ownerDocument.createTextNode(value)];}setstyle(value){this.attributes.style=value;}getstyle(){returnStyle.empty;}toHyperScript(){returnh(this.tagName,this.attributes,this.children.map((c)=>c.toHyperScript()));}}classTextNode{constructor(ownerDocument,nodeValue){this.ownerDocument=ownerDocument;this.nodeValue=String(nodeValue);}toHyperScript(){returnthis.nodeValue;}}//ConvertstherealDOMtovirtualDOM(forclient-sidehydration).functiontoHyperScript(node){if(node.nodeType===3)returnnode.nodeValue;//TextNodeconstprops={};for(constnameofnode.getAttributeNames())props[name]=node.getAttribute(name);constchildren=[];for(letchild=node.firstChild;child;child=child.nextSibling)children.push(toHyperScript(child));returnh(node.tagName,props,children);}exportdefault{props:{options:Object,mark:Object,defer:Boolean,method:{type:String,default:"plot"}},render(){const{method}=this;constoptions={...(method==="plot"&&{marks:this.mark==null?[]:[this.mark],width:688//betterdefaultforVitePress}),...this.options,className:"plot"};if(this.defer){constmounted=(el)=>{disconnect();//removeoldlistenersfunctionobserved(){unmounted(el);//removeoldplot(andlisteners)el.append(Plot[method](options));}constrect=el.getBoundingClientRect();if(rect.bottom>0&&rect.top<window.innerHeight){observed();}else{this._observer=newIntersectionObserver(([entry])=>{if(entry.isIntersecting)observed();},{rootMargin:"100px"});this._observer.observe(el);if(typeofrequestIdleCallback==="function"){this._idling=requestIdleCallback(observed);}}};constunmounted=(el)=>{while(el.lastChild)el.lastChild.remove();disconnect();};constdisconnect=()=>{if(this._observer!==undefined){this._observer.disconnect();this._observer=undefined;}if(this._idling!==undefined){cancelIdleCallback(this._idling);this._idling=undefined;}};const{height=400}=this.options;returnwithDirectives(h("span",method==="plot"?[h("div",{style:{maxWidth:"100%",width:`688px`,aspectRatio:`688/${height}`}})]:[]),[[{mounted,updated:mounted,unmounted}]]);}if(typeofdocument!=="undefined"){constplot=Plot[method](options);constreplace=(el)=>el.firstChild.replaceWith(plot);returnwithDirectives(h("span",[toHyperScript(plot)]),[[{mounted:replace,updated:replace}]]);}returnh("span",[Plot[method]({...options,document:newDocument()}).toHyperScript()]);}};