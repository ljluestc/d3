#HierarchiesBeforeyoucancomputea[hierarchicallayout](../d3-hierarchy.md),youneedarootnode.Ifyourdataisalreadyinahierarchicalformat,suchasJSON,youcanpassitdirectlyto[hierarchy](#hierarchy);otherwise,youcanrearrangetabulardata,suchascomma-separatedvalues(CSV),intoahierarchyusing[stratify](./stratify.md).##hierarchy(*data*,*children*){#hierarchy}[Examples](https://observablehq.com/@d3/d3-hierarchy)·[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/index.js)·Constructsarootnodefromthespecifiedhierarchical*data*.Thespecified*data*mustbeanobjectrepresentingtherootnode.Forexample:```jsconstdata={name:"Eve",children:[{name:"Cain"},{name:"Seth",children:[{name:"Enos"},{name:"Noam"}]},{name:"Abel"},{name:"Awan",children:[{name:"Enoch"}]},{name:"Azura"}]};```Toconstructahierarchy:```jsconstroot=d3.hierarchy(data);```Thespecified*children*accessorfunctionisinvokedforeachdatum,startingwiththeroot*data*,andmustreturnaniterableofdatarepresentingthechildren,ifany.Ifthechildrenaccessorisnotspecified,itdefaultsto:```jsfunctionchildren(d){returnd.children;}```If*data*isaMap,itisimplicitlyconvertedtotheentry[undefined,*data*],andthechildrenaccessorinsteaddefaultsto:```jsfunctionchildren(d){returnArray.isArray(d)?d[1]:null;}```Thisallowsyoutopasstheresultof[group](../d3-array/group.md#group)or[rollup](../d3-array/group.md#rollup)tohierarchy.Thereturnedrootnodeandeachdescendanthasthefollowingproperties:**node*.data-theassociateddataaspassedto[hierarchy](#hierarchy)**node*.depth-zerofortheroot,increasingbyoneforeachdescendantgeneration**node*.height-thegreatestdistancefromanydescendantleaf,orzeroforleaves**node*.parent-theparentnode,ornullfortherootnode**node*.children-anarrayofchildnodes,ifany,orundefinedforleaves**node*.value-theoptionalsummedvalueofthenodeandits[descendants](#node_descendants)Thismethodcanalsobeusedtotestifanodeisan`instanceofd3.hierarchy`andtoextendthenodeprototype.##*node*.ancestors(){#node_ancestors}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/ancestors.js)·Returnsthearrayofancestorsnodes,startingwiththisnode,thenfollowedbyeachparentuptotheroot.##*node*.descendants(){#node_descendants}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/descendants.js)·Returnsthearrayofdescendantnodes,startingwiththisnode,thenfollowedbyeachchildintopologicalorder.##*node*.leaves(){#node_leaves}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/leaves.js)·Returnsthearrayofleafnodesintraversalorder.A*leaf*isanodewithnochildren.##*node*.find(*filter*){#node_find}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/find.js)·Returnsthefirstnodeinthehierarchyfromthis*node*forwhichthespecified*filter*returnsatruthyvalue.Returnsundefinedifnosuchnodeisfound.##*node*.path(*target*){#node_path}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/path.js)·Returnstheshortestpaththroughthehierarchyfromthis*node*tothespecified*target*node.Thepathstartsatthis*node*,ascendstotheleastcommonancestorofthis*node*andthe*target*node,andthendescendstothe*target*node.Thisisusefulfor[hierarchicaledgebundling](https://observablehq.com/@d3/hierarchical-edge-bundling).##*node*.links(){#node_links}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/links.js)·Returnsanarrayoflinksforthis*node*anditsdescendants,whereeach*link*isanobjectthatdefinessourceandtargetproperties.Thesourceofeachlinkistheparentnode,andthetargetisachildnode.##*node*.sum(*value*){#node_sum}[Examples](https://observablehq.com/@d3/visiting-a-d3-hierarchy)·[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/sum.js)·Evaluatesthespecified*value*functionforthis*node*andeachdescendantin[post-ordertraversal](#node_eachAfter),andreturnsthis*node*.The*node*.valuepropertyofeachnodeissettothenumericvaluereturnedbythespecifiedfunctionplusthecombinedvalueofallchildren.Thefunctionispassedthenode’sdata,andmustreturnanon-negativenumber.The*value*accessorisevaluatedfor*node*andeverydescendant,includinginternalnodes;ifyouonlywantleafnodestohaveinternalvalue,thenreturnzeroforanynodewithchildren.[Forexample](https://observablehq.com/@d3/treemap-by-count),asanalternativeto[*node*.count](#node_count):```jsroot.sum((d)=>d.value?1:0);```Youmustcall*node*.sumor[*node*.count](#node_count)beforeinvokingahierarchicallayoutthatrequires*node*.value,suchas[treemap](./treemap.md).Forexample:```js//Constructthetreemaplayout.consttreemap=d3.treemap();treemap.size([width,height]);treemap.padding(2);//Sumandsortthedata.root.sum((d)=>d.value);root.sort((a,b)=>b.height-a.height||b.value-a.value);//Computethetreemaplayout.treemap(root);//Retrievealldescendantnodes.constnodes=root.descendants();```SincetheAPIsupports[methodchaining](https://en.wikipedia.org/wiki/Method_chaining),youcanalsosay:```jsd3.treemap().size([width,height]).padding(2)(root.sum((d)=>d.value).sort((a,b)=>b.height-a.height||b.value-a.value)).descendants()```Thisexampleassumesthatthenodedatahasavaluefield.##*node*.count(){#node_count}[Examples](https://observablehq.com/@d3/visiting-a-d3-hierarchy)·[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/count.js)·Computesthenumberofleavesunderthis*node*andassignsitto*node*.value,andsimilarlyforeverydescendantof*node*.Ifthis*node*isaleaf,itscountisone.Returnsthis*node*.Seealso[*node*.sum](#node_sum).##*node*.sort(compare){#node_sort}[Examples](https://observablehq.com/@d3/visiting-a-d3-hierarchy)·[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/sort.js)·Sortsthechildrenofthis*node*,ifany,andeachofthis*node*’sdescendants’children,in[pre-ordertraversal](#node_eachBefore)usingthespecified*compare*function,andreturnsthis*node*.Thespecifiedfunctionispassedtwonodes*a*and*b*tocompare.If*a*shouldbebefore*b*,thefunctionmustreturnavaluelessthanzero;if*b*shouldbebefore*a*,thefunctionmustreturnavaluegreaterthanzero;otherwise,therelativeorderof*a*and*b*arenotspecified.See[*array*.sort](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort)formore.Unlike[*node*.sum](#node_sum),the*compare*functionispassedtwo[nodes](#hierarchy)ratherthantwonodes’data.Forexample,ifthedatahasavalueproperty,thissortsnodesbythedescendingaggregatevalueofthenodeandallitsdescendants,asisrecommendedfor[circle-packing](./pack.md):```jsroot.sum((d)=>d.value).sort((a,b)=>b.value-a.value);```Similarly,tosortnodesbydescendingheight(greatestdistancefromanydescendantleaf)andthendescendingvalue,asisrecommendedfor[treemaps](./treemap.md)and[icicles](./partition.md):```jsroot.sum((d)=>d.value).sort((a,b)=>b.height-a.height||b.value-a.value);```Tosortnodesbydescendingheightandthenascendingid,asisrecommendedfor[trees](./tree.md)and[dendrograms](./cluster.md):```jsroot.sum((d)=>d.value).sort((a,b)=>b.height-a.height||d3.ascending(a.id,b.id));```Youmustcall*node*.sortbeforeinvokingahierarchicallayoutifyouwantthenewsortordertoaffectthelayout;see[*node*.sum](#node_sum)foranexample.##node[Symbol.iterator]\(\){#node_iterator}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/iterator.js)·Returnsaniteratoroverthe*node*’sdescendantsinbreadth-firstorder.Forexample:```jsfor(constdescendantofnode){console.log(descendant);}```##*node*.each(*function*,*that*){#node_each}[Examples](https://observablehq.com/@d3/visiting-a-d3-hierarchy)·[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/each.js)·Invokesthespecified*function*for*node*andeachdescendantin[breadth-firstorder](https://en.wikipedia.org/wiki/Breadth-first_search),suchthatagiven*node*isonlyvisitedifallnodesoflesserdepthhavealreadybeenvisited,aswellasallprecedingnodesofthesamedepth.Thespecifiedfunctionispassedthecurrent*descendant*,thezero-basedtraversal*index*,andthis*node*.If*that*isspecified,itisthethiscontextofthecallback.##*node*.eachAfter(*function*,*that*){#node_eachAfter}[Examples](https://observablehq.com/@d3/visiting-a-d3-hierarchy)·[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/eachAfter.js)·Invokesthespecified*function*for*node*andeachdescendantin[post-ordertraversal](https://en.wikipedia.org/wiki/Tree_traversal#Post-order),suchthatagiven*node*isonlyvisitedafterallofitsdescendantshavealreadybeenvisited.Thespecifiedfunctionispassedthecurrent*descendant*,thezero-basedtraversal*index*,andthis*node*.If*that*isspecified,itisthethiscontextofthecallback.##*node*.eachBefore(*function*,*that*){#node_eachBefore}[Examples](https://observablehq.com/@d3/visiting-a-d3-hierarchy)·[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/eachBefore.js)·Invokesthespecified*function*for*node*andeachdescendantin[pre-ordertraversal](https://en.wikipedia.org/wiki/Tree_traversal#Pre-order),suchthatagiven*node*isonlyvisitedafterallofitsancestorshavealreadybeenvisited.Thespecifiedfunctionispassedthecurrent*descendant*,thezero-basedtraversal*index*,andthis*node*.If*that*isspecified,itisthethiscontextofthecallback.##*node*.copy(){#node_copy}[Source](https://github.com/d3/d3-hierarchy/blob/main/src/hierarchy/index.js)·Returnadeepcopyofthesubtreestartingatthis*node*.(Thereturneddeepcopysharesthesamedata,however.)Thereturnednodeistherootofanewtree;thereturnednode’sparentisalwaysnullanditsdepthisalwayszero.