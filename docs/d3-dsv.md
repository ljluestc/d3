#d3-dsvThismoduleprovidesaparserandformatterfordelimiter-separatedvalues,mostcommonly[comma-separatedvalues](https://en.wikipedia.org/wiki/Comma-separated_values)(CSV)ortab-separatedvalues(TSV).ThesetabularformatsarepopularwithspreadsheetprogramssuchasMicrosoftExcel,andareoftenmorespace-efficientthanJSON.Thisimplementationisbasedon[RFC4180](http://tools.ietf.org/html/rfc4180).Forexample,toparse:```jsd3.csvParse("foo,bar\n1,2")//[{foo:"1",bar:"2"},columns:["foo","bar"]]``````jsd3.tsvParse("foo\tbar\n1\t2")//[{foo:"1",bar:"2"},columns:["foo","bar"]]```Toformat:```jsd3.csvFormat([{foo:"1",bar:"2"}])//"foo,bar\n1,2"``````jsd3.tsvFormat([{foo:"1",bar:"2"}])//"foo\tbar\n1\t2"```Touseadifferentdelimiter,suchas“|”forpipe-separatedvalues,use[d3.dsvFormat](#dsvFormat):```jsd3.dsvFormat("|").parse("foo|bar\n1|2"))//[{foo:"1",bar:"2"},columns:["foo","bar"]]```ForeasyloadingofDSVfilesinabrowser,see[d3-fetch](./d3-fetch.md)’s[d3.csv](./d3-fetch.md#csv),[d3.tsv](./d3-fetch.md#tsv)and[d3.dsv](./d3-fetch.md#dsv)methods.##dsvFormat(*delimiter*){#dsvFormat}```jsconstcsv=d3.dsvFormat(",");```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·ConstructsanewDSVparserandformatterforthespecified*delimiter*.The*delimiter*mustbeasinglecharacter(*i.e.*,asingle16-bitcodeunit);so,ASCIIdelimitersarefine,butemojidelimitersarenot.##*dsv*.parse(*string*,*row*){#dsv_parse}:::warningCAUTIONThismethodrequirestheunsafe-eval[contentsecuritypolicy](#content-security-policy).:::```jsd3.csvParse("foo,bar\n1,2")//[{foo:"1",bar:"2"},columns:["foo","bar"]]```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·Parsesthespecified*string*,whichmustbeinthedelimiter-separatedvaluesformatwiththeappropriatedelimiter,returninganarrayofobjectsrepresentingtheparsedrows.Unlike[*dsv*.parseRows](#dsv_parseRows),thismethodrequiresthatthefirstlineoftheDSVcontentcontainsadelimiter-separatedlistofcolumnnames;thesecolumnnamesbecometheattributesonthereturnedobjects.Forexample,considerthefollowingCSVfile:```Year,Make,Model,Length1997,Ford,E350,2.342000,Mercury,Cougar,2.38```TheresultingJavaScriptarrayis:```js[{"Year":"1997","Make":"Ford","Model":"E350","Length":"2.34"},{"Year":"2000","Make":"Mercury","Model":"Cougar","Length":"2.38"}]```Thereturnedarrayalsoexposesa`columns`propertycontainingthecolumnnamesininputorder(incontrasttoObject.keys,whoseiterationorderisarbitrary).Forexample:```jsdata.columns//["Year","Make","Model","Length"]```Ifthecolumnnamesarenotunique,onlythelastvalueisreturnedforeachname;toaccessallvalues,use[*dsv*.parseRows](#dsv_parseRows)instead(see[example](https://observablehq.com/@d3/parse-csv-with-duplicate-column-names)).Ifa*row*conversionfunctionisnotspecified,fieldvaluesarestrings.Forsafety,thereisnoautomaticconversiontonumbers,dates,orothertypes.Insomecases,JavaScriptmaycoercestringstonumbersforyouautomatically(forexample,usingthe`+`operator),butbetteristospecifya*row*conversionfunction.See[d3.autoType](#autoType)foraconvenient*row*conversionfunctionthatinfersandcoercescommontypeslikenumbersandstrings.Ifa*row*conversionfunctionisspecified,thespecifiedfunctionisinvokedforeachrow,beingpassedanobjectrepresentingthecurrentrow(`d`),theindex(`i`)startingatzeroforthefirstnon-headerrow,andthearrayofcolumnnames.Ifthereturnedvalueisnullorundefined,therowisskippedandwillbeomittedfromthearrayreturnedby*dsv*.parse;otherwise,thereturnedvaluedefinesthecorrespondingrowobject.Forexample:```jsconstdata=d3.csvParse(string,(d)=>{return{year:newDate(+d.Year,0,1),//lowercaseandconvert"Year"toDatemake:d.Make,//lowercasemodel:d.Model,//lowercaselength:+d.Length//lowercaseandconvert"Length"tonumber};});```Note:using`+`or`Number`ratherthan[parseInt](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/parseInt)or[parseFloat](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/parseFloat)istypicallyfaster,thoughmorerestrictive.Forexample,`"30px"`whencoercedusing`+`returns`NaN`,whileparseIntandparseFloatreturn`30`.##*dsv*.parseRows(*string*,*row*){#dsv_parseRows}```jsd3.csvParseRows("foo,bar\n1,2")//[["foo","bar"],["1","2"]]```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·Parsesthespecified*string*,whichmustbeinthedelimiter-separatedvaluesformatwiththeappropriatedelimiter,returninganarrayofarraysrepresentingtheparsedrows.Unlike[*dsv*.parse](#dsv_parse),thismethodtreatstheheaderlineasastandardrow,andshouldbeusedwheneverDSVcontentdoesnotcontainaheader.Eachrowisrepresentedasanarrayratherthananobject.Rowsmayhavevariablelength.Forexample,considerthefollowingCSVfile,whichnotablylacksaheaderline:```1997,Ford,E350,2.342000,Mercury,Cougar,2.38```TheresultingJavaScriptarrayis:```js[["1997","Ford","E350","2.34"],["2000","Mercury","Cougar","2.38"]]```Ifa*row*conversionfunctionisnotspecified,fieldvaluesarestrings.Forsafety,thereisnoautomaticconversiontonumbers,dates,orothertypes.Insomecases,JavaScriptmaycoercestringstonumbersforyouautomatically(forexample,usingthe`+`operator),butbetteristospecifya*row*conversionfunction.See[d3.autoType](#autoType)foraconvenient*row*conversionfunctionthatinfersandcoercescommontypeslikenumbersandstrings.Ifa*row*conversionfunctionisspecified,thespecifiedfunctionisinvokedforeachrow,beingpassedanarrayrepresentingthecurrentrow(`d`),theindex(`i`)startingatzeroforthefirstrow,andthearrayofcolumnnames.Ifthereturnedvalueisnullorundefined,therowisskippedandwillbeomittedfromthearrayreturnedby*dsv*.parse;otherwise,thereturnedvaluedefinesthecorrespondingrowobject.Forexample:```jsconstdata=d3.csvParseRows(string,(d,i)=>{return{year:newDate(+d[0],0,1),//convertfirstcolumntoDatemake:d[1],model:d[2],length:+d[3]//convertfourthcolumntonumber};});```Ineffect,*row*issimilartoapplyinga[map](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/map)and[filter](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/filter)operatortothereturnedrows.##*dsv*.format(*rows*,*columns*){#dsv_format}```jsd3.csvFormat([{foo:"1",bar:"2"}])//"foo,bar\n1,2"``````jsd3.csvFormat([{foo:"1",bar:"2"}],["foo"])//"foo\n1"```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·Formatsthespecifiedarrayofobject*rows*asdelimiter-separatedvalues,returningastring.Thisoperationistheinverseof[*dsv*.parse](#dsv_parse).Eachrowwillbeseparatedbyanewline(`\n`),andeachcolumnwithineachrowwillbeseparatedbythedelimiter(suchasacomma,`,`).Valuesthatcontaineitherthedelimiter,adouble-quote(`"`)oranewlinewillbeescapedusingdouble-quotes.If*columns*isnotspecified,thelistofcolumnnamesthatformstheheaderrowisdeterminedbytheunionofallpropertiesonallobjectsin*rows*;theorderofcolumnsisnondeterministic.If*columns*isspecified,itisanarrayofstringsrepresentingthecolumnnames.Forexample:```jsconststring=d3.csvFormat(data,["year","make","model","length"]);```Allfieldsoneachrowobjectwillbecoercedtostrings.Ifthefieldvalueisnullorundefined,theemptystringisused.IfthefieldvalueisaDate,the[ECMAScriptdate-timestringformat](https://www.ecma-international.org/ecma-262/9.0/index.html#sec-date-time-string-format)(asubsetofISO8601)isused:forexample,datesatUTCmidnightareformattedas`YYYY-MM-DD`.Formorecontroloverwhichandhowfieldsareformatted,firstmap*rows*toanarrayofarrayofstring,andthenuse[*dsv*.formatRows](#dsv_formatRows).##*dsv*.formatBody(*rows*,*columns*){#dsv_formatBody}```jsd3.csvFormatBody([{foo:"1",bar:"2"}])//"1,2"``````jsd3.csvFormatBody([{foo:"1",bar:"2"}],["foo"])//"1"```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·Equivalentto[*dsv*.format](#dsv_format),butomitstheheaderrow.Thisisuseful,forexample,whenappendingrowstoanexistingfile.##*dsv*.formatRows(*rows*){#dsv_formatRows}```jsd3.csvFormatRows([["foo","bar"],["1","2"]])//"foo,bar\n1,2"```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·Formatsthespecifiedarrayofarrayofstring*rows*asdelimiter-separatedvalues,returningastring.Thisoperationisthereverseof[*dsv*.parseRows](#dsv_parseRows).Eachrowwillbeseparatedbyanewline(`\n`),andeachcolumnwithineachrowwillbeseparatedbythedelimiter(suchasacomma,`,`).Valuesthatcontaineitherthedelimiter,adouble-quote(")oranewlinewillbeescapedusingdouble-quotes.Toconvertanarrayofobjectstoanarrayofarrayswhileexplicitlyspecifyingthecolumns,use[*array*.map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map).Forexample:```jsconststring=d3.csvFormatRows(data.map((d,i)=>{return[d.year.getUTCFullYear(),//Assumingd.yearisaDateobject.d.make,d.model,d.length];}));```Ifyoulike,youcanalso[*array*.concat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/concat)thisresultwithanarrayofcolumnnamestogeneratethefirstrow:```jsconststring=d3.csvFormatRows([["year","make","model","length"]].concat(data.map((d,i)=>{return[d.year.getUTCFullYear(),//Assumingd.yearisaDateobject.d.make,d.model,d.length];})));```##*dsv*.formatRow(*row*){#dsv_formatRow}```jsd3.csvFormatRow(["foo","bar"])//"foo,bar"```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·Formatsasinglearray*row*ofstringsasdelimiter-separatedvalues,returningastring.Eachcolumnwithintherowwillbeseparatedbythedelimiter(suchasacomma,`,`).Valuesthatcontaineitherthedelimiter,adouble-quote(")oranewlinewillbeescapedusingdouble-quotes.##*dsv*.formatValue(*value*){#dsv_formatValue}```jsd3.csvFormatValue("foo")//"foo"```[Source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js)·Formatasingle*value*orstringasadelimiter-separatedvalue,returningastring.Avaluethatcontainseitherthedelimiter,adouble-quote(")oranewlinewillbeescapedusingdouble-quotes.##csvParse(*string*,*row*){#csvParse}Equivalentto[`d3.dsvFormat(",").parse`](#dsv_parse).##csvParseRows(*string*,*row*){#csvParseRows}Equivalentto[`d3.dsvFormat(",").parseRows`](#dsv_parseRows).##csvFormat(*rows*,*columns*){#csvFormat}Equivalentto[`d3.dsvFormat(",").format`](#dsv_format).##csvFormatBody(*rows*,*columns*){#csvFormatBody}Equivalentto[`d3.dsvFormat(",").formatBody`](#dsv_formatBody).##csvFormatRows(*rows*){#csvFormatRows}Equivalentto[`d3.dsvFormat(",").formatRows`](#dsv_formatRows).##csvFormatRow(*row*){#csvFormatRow}Equivalentto[`d3.dsvFormat(",").formatRow`](#dsv_formatRow).##csvFormatValue(*value*){#csvFormatValue}Equivalentto[`d3.dsvFormat(",").formatValue`](#dsv_formatValue).##tsvParse(*string*,*row*){#tsvParse}Equivalentto[`d3.dsvFormat("\t").parse`](#dsv_parse).##tsvParseRows(*string*,*row*){#tsvParseRows}Equivalentto[`d3.dsvFormat("\t").parseRows`](#dsv_parseRows).##tsvFormat(*rows*,*columns*){#tsvFormat}Equivalentto[`d3.dsvFormat("\t").format`](#dsv_format).##tsvFormatBody(*rows*,*columns*){#tsvFormatBody}Equivalentto[`d3.dsvFormat("\t").formatBody`](#dsv_formatBody).##tsvFormatRows(*rows*){#tsvFormatRows}Equivalentto[`d3.dsvFormat("\t").formatRows`](#dsv_formatRows).##tsvFormatRow(*row*){#tsvFormatRow}Equivalentto[`d3.dsvFormat("\t").formatRow`](#dsv_formatRow).##tsvFormatValue(*value*){#tsvFormatValue}Equivalentto[`d3.dsvFormat("\t").formatValue`](#dsv_formatValue).##autoType(*object*){#autoType}[Source](https://github.com/d3/d3-dsv/blob/main/src/autoType.js)·Givenan*object*(orarray)representingaparsedrow,infersthetypesofvaluesonthe*object*andcoercesthemaccordingly,returningthemutated*object*.Thisfunctionisintendedtobeusedasa*row*accessorfunctioninconjunctionwith[*dsv*.parse](#dsv_parse)and[*dsv*.parseRows](#dsv_parseRows).Forexample,considerthefollowingCSVfile:```Year,Make,Model,Length1997,Ford,E350,2.342000,Mercury,Cougar,2.38```Whenusedwith[d3.csvParse](#csvParse),```jsd3.csvParse(string,d3.autoType)```theresultingJavaScriptarrayis:```js[{"Year":1997,"Make":"Ford","Model":"E350","Length":2.34},{"Year":2000,"Make":"Mercury","Model":"Cougar","Length":2.38}]```Typeinferenceworksasfollows.Foreach*value*inthegiven*object*,the[trimmed](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)valueiscomputed;thevalueisthenre-assignedasfollows:1.Ifempty,then`null`.1.Ifexactly`"true"`,then`true`.1.Ifexactly`"false"`,then`false`.1.Ifexactly`"NaN"`,then`NaN`.1.Otherwise,if[coercibletoanumber](https://www.ecma-international.org/ecma-262/9.0/index.html#sec-tonumber-applied-to-the-string-type),thenanumber.1.Otherwise,ifa[date-onlyordate-timestring](https://www.ecma-international.org/ecma-262/9.0/index.html#sec-date-time-string-format),thenaDate.1.Otherwise,astring(theoriginaluntrimmedvalue).Valueswithleadingzeroesmaybecoercedtonumbers;forexample`"08904"`coercesto`8904`.However,extracharacterssuchascommasorunits(*e.g.*,`"$1.00"`,`"(123)"`,`"1,234"`or`"32px"`)willpreventnumbercoercion,resultinginastring.DatestringsmustbeinECMAScript’ssubsetofthe[ISO8601format](https://en.wikipedia.org/wiki/ISO_8601).Whenadate-onlystringsuchasYYYY-MM-DDisspecified,theinferredtimeismidnightUTC;however,ifadate-timestringsuchasYYYY-MM-DDTHH:MMisspecifiedwithoutatimezone,itisassumedtobelocaltime.Automatictypeinferenceisprimarilyintendedtoprovidesafe,predictablebehaviorinconjunctionwith[*dsv*.format](#dsv_format)and[*dsv*.formatRows](#dsv_formatRows)forcommonJavaScripttypes.Ifyouneeddifferentbehavior,youshouldimplementyourownrowaccessorfunction.Formore,see[thed3.autoTypenotebook](https://observablehq.com/@d3/d3-autotype).##ContentsecuritypolicyIfa[contentsecuritypolicy](http://www.w3.org/TR/CSP/)isinplace,notethat[*dsv*.parse](#dsv_parse)requires`unsafe-eval`inthe`script-src`directive,duetothe(safe)useofdynamiccodegenerationforfastparsing.(See[source](https://github.com/d3/d3-dsv/blob/main/src/dsv.js).)Alternatively,use[*dsv*.parseRows](#dsv_parseRows).##Byte-ordermarksDSVfilessometimesbeginwitha[byteordermark(BOM)](https://en.wikipedia.org/wiki/Byte_order_mark);savingaspreadsheetinCSVUTF-8formatfromMicrosoftExcel,forexample,willincludeaBOM.Onthewebthisisnotusuallyaproblembecausethe[UTF-8decodealgorithm](https://encoding.spec.whatwg.org/#utf-8-decode)specifiedintheEncodingstandardremovestheBOM.Node.js,ontheotherhand,[doesnotremovetheBOM](https://github.com/nodejs/node-v0.x-archive/issues/1918)whendecodingUTF-8.IftheBOMisnotremoved,thefirstcharacterofthetextisazero-widthnon-breakingspace.SoifaCSVfilewithaBOMisparsedby[d3.csvParse](#csvParse),thefirstcolumn’snamewillbeginwithazero-widthnon-breakingspace.Thiscanbehardtospotsincethischaracterisusuallyinvisiblewhenprinted.ToremovetheBOMbeforeparsing,considerusing[strip-bom](https://www.npmjs.com/package/strip-bom).