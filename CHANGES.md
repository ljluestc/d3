#ChangesinD37.0[ReleasedJune11,2021.](https://github.com/d3/d3/releases/tag/v7.0.0)*Thisdocumentcoversonlymajorchanges.Forminorandpatchchanges,pleaseseethe[releasenotes](https://github.com/d3/d3/releases).*D3nowshipsaspureESmodulesandrequiresNode.js12orhigher.Formore,pleaseread[SindreSorhus’sFAQ](https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c).[d3.bin](https://github.com/d3/d3-array/blob/main/README.md#bin)nowignoresnulls.[d3.ascending](https://github.com/d3/d3-array/blob/main/README.md#ascending)and[d3.descending](https://github.com/d3/d3-array/blob/main/README.md#descending)nolongerconsidernullcomparable.[Ordinalscales](https://github.com/d3/d3-scale/blob/main/README.md#ordinal-scales)nowuse[InternMap](https://github.com/mbostock/internmap)fordomains;domainvaluesarenowuniquedbycoercingtoaprimitivevaluevia*object*.valueOfinsteadofcoercingtoastringvia*object*.toString.Array-likes(*e.g.*,aliveNodeListsuchas*element*.childNodes)areconvertedtoarraysin[d3.selectAll](https://github.com/d3/d3-selection/blob/main/README.md#selectAll)and[*selection*.selectAll](https://github.com/d3/d3-selection/blob/main/README.md#selection_selectAll).#ChangesinD36.0[ReleasedAugust26,2020.](https://github.com/d3/d3/releases/tag/v6.0.0)D3now**usesnativecollections**(MapandSet)and**acceptsiterables**.[d3.groupandd3.rollup](https://observablehq.com/@d3/d3-group)arepowerfulnewaggregationfunctionsthatreplaced3.nestandworkgreat[withd3-hierarchy](https://observablehq.com/d/9a453665f405eebf)andd3-selection.Therearelotsofnewhelpersind3-array,too,suchas[d3.greatest](https://observablehq.com/@d3/d3-least),[d3.quickselect](https://observablehq.com/@d3/d3-quickselect),and[d3.fsum](https://observablehq.com/@d3/d3-fsum).D3now**passeseventsdirectlytolisteners**,replacingthed3.eventglobalandbringingD3inlinewithvanillaJavaScriptandmostotherframeworks.**d3-delaunay**(basedonVladimirAgafonkin’sexcellent[Delaunator](https://github.com/mapbox/delaunator))replacesd3-voronoi,offeringdramaticimprovementstoperformance,robustness,and[search](https://observablehq.com/@d3/delaunay-find).Andthere’sanew[d3-geo-voronoi](https://github.com/Fil/d3-geo-voronoi)forspherical(geographical)data!**d3-random**is[greatlyexpanded](https://github.com/d3/d3-random/blob/master/README.md)andincludesafast[linearcongruentialgenerator](https://observablehq.com/@d3/d3-randomlcg)forseededrandomness.**d3-chord**hasnewlayoutsfor[directed](https://observablehq.com/@d3/directed-chord-diagram)andtransposedchorddiagrams.**d3-scale**addsanew[radialscale](https://observablehq.com/@d3/radial-stacked-bar-chart-ii)type.…andavarietyofothersmallenhancements.[Morethan450examples](https://observablehq.com/@d3/gallery)havebeenupdatedtoD36.0!###d3-array*Acceptiterables.*Add[d3.group](https://github.com/d3/d3-array/blob/master/README.md#group).*Add[d3.groups](https://github.com/d3/d3-array/blob/master/README.md#groups).*Add[d3.index](https://github.com/d3/d3-array/blob/master/README.md#index).*Add[d3.indexes](https://github.com/d3/d3-array/blob/master/README.md#indexes).*Add[d3.rollup](https://github.com/d3/d3-array/blob/master/README.md#rollup).*Add[d3.rollups](https://github.com/d3/d3-array/blob/master/README.md#rollups).*Add[d3.maxIndex](https://github.com/d3/d3-array/blob/master/README.md#maxIndex).*Add[d3.minIndex](https://github.com/d3/d3-array/blob/master/README.md#minIndex).*Add[d3.greatest](https://github.com/d3/d3-array/blob/master/README.md#greatest).*Add[d3.greatestIndex](https://github.com/d3/d3-array/blob/master/README.md#greatestIndex).*Add[d3.least](https://github.com/d3/d3-array/blob/master/README.md#least).*Add[d3.leastIndex](https://github.com/d3/d3-array/blob/master/README.md#leastIndex).*Add[d3.bin](https://github.com/d3/d3-array/blob/master/README.md#bin).*Add[d3.count](https://github.com/d3/d3-array/blob/master/README.md#count).*Add[d3.cumsum](https://github.com/d3/d3-array/blob/master/README.md#cumsum).*Add[d3.fsum](https://github.com/d3/d3-array/blob/master/README.md#fsum).*Add[d3.Adder](https://github.com/d3/d3-array/blob/master/README.md#Adder).*Add[d3.quantileSorted](https://github.com/d3/d3-array/blob/master/README.md#quantileSorted).*Add[d3.quickselect](https://github.com/d3/d3-array/blob/master/README.md#quickselect).*Add[*bisector*.center](https://github.com/d3/d3-array/blob/master/README.md#bisector_center).*Allowmorethantwoiterablesfor[d3.cross](https://github.com/d3/d3-array/blob/master/README.md#cross).*Acceptnon-sortedinputwith[d3.quantile](https://github.com/d3/d3-array/blob/master/README.md#quantile).*Fixa*array*.sortbuginSafari.*FixbinthresholdstoignoreNaNinput.*Fix[d3.ticks](https://github.com/d3/d3-array/blob/master/README.md#ticks)tonotreturnticksoutsidethedomain.*Improvetheperformanceof[d3.median](https://github.com/d3/d3-array/blob/master/README.md#median).Seehttps://observablehq.com/@d3/d3-array-2-0fordetails.###d3-brush*Add[*event*.mode](https://github.com/d3/d3-brush/blob/master/README.md#brush-events).*Change[*brush*.on](https://github.com/d3/d3-brush/blob/master/README.md#brush_on)topassthe*event*directlytolisteners.*Improvemultitouch(two-touch)interaction.###d3-chord*Add[d3.chordDirected](https://github.com/d3/d3-chord/blob/master/README.md#chordDirected).*Add[d3.chordTranspose](https://github.com/d3/d3-chord/blob/master/README.md#chordTranspose).*Add[d3.ribbonArrow](https://github.com/d3/d3-chord/blob/master/README.md#ribbonArrow).*Add[*ribbon*.padAngle](https://github.com/d3/d3-chord/blob/master/README.md#ribbon_padAngle).*Add[*ribbon*.sourceRadius](https://github.com/d3/d3-chord/blob/master/README.md#ribbon_sourceRadius).*Add[*ribbon*.targetRadius](https://github.com/d3/d3-chord/blob/master/README.md#ribbon_targetRadius).###d3-delaunay*Add[d3.Delaunay](https://github.com/d3/d3-delaunay/blob/master/README.md).###d3-drag*Change[*drag*.on](https://github.com/d3/d3-drag/blob/master/README.md#drag_on)topassthe*event*directlytolisteners.###d3-force*Add*iterations*argumentto[*simulation*.tick](https://github.com/d3/d3-force/blob/master/README.md#simulation_tick).*Add[*forceCenter*.strength](https://github.com/d3/d3-force/blob/master/README.md#center_strength).*Add[*forceSimulation*.randomSource](https://github.com/d3/d3-force/blob/master/README.md#simulation_randomSource).*Allbuilt-inforcesarenowfullydeterministic(including“jiggling”coincidentnodes).*Improvethedefaultphyllotaxislayoutslightlybyoffsettingbyonehalf-radius.*Improvetheerrormessagewhenalinkreferencesanunknownnode.*[*force*.initialize](https://github.com/d3/d3-force/blob/master/README.md#force_initialize)isnowpassedarandomsource.*Fixbugwheninitializingnodeswithfixedpositions.###d3-format*Changethedefaultminussigntotheminussign(−)insteadofhyphen-minus(-).*Fixdecimal`d`formattingofnumbersgreaterthanorequalto1e21.###d3-geo*Fixclippingofsomedegeneratepolygons.###d3-hierarchy*Acceptiterables.*Add[*node*[Symbol.iterator]](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_iterator);hierarchiesarenowiterable.*Add[*node*.find](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_find).*Change[*node*.each](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_each)topassthetraversalindex.*Change[*node*.eachAfter](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_eachAfter)topassthetraversalindex.*Change[*node*.eachBefore](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_eachBefore)topassthetraversalindex.*Fix[d3.packSiblings](https://github.com/d3/d3-hierarchy/blob/master/README.md#packSiblings)forhugecircles.*Fixdivide-by-zerobugin[d3.treemapBinary](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapBinary).*Fixdivide-by-zerobugin[d3.treemapResquarify](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapResquarify).###d3-interpolate*Add[*interpolateZoom*.rho](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateZoom_rho).(#25)*Allow[d3.piecewise](https://github.com/d3/d3-interpolate/blob/master/README.md#piecewise)todefaulttousingd3.interpolate.#90*Change[d3.interpolateTransformCss](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformCss)touseDOMMatrixandrequireabsoluteunits.#83###d3-quadtree*Fixaninfiniteloopwhencoordinatesdivergetohugevalues.###d3-random*Add[d3.randomLcg](https://github.com/d3/d3-random/blob/master/README.md#randomLcg).*Add[d3.randomGamma](https://github.com/d3/d3-random/blob/master/README.md#randomGamma).*Add[d3.randomBeta](https://github.com/d3/d3-random/blob/master/README.md#randomBeta).*Add[d3.randomWeibull](https://github.com/d3/d3-random/blob/master/README.md#randomWeibull).*Add[d3.randomCauchy](https://github.com/d3/d3-random/blob/master/README.md#randomCauchy).*Add[d3.randomLogistic](https://github.com/d3/d3-random/blob/master/README.md#randomLogistic).*Add[d3.randomPoisson](https://github.com/d3/d3-random/blob/master/README.md#randomPoisson).*Add[d3.randomInt](https://github.com/d3/d3-random/blob/master/README.md#randomInt).*Add[d3.randomBinomial](https://github.com/d3/d3-random/blob/master/README.md#randomBinomial).*Add[d3.randomGeometric](https://github.com/d3/d3-random/blob/master/README.md#randomGeometric).*Add[d3.randomPareto](https://github.com/d3/d3-random/blob/master/README.md#randomPareto).*Add[d3.randomBernoulli](https://github.com/d3/d3-random/blob/master/README.md#randomBernoulli).*Allow[d3.randomBates](https://github.com/d3/d3-random/blob/master/README.md#randomBates)totakefractional*n*.*Allow[d3.randomIrwinHall](https://github.com/d3/d3-random/blob/master/README.md#randomIrwinHall)totakefractional*n*.*Don’twrapMath.randominthedefaultsource.Thanksto@Lange,@p-v-d-Veeken,@svanschooten,@Parcly-Taxeland@jrusforyourcontributions!###d3-scale*Acceptiterables.*Add[*diverging*.rangeRound](https://github.com/d3/d3-scale/blob/master/README.md#diverging_rangeRound).*Add[*sequential*.range](https://github.com/d3/d3-scale/blob/master/README.md#sequential_range)(forcompatibilitywithd3-axis).*Add[*sequential*.rangeRound](https://github.com/d3/d3-scale/blob/master/README.md#sequential_rangeRound).*Add[*sequentialQuantile*.quantiles](https://github.com/d3/d3-scale/blob/master/README.md#sequentialQuantile_quantiles).*Add[d3.scaleRadial](https://github.com/d3/d3-scale/blob/master/README.md#radial-scales).*[*diverging*.range](https://github.com/d3/d3-scale/blob/master/README.md#diverging_range)cannowbeusedtosettheinterpolator.*[*sequential*.range](https://github.com/d3/d3-scale/blob/master/README.md#sequential_range)cannowbeusedtosettheinterpolator.*[d3.scaleDiverging](https://github.com/d3/d3-scale/blob/master/README.md#diverging-scales)cannowacceptarangearrayinplaceofaninterpolator.*[d3.scaleSequential](https://github.com/d3/d3-scale/blob/master/README.md#sequential-scales)cannowacceptarangearrayinplaceofaninterpolator.*Fix[*continuous*.nice](https://github.com/d3/d3-scale/blob/master/README.md#continuous_nice)toensurethatniceddomainsalwaysspanticks.*Fix[*log*.ticks](https://github.com/d3/d3-scale/blob/master/README.md#log_ticks)forsmalldomains.*Fix[*log*.ticks](https://github.com/d3/d3-scale/blob/master/README.md#log_ticks)forsmalldomains.#44*Fix[*scale*.clamp](https://github.com/d3/d3-scale/blob/master/README.md#continuous_clamp)for[sequentialquantilescales](https://github.com/d3/d3-scale/blob/master/README.md#scaleSequentialQuantile).Thanks,@Fil!*Fix[*scale*.clamp](https://github.com/d3/d3-scale/blob/master/README.md#continuous_clamp)forcontinuousscaleswithmoredomainvaluesthanrangevalues.*Fix[divergingscales](https://github.com/d3/d3-scale/blob/master/README.md#diverging-scales)withdescendingdomains.*Removedeprecated*step*argumentfrom[*time*.ticks](https://github.com/d3/d3-scale/blob/master/README.md#time_ticks)and[*time*.nice](https://github.com/d3/d3-scale/blob/master/README.md#time_nice).###d3-selection*Add[*selection*.selectChild](https://github.com/d3/d3-selection/blob/master/README.md#selection_selectChild).*Add[*selection*.selectChildren](https://github.com/d3/d3-selection/blob/master/README.md#selection_selectChildren).*Add[d3.pointer](https://github.com/d3/d3-selection/blob/master/README.md#pointer).*Add[d3.pointers](https://github.com/d3/d3-selection/blob/master/README.md#pointers).*Add*selection*[Symbol.iterator];selectionsarenowiterable!*Acceptiterableswith[*selection*.data](https://github.com/d3/d3-selection/blob/master/README.md#selection_data).*Acceptiterableswith[d3.selectAll](https://github.com/d3/d3-selection/blob/master/README.md#selectAll).*Change[*selection*.on](https://github.com/d3/d3-selection/blob/master/README.md#selection_on)topassthe*event*directlytolisteners.*Removeindexandgroupfrom*selection*.onlisteners!*Removed3.event!*Removed3.mouse.*Removed3.touch.*Removed3.touches.*Removed3.customEvent.*Removed3.clientPoint.*Removed3.sourceEvent.*Fix*selection*.merge(*transition*)toerror.Foranoverviewofchanges,seehttps://observablehq.com/@d3/d3-selection-2-0.###d3-shape*Acceptiterables.*Add[d3.line](https://github.com/d3/d3-shape/blob/master/README.md#line)(*x*,*y*)shorthand.*Add[d3.area](https://github.com/d3/d3-shape/blob/master/README.md#area)(*x*,*y0*,*y1*)shorthand.*Add[d3.symbol](https://github.com/d3/d3-shape/blob/master/README.md#symbol)(*type*,*size*)shorthand.###d3-time-format*AddISO8601“weekyear”(`%G`and`%g`).###d3-timer*Fix[*interval*.restart](https://github.com/d3/d3-timer/blob/master/README.md#timer_restart)torestartasaninterval.###d3-transition*Add[*transition*.easeVarying](https://github.com/d3/d3-transition/blob/master/README.md#transition_easeVarying).*Add*transition*[Symbol.iterator];transitionsarenowiterable.*Fix[*selection*.transition](https://github.com/d3/d3-transition/blob/master/README.md#selection_transition)toerrorifthenamedtransitiontoinheritisnotfound.k*Fix[*transition*.end](https://github.com/d3/d3-transition/blob/master/README.md#transition_end)toresolveimmediatelyiftheselectionisempty.###d3-zoom*Add[*zoom*.tapDistance](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_tapDistance).*Change[*zoom*.on](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_on)topassthe*event*directlytolisteners.*Changethedefault[*zoom*.filter](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_filter)toobserve*wheel*eventsifthecontrolkeyispressed.*Changethedefault[*zoom*.wheelDelta](ttps://github.com/d3/d3-zoom/blob/master/README.md#zoom_wheelDelta)togofasterifthecontrolkeyispressed.*Don‘tsettouch-action:none.*Upgradeto[d3-selection2](https://observablehq.com/@d3/d3-selection-2-0).###BreakingChangesD36.0introducesseveralnon-backwards-compatiblechanges.*Remove[d3.event](https://observablehq.com/d/f91cccf0cad5e9cb#events).*Change[*selection*.on](https://observablehq.com/d/f91cccf0cad5e9cb#events)topassthe*event*directlytolisteners.*Change[*transition*.on](https://observablehq.com/d/f91cccf0cad5e9cb#events)topassthe*event*directlytolisteners.*Change[*brush*.on](https://observablehq.com/d/f91cccf0cad5e9cb#event_brush)topassthe*event*directlytolisteners.*Change[*drag*.on](https://observablehq.com/d/f91cccf0cad5e9cb#event_drag)topassthe*event*directlytolisteners.*Change[*zoom*.on](https://observablehq.com/d/f91cccf0cad5e9cb#event_zoom)topassthe*event*directlytolisteners.*Removed3.mouse;use[d3.pointer](https://observablehq.com/d/f91cccf0cad5e9cb#pointer).*Removed3.touch;use[d3.pointer](https://observablehq.com/d/f91cccf0cad5e9cb#pointer).*Removed3.touches;use[d3.pointers](https://observablehq.com/d/f91cccf0cad5e9cb#pointer).*Removed3.clientPoint;use[d3.pointer](https://observablehq.com/d/f91cccf0cad5e9cb#pointer).*Removed3.voronoi;use[d3.Delaunay](https://observablehq.com/d/f91cccf0cad5e9cb#delaunay).*Removed3.nest;use[d3.group](https://observablehq.com/d/f91cccf0cad5e9cb#group)and[d3.rollup](https://observablehq.com/d/f91cccf0cad5e9cb#group).*Removed3.map;use[Map](https://observablehq.com/d/f91cccf0cad5e9cb#collection).*Removed3.set;use[Set](https://observablehq.com/d/f91cccf0cad5e9cb#collection).*Removed3.keys;use[Object.keys](https://observablehq.com/d/f91cccf0cad5e9cb#collection).*Removed3.values;use[Object.values](https://observablehq.com/d/f91cccf0cad5e9cb#collection).*Removed3.entries;use[Object.entries](https://observablehq.com/d/f91cccf0cad5e9cb#collection).*Renamed3.histogramto[d3.bin](https://observablehq.com/d/f91cccf0cad5e9cb#bin).*Renamed3.scanto[d3.leastIndex](https://observablehq.com/d/f91cccf0cad5e9cb#leastIndex).*Change[d3.interpolateTransformCss](https://observablehq.com/d/f91cccf0cad5e9cb#interpolateTransformCss)torequireabsoluteunits.*Change[d3.format](https://observablehq.com/d/f91cccf0cad5e9cb#minus)todefaulttotheminussigninsteadofhyphen-minusfornegativevalues.D3nowrequiresabrowserthatsupports[ES2015](http://www.ecma-international.org/ecma-262/6.0/).Forolderbrowsers,youmustbringyourowntranspiler.Lastly,supportfor[Bower](https://bower.io)hasbeendropped;D3isnowexclusivelypublishedtonpmandGitHub.Seeour[migrationguide](https://observablehq.com/d/f91cccf0cad5e9cb)forhelpupgrading.#ChangesinD35.0[ReleasedMarch22,2018.](https://github.com/d3/d3/releases/tag/v5.0.0)D35.0introducesonlyafewnon-backwards-compatiblechanges.D3nowuses[Promises](https://developer.mozilla.org/docs/Web/JavaScript/Guide/Using_promises)insteadofasynchronouscallbackstoloaddata.Promisessimplifythestructureofasynchronouscode,especiallyinmodernbrowsersthatsupport[asyncandawait](https://javascript.info/async-await).(Seethis[introductiontopromises](https://observablehq.com/@observablehq/introduction-to-promises)on[Observable](https://observablehq.com).)Forexample,toloadaCSVfileinv4,youmightsay:```jsd3.csv("file.csv",function(error,data){if(error)throwerror;console.log(data);});```Inv5,usingpromises:```jsd3.csv("file.csv").then(function(data){console.log(data);});```Notethatyoudon’tneedtorethrowtheerror—thepromisewillrejectautomatically,andyoucan*promise*.catchifdesired.Usingawait,thecodeisevensimpler:```jsconstdata=awaitd3.csv("file.csv");console.log(data);```Withtheadoptionofpromises,D3nowusesthe[FetchAPI](https://fetch.spec.whatwg.org/)insteadof[XMLHttpRequest](https://developer.mozilla.org/docs/Web/API/XMLHttpRequest):the[d3-request](https://github.com/d3/d3-request)modulehasbeenreplacedby[d3-fetch](https://github.com/d3/d3-fetch).Fetchsupportsmanypowerfulnewfeatures,suchas[streamingresponses](https://observablehq.com/@mbostock/streaming-shapefiles).D35.0alsodeprecatesandremovesthe[d3-queue](https://github.com/d3/d3-queue)module.Use[Promise.all](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)torunabatchofasynchronoustasksinparallel,orahelperlibrarysuchas[p-queue](https://github.com/sindresorhus/p-queue)to[controlconcurrency](https://observablehq.com/@mbostock/hello-p-queue).D3nolongerprovidesthed3.schemeCategory20*categoricalcolorschemes.Thesetwenty-colorschemeswereflawedbecausetheirgroupeddesigncouldfalselyimplyrelationshipsinthedata:asharedhuecanimplythattheencodeddataarepartofagroup(asuper-category),whilerelativelightnesscanimplyorder.Instead,D3nowincludes[d3-scale-chromatic](https://github.com/d3/d3-scale-chromatic),whichimplementsexcellentschemesfromColorBrewer,including[categorical](https://github.com/d3/d3-scale-chromatic/blob/master/README.md#categorical),[diverging](https://github.com/d3/d3-scale-chromatic/blob/master/README.md#diverging),[sequentialsingle-hue](https://github.com/d3/d3-scale-chromatic/blob/master/README.md#sequential-single-hue)and[sequentialmulti-hue](https://github.com/d3/d3-scale-chromatic/blob/master/README.md#sequential-multi-hue)schemes.Theseschemesareavailableinbothdiscreteandcontinuousvariants.D3nowprovidesimplementationsof[marchingsquares](https://observablehq.com/@d3/contours)and[densityestimation](https://observablehq.com/@d3/density-contours)via[d3-contour](https://github.com/d3/d3-contour)!Therearetwonew[d3-selection](https://github.com/d3/d3-selection)methods:[*selection*.clone](https://github.com/d3/d3-selection/blob/master/README.md#selection_clone)forinsertingclonesoftheselectednodes,and[d3.create](https://github.com/d3/d3-selection/blob/master/README.md#create)forcreatingdetachedelements.[Geographicprojections](https://github.com/d3/d3-geo)nowsupport[*projection*.angle](https://github.com/d3/d3-geo/blob/master/README.md#projection_angle),whichhasenabledseveralfantasticnew[polyhedralprojections](https://github.com/d3/d3-geo-polygon)byPhilippeRivière.Lastly,D3’s[package.json](https://github.com/d3/d3/blob/master/package.json)nolongerpinsexactversionsofthedependentD3modules.Thisfixesanissuewith[duplicateinstalls](https://github.com/d3/d3/issues/3256)ofD3modules.#ChangesinD34.0[ReleasedJune28,2016.](https://github.com/d3/d3/releases/tag/v4.0.0)D34.0ismodular.Insteadofonelibrary,D3isnow[manysmalllibraries](#table-of-contents)thataredesignedtoworktogether.Youcanpickandchoosewhichpartstouseasyouseefit.Eachlibraryismaintainedinitsownrepository,allowingdecentralizedownershipandindependentreleasecycles.Thedefaultbundlecombinesaboutthirtyofthesemicrolibraries.```html<scriptsrc="https://d3js.org/d3.v4.js"></script>```Asbefore,youcanloadoptionalpluginsontopofthedefaultbundle,suchas[ColorBrewerscales](https://github.com/d3/d3-scale-chromatic):```html<scriptsrc="https://d3js.org/d3.v4.js"></script><scriptsrc="https://d3js.org/d3-scale-chromatic.v0.3.js"></script>```Youarenotrequiredtousethedefaultbundle!Ifyou’rejustusing[d3-selection](https://github.com/d3/d3-selection),useitasastandalonelibrary.Likethedefaultbundle,youcanloadD3microlibrariesusingvanillascripttagsorRequireJS(greatforHTTP/2!):```html<scriptsrc="https://d3js.org/d3-selection.v1.js"></script>```Youcanalso`cat`D3microlibrariesintoacustombundle,orusetoolssuchas[Webpack](https://webpack.github.io/)and[Rollup](http://rollupjs.org/)tocreate[optimizedbundles](https://bl.ocks.org/mbostock/bb09af4c39c79cffcde4).CustombundlesaregreatforapplicationsthatuseasubsetofD3’sfeatures;forexample,aReactchartlibrarymightuseD3forscalesandshapes,andReacttomanipulatetheDOM.TheD3microlibrariesarewrittenas[ES6modules](http://www.2ality.com/2014/09/es6-modules-final.html),andRollupletsyoupickatthesymbolleveltoproducesmallerbundles.Smallfilesarenice,butmodularityisalsoaboutmakingD3more*fun*.Microlibrariesareeasiertounderstand,developandtest.Theymakeiteasierfornewpeopletogetinvolvedandcontribute.Theyreducethedistinctionbetweena“coremodule”anda“plugin”,andincreasethepaceofdevelopmentinD3features.Ifyoudon’tcareaboutmodularity,youcanmostlyignorethischangeandkeepusingthedefaultbundle.However,thereisoneunavoidableconsequenceofadoptingES6modules:everysymbolinD34.0nowsharesaflatnamespaceratherthanthenestedoneofD33.x.Forexample,d3.scale.linearisnowd3.scaleLinear,andd3.layout.treemapisnowd3.treemap.TheadoptionofES6modulesalsomeansthatD3isnowwrittenexclusivelyin[strictmode](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode)andhasbetterreadability.AndtherehavebeenmanyothersignificantimprovementstoD3’sfeatures!(NearlyallofthecodefromD33.xhasbeenrewritten.)Thesechangesarecoveredbelow.###OtherGlobalChangesThedefault[UMDbundle](https://github.com/umdjs/umd)isnow[anonymous](https://github.com/requirejs/requirejs/wiki/Updating-existing-libraries#register-as-an-anonymous-module-).No`d3`globalisexportedifAMDorCommonJSisdetected.Inavanillaenvironment,theD3microlibrariessharethe`d3`global,evenifyouloadthemindependently;thus,codeyouwriteisthesamewhetherornotyouusethedefaultbundle.(See[Let’sMakea(D3)Plugin](https://bost.ocks.org/mike/d3-plugin/)formore.)ThegeneratedbundleisnolongerstoredintheGitrepository;Bowerhasbeenrepointedto[d3-bower](https://github.com/mbostock-bower/d3-bower),andyoucanfindthegeneratedfileson[npm](https://unpkg.com/d3)orattachedtothe[latestrelease](https://github.com/d3/d3/releases/latest).Thenon-minifieddefaultbundleisnolongermangled,makingitmorereadableandpreservinginlinecomments.Totheconsternationofsomeusers,3.xemployedUnicodevariablenamessuchasλ,φ,τandπforaconciserepresentationofmathematicaloperations.AdownsideofthisapproachwasthataSyntaxErrorwouldoccurifyouloadedthenon-minifiedD3usingISO-8859-1insteadofUTF-8.3.xalsousedUnicodestringliterals,suchastheSI-prefixµfor1e-6.4.0usesonlyASCIIvariablenamesandASCIIstringliterals(see[rollup-plugin-ascii](https://github.com/mbostock/rollup-plugin-ascii)),avoidingencodingproblems.###TableofContents*[Arrays](#arrays-d3-array)*[Axes](#axes-d3-axis)*[Brushes](#brushes-d3-brush)*[Chords](#chords-d3-chord)*[Collections](#collections-d3-collection)*[Colors](#colors-d3-color)*[Dispatches](#dispatches-d3-dispatch)*[Dragging](#dragging-d3-drag)*[Delimiter-SeparatedValues](#delimiter-separated-values-d3-dsv)*[Easings](#easings-d3-ease)*[Forces](#forces-d3-force)*[NumberFormats](#number-formats-d3-format)*[Geographies](#geographies-d3-geo)*[Hierarchies](#hierarchies-d3-hierarchy)*[Internals](#internals)*[Interpolators](#interpolators-d3-interpolate)*[Paths](#paths-d3-path)*[Polygons](#polygons-d3-polygon)*[Quadtrees](#quadtrees-d3-quadtree)*[Queues](#queues-d3-queue)*[RandomNumbers](#random-numbers-d3-random)*[Requests](#requests-d3-request)*[Scales](#scales-d3-scale)*[Selections](#selections-d3-selection)*[Shapes](#shapes-d3-shape)*[TimeFormats](#time-formats-d3-time-format)*[TimeIntervals](#time-intervals-d3-time)*[Timers](#timers-d3-timer)*[Transitions](#transitions-d3-transition)*[VoronoiDiagrams](#voronoi-diagrams-d3-voronoi)*[Zooming](#zooming-d3-zoom)##[Arrays(d3-array)](https://github.com/d3/d3-array/blob/master/README.md)Thenew[d3.scan](https://github.com/d3/d3-array/blob/master/README.md#scan)methodperformsalinearscanofanarray,returningtheindexoftheleastelementaccordingtothespecifiedcomparator.Thisissimilarto[d3.min](https://github.com/d3/d3-array/blob/master/README.md#min)and[d3.max](https://github.com/d3/d3-array/blob/master/README.md#max),exceptyoucanuseittofindthepositionofanextremeelement,ratherthanjustcalculateanextremevalue.```jsvardata=[{name:"Alice",value:2},{name:"Bob",value:3},{name:"Carol",value:1},{name:"Dwayne",value:5}];vari=d3.scan(data,function(a,b){returna.value-b.value;});//2data[i];//{name:"Carol",value:1}```Thenew[d3.ticks](https://github.com/d3/d3-array/blob/master/README.md#ticks)and[d3.tickStep](https://github.com/d3/d3-array/blob/master/README.md#tickStep)methodsareusefulforgeneratinghuman-readablenumericticks.Thesemethodsarealow-levelalternativeto[*continuous*.ticks](https://github.com/d3/d3-scale/blob/master/README.md#continuous_ticks)from[d3-scale](https://github.com/d3/d3-scale).Thenewimplementationisalsomoreaccurate,returningtheoptimalnumberofticksasmeasuredbyrelativeerror.```jsvarticks=d3.ticks(0,10,5);//[0,2,4,6,8,10]```The[d3.range](https://github.com/d3/d3-array/blob/master/README.md#range)methodnolongermakesanelaborateattempttoavoidfloating-pointerrorwhen*step*isnotaninteger.Thereturnedvaluesarestrictlydefinedas*start*+*i*\**step*,where*i*isaninteger.(Learnmoreabout[floatingpointmath](http://0.30000000000000004.com/).)d3.rangereturnstheemptyarrayforinfiniteranges,ratherthanthrowinganerror.Themethodsignatureforoptionalaccessorshasbeenchangedtobemoreconsistentwitharraymethodssuchas[*array*.forEach](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach):theaccessorispassedthecurrentelement(*d*),theindex(*i*),andthearray(*data*),with*this*asundefined.Thisaffects[d3.min](https://github.com/d3/d3-array/blob/master/README.md#min),[d3.max](https://github.com/d3/d3-array/blob/master/README.md#max),[d3.extent](https://github.com/d3/d3-array/blob/master/README.md#extent),[d3.sum](https://github.com/d3/d3-array/blob/master/README.md#sum),[d3.mean](https://github.com/d3/d3-array/blob/master/README.md#mean),[d3.median](https://github.com/d3/d3-array/blob/master/README.md#median),[d3.quantile](https://github.com/d3/d3-array/blob/master/README.md#quantile),[d3.variance](https://github.com/d3/d3-array/blob/master/README.md#variance)and[d3.deviation](https://github.com/d3/d3-array/blob/master/README.md#deviation).The[d3.quantile](https://github.com/d3/d3-array/blob/master/README.md#quantile)methodpreviouslydidnottakeanaccessor.Somemethodswithoptionalargumentsnowtreatthoseargumentsasmissingiftheyarenullorundefined,ratherthanstrictlycheckingarguments.length.Thenew[d3.histogram](https://github.com/d3/d3-array/blob/master/README.md#histograms)APIreplacesd3.layout.histogram.Ratherthanexposing*bin*.xand*bin*.dxoneachreturnedbin,thehistogramexposes*bin*.x0and*bin*.x1,guaranteeingthat*bin*.x0isexactlyequalto*bin*.x1ontheprecedingbin.The“frequency”and“probability”modesarenolongersupported;eachbinissimplyanarrayofelementsfromtheinputdata,so*bin*.lengthisequaltoD33.x’s*bin*.yinfrequencymode.Tocomputeaprobabilitydistribution,dividethenumberofelementsineachbinbythetotalnumberofelements.The*histogram*.rangemethodhasbeenrenamed[*histogram*.domain](https://github.com/d3/d3-array/blob/master/README.md#histogram_domain)forconsistencywithscales.The*histogram*.binsmethodhasbeenrenamed[*histogram*.thresholds](https://github.com/d3/d3-array/blob/master/README.md#histogram_thresholds),andnolongeracceptsanuppervalue:*n*thresholdswillproduce*n*+1bins.Ifyouspecifyadesirednumberofbinsratherthanthresholds,d3.histogramnowuses[d3.ticks](https://github.com/d3/d3-array/blob/master/README.md#ticks)tocomputenicebinthresholds.InadditiontothedefaultSturges’formula,D3nowimplementsthe[Freedman-Diaconisrule](https://github.com/d3/d3-array/blob/master/README.md#thresholdFreedmanDiaconis)and[Scott’snormalreferencerule](https://github.com/d3/d3-array/blob/master/README.md#thresholdScott).##[Axes(d3-axis)](https://github.com/d3/d3-axis/blob/master/README.md)TorenderaxesproperlyinD33.x,youneededtostylethem:```html<style>.axispath,.axisline{fill:none;stroke:#000;shape-rendering:crispEdges;}.axistext{font:10pxsans-serif;}</style><script>d3.select(".axis").call(d3.svg.axis().scale(x).orient("bottom"));</script>```Ifyoudidn’t,yousawthis:<imgsrc="https://raw.githubusercontent.com/d3/d3/master/img/axis-v3.png"width="100%"height="105">D34.0providesdefaultstylesandshortersyntax.Inplaceofd3.svg.axisand*axis*.orient,D34.0nowprovidesfourconstructorsforeachorientation:[d3.axisTop](https://github.com/d3/d3-axis/blob/master/README.md#axisTop),[d3.axisRight](https://github.com/d3/d3-axis/blob/master/README.md#axisRight),[d3.axisBottom](https://github.com/d3/d3-axis/blob/master/README.md#axisBottom),[d3.axisLeft](https://github.com/d3/d3-axis/blob/master/README.md#axisLeft).Theseconstructorsacceptascale,soyoucanreducealloftheaboveto:```html<script>d3.select(".axis").call(d3.axisBottom(x));</script>```Andgetthis:<imgsrc="https://raw.githubusercontent.com/d3/d3/master/img/axis-v4.png"width="100%"height="105">Asbefore,youcancustomizetheaxisappearanceeitherbyapplyingstylesheetsorbymodifyingtheaxiselements.Thedefaultappearancehasbeenchangedslightlytooffsettheaxisbyahalf-pixel;thisfixesacrisp-edgesrenderingissueonSafariwheretheaxiswouldbedrawntwo-pixelsthick.There’snowan[*axis*.tickArguments](https://github.com/d3/d3-axis/blob/master/README.md#axis_tickArguments)method,asanalternativeto[*axis*.ticks](https://github.com/d3/d3-axis/blob/master/README.md#axis_ticks)thatalsoallowstheaxistickargumentstobeinspected.The[*axis*.tickSize](https://github.com/d3/d3-axis/blob/master/README.md#axis_tickSize)methodhasbeenchangedtoonlyallowasingleargumentwhensettingtheticksize.The*axis*.innerTickSizeand*axis*.outerTickSizemethodshavebeenrenamed[*axis*.tickSizeInner](https://github.com/d3/d3-axis/blob/master/README.md#axis_tickSizeInner)and[*axis*.tickSizeOuter](https://github.com/d3/d3-axis/blob/master/README.md#axis_tickSizeOuter),respectively.##[Brushes(d3-brush)](https://github.com/d3/d3-brush/blob/master/README.md)Replacingd3.svg.brush,therearenowthreeclassesofbrushforbrushingalongthe*x*-dimension,the*y*-dimension,orboth:[d3.brushX](https://github.com/d3/d3-brush/blob/master/README.md#brushX),[d3.brushY](https://github.com/d3/d3-brush/blob/master/README.md#brushY),[d3.brush](https://github.com/d3/d3-brush/blob/master/README.md#brush).Brushesarenolongerdependenton[scales](#scales-d3-scale);instead,eachbrushdefinesaselectioninscreencoordinates.Thisselectioncanbe[inverted](https://github.com/d3/d3-scale/blob/master/README.md#continuous_invert)ifyouwanttocomputethecorrespondingdatadomain.Andratherthanrelyonthescales’ rangestodeterminethebrushablearea,thereisnowa[*brush*.extent](https://github.com/d3/d3-brush/blob/master/README.md#brush_extent)methodforsettingit.Ifyoudonotsetthebrushextent,itdefaultstothefullextentoftheownerSVGelement.The*brush*.clampmethodhasalsobeeneliminated;brushingisalwaysrestrictedtothebrushableareadefinedbythebrushextent.Brushesnolongerstoretheactivebrushselection(*i.e.*,thehighlightedregion;thebrush’sposition)internally.Thebrush’spositionisnowstoredonanyelementstowhichthebrushhasbeenapplied.Thebrush’spositionisavailableas*event*.selectionwithinabrusheventorbycalling[d3.brushSelection](https://github.com/d3/d3-brush/blob/master/README.md#brushSelection)onagiven*element*.Tomovethebrushprogrammatically,use[*brush*.move](https://github.com/d3/d3-brush/blob/master/README.md#brush_move)withagiven[selection](#selections-d3-selection)or[transition](#transitions-d3-transition);seethe[brushsnappingexample](https://bl.ocks.org/mbostock/6232537).The*brush*.eventmethodhasbeenremoved.Brushinteractionhasbeenimproved.Bydefault,brushesnowignoreright-clicksintendedforthecontextmenu;youcanchangethisbehaviorusing[*brush*.filter](https://github.com/d3/d3-brush/blob/master/README.md#brush_filter).BrushesalsoignoreemulatedmouseeventsoniOS.HoldingdownSHIFT(⇧)whilebrushinglocksthe*x*-or*y*-positionofthebrush.HoldingdownMETA(⌘)whileclickinganddraggingstartsanewselection,ratherthantranslatingtheexistingselection.Thedefaultappearanceofthebrushhasalsobeenimprovedandslightlysimplified.Previouslyitwasnecessarytoapplystylestothebrushtogiveitareasonableappearance,suchas:```css.brush.extent{stroke:#fff;fill-opacity:.125;shape-rendering:crispEdges;}```Thesestylesarenowappliedbydefaultasattributes;ifyouwanttocustomizethebrushappearance,youcanstillapplyexternalstylesormodifythebrushelements.(D34.0featuresasimilarimprovementto[axes](#axes-d3-axis).)Anew[*brush*.handleSize](https://github.com/d3/d3-brush/blob/master/README.md#brush_handleSize)methodletsyouoverridethebrushhandlesize;itdefaultstosixpixels.Thebrushnowconsumeshandledevents,makingiteasiertocombinewithotherinteractivebehaviorssuchas[dragging](#dragging-d3-drag)and[zooming](#zooming-d3-zoom).The*brushstart*and*brushend*eventshavebeenrenamedto*start*and*end*,respectively.Thebrusheventnolongerreportsa*event*.modetodistinguishbetweenresizinganddraggingthebrush.##[Chords(d3-chord)](https://github.com/d3/d3-chord/blob/master/README.md)Pursuanttothegreatnamespaceflattening:*d3.layout.chord↦[d3.chord](https://github.com/d3/d3-chord/blob/master/README.md#chord)*d3.svg.chord↦[d3.ribbon](https://github.com/d3/d3-chord/blob/master/README.md#ribbon)Forconsistencywith[*arc*.padAngle](https://github.com/d3/d3-shape/blob/master/README.md#arc_padAngle),*chord*.paddinghasalsobeenrenamedto[*ribbon*.padAngle](https://github.com/d3/d3-chord/blob/master/README.md#ribbon_padAngle).Anew[*ribbon*.context](https://github.com/d3/d3-chord/blob/master/README.md#ribbon_context)methodletsyourenderchorddiagramstoCanvas!Seealso[d3-path](#paths-d3-path).##[Collections(d3-collection)](https://github.com/d3/d3-collection/blob/master/README.md)The[d3.set](https://github.com/d3/d3-collection/blob/master/README.md#set)constructornowacceptsanexistingsetformakingacopy.Ifyoupassanarraytod3.set,youcanalsopassavalueaccessor.Thisaccessortakesthestandardarguments:thecurrentelement(*d*),theindex(*i*),andthearray(*data*),with*this*undefined.Forexample:```jsvaryields=[{yield:22.13333,variety:"Manchuria",year:1932,site:"GrandRapids"},{yield:26.76667,variety:"Peatland",year:1932,site:"GrandRapids"},{yield:28.10000,variety:"No.462",year:1931,site:"Duluth"},{yield:38.50000,variety:"Svansota",year:1932,site:"Waseca"},{yield:40.46667,variety:"Svansota",year:1931,site:"Crookston"},{yield:36.03333,variety:"Peatland",year:1932,site:"Waseca"},{yield:34.46667,variety:"WisconsinNo.38",year:1931,site:"GrandRapids"}];varsites=d3.set(yields,function(d){returnd.site;});//GrandRapids,Duluth,Waseca,Crookston```The[d3.map](https://github.com/d3/d3-collection/blob/master/README.md#map)constructoralsofollowsthestandardarrayaccessorargumentpattern.The*map*.forEachand*set*.forEachmethodshavebeenrenamedto[*map*.each](https://github.com/d3/d3-collection/blob/master/README.md#map_each)and[*set*.each](https://github.com/d3/d3-collection/blob/master/README.md#set_each)respectively.Theorderofargumentsfor*map*.eachhasalsobeenchangedto*value*,*key*and*map*,whiletheorderofargumentsfor*set*.eachisnow*value*,*value*and*set*.ThisisclosertoES6[*map*.forEach](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map/forEach)and[*set*.forEach](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set/forEach).AlsolikeES6MapandSet,*map*.setand*set*.addnowreturnthecurrentcollection(ratherthantheaddedvalue)tofacilitatemethodchaining.New[*map*.clear](https://github.com/d3/d3-collection/blob/master/README.md#map_clear)and[*set*.clear](https://github.com/d3/d3-collection/blob/master/README.md#set_clear)methodscanbeusedtoemptycollections.The[*nest*.map](https://github.com/d3/d3-collection/blob/master/README.md#nest_map)methodnowalwaysreturnsad3.mapinstance.Foraplainobject,use[*nest*.object](https://github.com/d3/d3-collection/blob/master/README.md#nest_object)instead.Whenusedinconjunctionwith[*nest*.rollup](https://github.com/d3/d3-collection/blob/master/README.md#nest_rollup),[*nest*.entries](https://github.com/d3/d3-collection/blob/master/README.md#nest_entries)nowreturns{key,value}objectsfortheleafentries,insteadof{key,values}.Thismakes*nest*.rollupeasiertouseinconjunctionwith[hierarchies](#hierarchies-d3-hierarchy),asinthis[NestTreemapexample](https://bl.ocks.org/mbostock/2838bf53e0e65f369f476afd653663a2).##[Colors(d3-color)](https://github.com/d3/d3-color/blob/master/README.md)Allcolorsnowhaveopacityexposedas*color*.opacity,whichisanumberin[0,1].Youcanpassanoptionalopacityargumenttothecolorspaceconstructors[d3.rgb](https://github.com/d3/d3-color/blob/master/README.md#rgb),[d3.hsl](https://github.com/d3/d3-color/blob/master/README.md#hsl),[d3.lab](https://github.com/d3/d3-color/blob/master/README.md#lab),[d3.hcl](https://github.com/d3/d3-color/blob/master/README.md#hcl)or[d3.cubehelix](https://github.com/d3/d3-color/blob/master/README.md#cubehelix).Youcannowparsergba(…)andhsla(…)CSScolorspecifiersorthestring“transparent”using[d3.color](https://github.com/d3/d3-color/blob/master/README.md#color).The“transparent”colorisdefinedasanRGBcolorwithzeroopacityandundefinedred,greenandbluechannels;thisdiffersslightlyfromCSSwhichdefinesitastransparentblack,butisusefulforsimplifyingcolorinterpolationlogicwhereeitherthestartingorendingcolorhasundefinedchannels.The[*color*.toString](https://github.com/d3/d3-color/blob/master/README.md#color_toString)methodnowlikewisereturnsanrgb(…)orrgba(…)stringwithintegerchannelvalues,notthehexadecimalRGBformat,consistentwithCSScomputedvalues.Thisimprovesperformancebyshort-circuitingtransitionswhentheelement’sstartingstylematchesitsendingstyle.Thenew[d3.color](https://github.com/d3/d3-color/blob/master/README.md#color)methodistheprimarymethodforparsingcolors:itreturnsad3.colorinstanceintheappropriatecolorspace,ornulliftheCSScolorspecifierisinvalid.Forexample:```jsvarred=d3.color("hsl(0,80%,50%)");//{h:0,l:0.5,s:0.8,opacity:1}```Theparsingimplementationisnowmorerobust.Forexample,youcannolongermixintegersandpercentagesinrgb(…),anditcorrectlyhandleswhitespace,decimalpoints,numbersigns,andotheredgecases.Thecolorspaceconstructorsd3.rgb,d3.hsl,d3.lab,d3.hclandd3.cubehelixnowalwaysreturnacopyoftheinputcolor,convertedtothecorrespondingcolorspace.While[*color*.rgb](https://github.com/d3/d3-color/blob/master/README.md#color_rgb)remains,*rgb*.hslhasbeenremoved;used3.hsltoconvertacolortotheRGBcolorspace.TheRGBcolorspacenolongergreedilyquantizesandclampschannelvalueswhencreatingcolors,improvingaccuracyincolorspaceconversion.Quantizationandclampingnowoccursin*color*.toStringwhenformattingacolorfordisplay.Youcanusethenew[*color*.displayable](https://github.com/d3/d3-color/blob/master/README.md#color_displayable)totestwhetheracoloris[out-of-gamut](https://en.wikipedia.org/wiki/Gamut).The[*rgb*.brighter](https://github.com/d3/d3-color/blob/master/README.md#rgb_brighter)methodnolongerspecial-casesblack.Thisisamultiplicativeoperator,defininganewcolor*r*′,*g*′,*b*′where*r*′=*r*×*pow*(0.7,*k*),*g*′=*g*×*pow*(0.7,*k*)and*b*′=*b*×*pow*(0.7,*k*);abrighterblackisstillblack.There’sanew[d3.cubehelix](https://github.com/d3/d3-color/blob/master/README.md#cubehelix)colorspace,generalizingDaveGreen’scolorscheme!(Seealso[d3.interpolateCubehelixDefault](https://github.com/d3/d3-scale/blob/master/README.md#interpolateCubehelixDefault)from[d3-scale](#scales-d3-scale).)Youcancontinuetodefineyourowncustomcolorspaces,too;see[d3-hsv](https://github.com/d3/d3-hsv)foranexample.##[Dispatches(d3-dispatch)](https://github.com/d3/d3-dispatch/blob/master/README.md)Ratherthandecoratingthe*dispatch*objectwitheacheventtype,thedispatchobjectnowexposesgeneric[*dispatch*.call](https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_call)and[*dispatch*.apply](https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_apply)methodswhichtakethe*type*stringasthefirstargument.Forexample,inD33.x,youmightsay:```jsdispatcher.foo.call(that,"Hello,Foo!");```Todispatcha*foo*eventinD34.0,you’dsay:```jsdispatcher.call("foo",that,"Hello,Foo!");```The[*dispatch*.on](https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_on)methodnowacceptsmultipletypenames,allowingyoutoaddorremovelistenersformultipleeventssimultaneously.Forexample,tosendboth*foo*and*bar*eventstothesamelistener:```jsdispatcher.on("foobar",function(message){console.log(message);});```Thismatchesthenewbehaviorof[*selection*.on](https://github.com/d3/d3-selection/blob/master/README.md#selection_on)in[d3-selection](#selections-d3-selection).The*dispatch*.onmethodnowvalidatesthatthespecifier*listener*isafunction,ratherthanthrowinganerrorinthefuture.Thenewimplementationd3.dispatchisfaster,usingfewerclosurestoimproveperformance.There’salsoanew[*dispatch*.copy](https://github.com/d3/d3-dispatch/blob/master/README.md#dispatch_copy)methodformakingacopyofadispatcher;thisisusedby[d3-transition](#transitions-d3-transition)toimprovetheperformanceoftransitionsinthecommoncasewhereallelementsinatransitionhavethesametransitioneventlisteners.##[Dragging(d3-drag)](https://github.com/d3/d3-drag/blob/master/README.md)Thedragbehaviord3.behavior.draghasbeenrenamedtod3.drag.The*drag*.originmethodhasbeenreplacedby[*drag*.subject](https://github.com/d3/d3-drag/blob/master/README.md#drag_subject),whichallowsyoutodefinethethingbeingdraggedatthestartofadraggesture.ThisisparticularlyusefulwithCanvas,wheredraggableobjectstypicallyshareaCanvaselement(asopposedtoSVG,wheredraggableobjectstypicallyhavedistinctDOMelements);seethe[circledraggingexample](https://bl.ocks.org/mbostock/444757cc9f0fde320a5f469cd36860f4).Anew[*drag*.container](https://github.com/d3/d3-drag/blob/master/README.md#drag_container)methodletsyouoverridetheparentelementthatdefinesthedraggesturecoordinatesystem.Thisdefaultstotheparentnodeoftheelementtowhichthedragbehaviorwasapplied.FordraggingonCanvaselements,youprobablywanttousetheCanvaselementasthecontainer.[Dragevents](https://github.com/d3/d3-drag/blob/master/README.md#drag-events)nowexposean[*event*.on](https://github.com/d3/d3-drag/blob/master/README.md#event_on)methodforregisteringtemporarylistenersfordurationofthecurrentdraggesture;theselistenerscancapturestateforthecurrentgesture,suchasthethingbeingdragged.Anew*event*.activepropertyletsyoudetectwhethermultiple(multitouch)draggesturesareactiveconcurrently.The*dragstart*and*dragend*eventshavebeenrenamedto*start*and*end*.Bydefault,dragbehaviorsnowignoreright-clicksintendedforthecontextmenu;use[*drag*.filter](https://github.com/d3/d3-drag/blob/master/README.md#drag_filter)tocontrolwhicheventsareignored.ThedragbehavioralsoignoresemulatedmouseeventsoniOS.Thedragbehaviornowconsumeshandledevents,makingiteasiertocombinewithotherinteractivebehaviorssuchas[zooming](#zooming-d3-zoom).Thenew[d3.dragEnable](https://github.com/d3/d3-drag/blob/master/README.md#dragEnable)and[d3.dragDisable](https://github.com/d3/d3-drag/blob/master/README.md#dragDisable)methodsprovidealow-levelAPIforimplementingdraggesturesacrossbrowsersanddevices.ThesemethodsarealsousedbyotherD3components,suchasthe[brush](#brushes-d3-brush).##[Delimiter-SeparatedValues(d3-dsv)](https://github.com/d3/d3-dsv/blob/master/README.md)Pursuanttothegreatnamespaceflattening,variousCSVandTSVmethodshavenewnames:*d3.csv.parse↦[d3.csvParse](https://github.com/d3/d3-dsv/blob/master/README.md#csvParse)*d3.csv.parseRows↦[d3.csvParseRows](https://github.com/d3/d3-dsv/blob/master/README.md#csvParseRows)*d3.csv.format↦[d3.csvFormat](https://github.com/d3/d3-dsv/blob/master/README.md#csvFormat)*d3.csv.formatRows↦[d3.csvFormatRows](https://github.com/d3/d3-dsv/blob/master/README.md#csvFormatRows)*d3.tsv.parse↦[d3.tsvParse](https://github.com/d3/d3-dsv/blob/master/README.md#tsvParse)*d3.tsv.parseRows↦[d3.tsvParseRows](https://github.com/d3/d3-dsv/blob/master/README.md#tsvParseRows)*d3.tsv.format↦[d3.tsvFormat](https://github.com/d3/d3-dsv/blob/master/README.md#tsvFormat)*d3.tsv.formatRows↦[d3.tsvFormatRows](https://github.com/d3/d3-dsv/blob/master/README.md#tsvFormatRows)The[d3.csv](https://github.com/d3/d3-request/blob/master/README.md#csv)and[d3.tsv](https://github.com/d3/d3-request/blob/master/README.md#tsv)methodsforloadingfilesofthecorrespondingformatshavenotbeenrenamed,however!Thosearedefinedin[d3-request](#requests-d3-request).There’snolongerad3.dsvmethod,whichservedthetriplepurposeofdefiningaDSVformatter,aDSVparserandaDSVrequestor;instead,there’sjust[d3.dsvFormat](https://github.com/d3/d3-dsv/blob/master/README.md#dsvFormat)whichyoucanusetodefineaDSVformatterandparser.Youcanuse[*request*.response](https://github.com/d3/d3-request/blob/master/README.md#request_response)tomakearequestandthenparsetheresponsebody,orjustuse[d3.text](https://github.com/d3/d3-request/blob/master/README.md#text).The[*dsv*.parse](https://github.com/d3/d3-dsv/blob/master/README.md#dsv_parse)methodnowexposesthecolumnnamesandtheirinputorderas*data*.columns.Forexample:```jsd3.csv("cars.csv",function(error,data){if(error)throwerror;console.log(data.columns);//["Year","Make","Model","Length"]});```Youcanlikewisepassanoptionalarrayofcolumnnamesto[*dsv*.format](https://github.com/d3/d3-dsv/blob/master/README.md#dsv_format)toformatonlyasubsetofcolumns,ortospecifythecolumnorderexplicitly:```jsvarstring=d3.csvFormat(data,["Year","Model","Length"]);```Theparserisabitfasterandtheformatterisabitmorerobust:inputsarecoercedtostringsbeforeformatting,fixinganobscurecrash,anddeprecatedsupportforfallingbackto[*dsv*.formatRows](https://github.com/d3/d3-dsv/blob/master/README.md#dsv_formatRows)whentheinput*data*isanarrayofarrayshasbeenremoved.##[Easings(d3-ease)](https://github.com/d3/d3-ease/blob/master/README.md)D33.xusedstrings,suchas“cubic-in-out”,toidentifyeasingmethods;thesestringscouldbepassedtod3.easeor*transition*.ease.D34.0usessymbolsinstead,suchas[d3.easeCubicInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeCubicInOut).Symbolsaresimplerandcleaner.TheyworkwellwithRolluptoproducesmallercustombundles.Youcanstilldefineyourowncustomeasingfunction,too,ifdesired.Here’sthefulllistofequivalents:*linear↦[d3.easeLinear](https://github.com/d3/d3-ease/blob/master/README.md#easeLinear)¹*linear-in↦[d3.easeLinear](https://github.com/d3/d3-ease/blob/master/README.md#easeLinear)¹*linear-out↦[d3.easeLinear](https://github.com/d3/d3-ease/blob/master/README.md#easeLinear)¹*linear-in-out↦[d3.easeLinear](https://github.com/d3/d3-ease/blob/master/README.md#easeLinear)¹*linear-out-in↦[d3.easeLinear](https://github.com/d3/d3-ease/blob/master/README.md#easeLinear)¹*poly-in↦[d3.easePolyIn](https://github.com/d3/d3-ease/blob/master/README.md#easePolyIn)*poly-out↦[d3.easePolyOut](https://github.com/d3/d3-ease/blob/master/README.md#easePolyOut)*poly-in-out↦[d3.easePolyInOut](https://github.com/d3/d3-ease/blob/master/README.md#easePolyInOut)*poly-out-in↦REMOVED²*quad-in↦[d3.easeQuadIn](https://github.com/d3/d3-ease/blob/master/README.md#easeQuadIn)*quad-out↦[d3.easeQuadOut](https://github.com/d3/d3-ease/blob/master/README.md#easeQuadOut)*quad-in-out↦[d3.easeQuadInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeQuadInOut)*quad-out-in↦REMOVED²*cubic-in↦[d3.easeCubicIn](https://github.com/d3/d3-ease/blob/master/README.md#easeCubicIn)*cubic-out↦[d3.easeCubicOut](https://github.com/d3/d3-ease/blob/master/README.md#easeCubicOut)*cubic-in-out↦[d3.easeCubicInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeCubicInOut)*cubic-out-in↦REMOVED²*sin-in↦[d3.easeSinIn](https://github.com/d3/d3-ease/blob/master/README.md#easeSinIn)*sin-out↦[d3.easeSinOut](https://github.com/d3/d3-ease/blob/master/README.md#easeSinOut)*sin-in-out↦[d3.easeSinInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeSinInOut)*sin-out-in↦REMOVED²*exp-in↦[d3.easeExpIn](https://github.com/d3/d3-ease/blob/master/README.md#easeExpIn)*exp-out↦[d3.easeExpOut](https://github.com/d3/d3-ease/blob/master/README.md#easeExpOut)*exp-in-out↦[d3.easeExpInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeExpInOut)*exp-out-in↦REMOVED²*circle-in↦[d3.easeCircleIn](https://github.com/d3/d3-ease/blob/master/README.md#easeCircleIn)*circle-out↦[d3.easeCircleOut](https://github.com/d3/d3-ease/blob/master/README.md#easeCircleOut)*circle-in-out↦[d3.easeCircleInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeCircleInOut)*circle-out-in↦REMOVED²*elastic-in↦[d3.easeElasticOut](https://github.com/d3/d3-ease/blob/master/README.md#easeElasticOut)²*elastic-out↦[d3.easeElasticIn](https://github.com/d3/d3-ease/blob/master/README.md#easeElasticIn)²*elastic-in-out↦REMOVED²*elastic-out-in↦[d3.easeElasticInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeElasticInOut)²*back-in↦[d3.easeBackIn](https://github.com/d3/d3-ease/blob/master/README.md#easeBackIn)*back-out↦[d3.easeBackOut](https://github.com/d3/d3-ease/blob/master/README.md#easeBackOut)*back-in-out↦[d3.easeBackInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeBackInOut)*back-out-in↦REMOVED²*bounce-in↦[d3.easeBounceOut](https://github.com/d3/d3-ease/blob/master/README.md#easeBounceOut)²*bounce-out↦[d3.easeBounceIn](https://github.com/d3/d3-ease/blob/master/README.md#easeBounceIn)²*bounce-in-out↦REMOVED²*bounce-out-in↦[d3.easeBounceInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeBounceInOut)²¹The-in,-outand-in-outvariantsoflineareasingareidentical,sothere’sjustd3.easeLinear.<br>²Elasticandbounceeasingwereinadvertentlyreversedin3.x,so4.0eliminates-out-ineasing!Forconvenience,therearealsodefaultaliasesforeacheasingmethod.Forexample,[d3.easeCubic](https://github.com/d3/d3-ease/blob/master/README.md#easeCubic)isanaliasfor[d3.easeCubicInOut](https://github.com/d3/d3-ease/blob/master/README.md#easeCubicInOut).Mostdefaultto-in-out;theexceptions are[d3.easeBounce](https://github.com/d3/d3-ease/blob/master/README.md#easeBounce)and[d3.easeElastic](https://github.com/d3/d3-ease/blob/master/README.md#easeElastic),whichdefaultto-out.Ratherthanpassoptionalargumentstod3.easeor*transition*.ease,parameterizableeasingfunctionsnowhavenamedparameters:[*poly*.exponent](https://github.com/d3/d3-ease/blob/master/README.md#poly_exponent),[*elastic*.amplitude](https://github.com/d3/d3-ease/blob/master/README.md#elastic_amplitude),[*elastic*.period](https://github.com/d3/d3-ease/blob/master/README.md#elastic_period)and[*back*.overshoot](https://github.com/d3/d3-ease/blob/master/README.md#back_overshoot).Forexample,inD33.xyoumightsay:```jsvare=d3.ease("elastic-out-in",1.2);```TheequivalentinD34.0is:```jsvare=d3.easeElastic.amplitude(1.2);```Manyoftheeasingfunctionshavebeenoptimizedforperformanceandaccuracy.Severalbugshavebeenfixed,aswell,suchastheinterpretationoftheovershootparameterforbackeasing,andtheperiodparameterforelasticeasing.Also,[d3-transition](#transitions-d3-transition)nowexplicitlyguaranteesthatthelasttickofthetransitionhappensatexactly*t*=1,avoidingfloatingpointerrorsinsomeeasingfunctions.There’snowanice[visualreference](https://github.com/d3/d3-ease/blob/master/README.md)andan[animatedreference](https://bl.ocks.org/mbostock/248bac3b8e354a9103c4)totheneweasingfunctions,too!##[Forces(d3-force)](https://github.com/d3/d3-force/blob/master/README.md)Theforcelayoutd3.layout.forcehasbeenrenamedtod3.forceSimulation.Theforcesimulationnowuses[velocityVerletintegration](https://en.wikipedia.org/wiki/Verlet_integration#Velocity_Verlet)ratherthanpositionVerlet,trackingthenodes’positions(*node*.x,*node*.y)andvelocities(*node*.vx,*node*.vy)ratherthantheirpreviouspositions(*node*.px,*node*.py).Ratherthanhard-codingasetofbuilt-inforces,theforcesimulationisnowextensible:youspecifywhichforcesyouwant!Theapproachaffordsgreaterflexibilitythroughcomposition.Thenewforcesaremoreflexible,too:forceparameterscantypicallybeconfiguredper-nodeorper-link.Thereareseparatepositioningforcesfor[*x*](https://github.com/d3/d3-force/blob/master/README.md#forceX)and[*y*](https://github.com/d3/d3-force/blob/master/README.md#forceY)thatreplace*force*.gravity;[*x*.x](https://github.com/d3/d3-force/blob/master/README.md#x_x)and[*y*.y](https://github.com/d3/d3-force/blob/master/README.md#y_y)replace*force*.size.Thenew[linkforce](https://github.com/d3/d3-force/blob/master/README.md#forceLink)replaces*force*.linkStrengthandemploysbetterdefaultheuristicstoimprovestability.Thenew[many-bodyforce](https://github.com/d3/d3-force/blob/master/README.md#forceManyBody)replaces*force*.chargeandsupportsanew[minimum-distanceparameter](https://github.com/d3/d3-force/blob/master/README.md#manyBody_distanceMin)andperformanceimprovementsthanksto4.0’s[newquadtrees](#quadtrees-d3-quadtree).Therearealsobrand-newforcesfor[centeringnodes](https://github.com/d3/d3-force/blob/master/README.md#forceCenter)and[collisionresolution](https://github.com/d3/d3-force/blob/master/README.md#forceCollision).Thenewforcesandsimulationhavebeencarefullycraftedtoavoidnondeterminism.Ratherthaninitializingnodesrandomly,ifthenodesdonothavepresetpositions,theyareplacedinaphyllotaxispattern:<imgalt="Phyllotaxis"src="https://raw.githubusercontent.com/d3/d3-force/master/img/phyllotaxis.png"width="420"height="219">Randomjitterisstillneededtoresolvelink,collisionandmany-bodyforcesiftherearecoincidentnodes,butatleastinthecommoncase,theforcesimulation(andtheresultingforce-directedgraphlayout)isnowconsistentacrossbrowsersandreloads.D3nolongerplaysdice!Theforcesimulationhasseveralnewmethodsforgreatercontroloverheating,suchas[*simulation*.alphaMin](https://github.com/d3/d3-force/blob/master/README.md#simulation_alphaMin)and[*simulation*.alphaDecay](https://github.com/d3/d3-force/blob/master/README.md#simulation_alphaDecay),andtheinternaltimer.Calling[*simulation*.alpha](https://github.com/d3/d3-force/blob/master/README.md#simulation_alpha)nowhasnoeffectontheinternaltimer,whichiscontrolledindependentlyvia[*simulation*.stop](https://github.com/d3/d3-force/blob/master/README.md#simulation_stop)and[*simulation*.restart](https://github.com/d3/d3-force/blob/master/README.md#simulation_restart).Theforcelayout’sinternaltimernowstartsautomaticallyoncreation,removing*force*.start.Asin3.x,youcanadvancethesimulationmanuallyusing[*simulation*.tick](https://github.com/d3/d3-force/blob/master/README.md#simulation_tick).The*force*.frictionparameterisreplacedby*simulation*.velocityDecay.Anew[*simulation*.alphaTarget](https://github.com/d3/d3-force/blob/master/README.md#simulation_alphaTarget)methodallowsyoutosetthedesiredalpha(temperature)ofthesimulation,suchthatthesimulationcanbesmoothlyreheatedduringinteraction,andthensmoothlycooledagain.Thisimprovesthestabilityofthegraphduringinteraction.Theforcelayoutnolongerdependsonthe[dragbehavior](#dragging-d3-drag),thoughyoucancertainlycreate[draggableforce-directedgraphs](https://bl.ocks.org/mbostock/ad70335eeef6d167bc36fd3c04378048)!Set*node*.fxand*node*.fytofixanode’sposition.Asanalternativetoa[Voronoi](#voronoi-d3-voronoi)SVGoverlay,youcannowuse[*simulation*.find](https://github.com/d3/d3-force/blob/master/README.md#simulation_find)tofindtheclosestnodetoapointer.##[NumberFormats(d3-format)](https://github.com/d3/d3-format/blob/master/README.md)Ifaprecisionisnotspecified,theformattingbehaviorhaschanged:thereisnowadefaultprecisionof6foralldirectivesexcept*none*,whichdefaultsto12.In3.x,ifyoudidnotspecifyaprecision,thenumberwasformattedusingitsshortestuniquerepresentation(per[*number*.toString](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toString));thiscouldleadtounexpecteddigitsdueto[floatingpointmath](http://0.30000000000000004.com/).Thenewdefaultprecisionin4.0producesmoreconsistentresults:```jsvarf=d3.format("e");f(42);//"4.200000e+1"f(0.1+0.2);//"3.000000e-1"```Totriminsignificanttrailingzeroes,usethe*none*directive,whichissimilar`g`.Forexample:```jsvarf=d3.format(".3");f(0.12345);//"0.123"f(0.10000);//"0.1"f(0.1+0.2);//"0.3"```Underthehood,numberformattinghasimprovedaccuracywithverylargeandverysmallnumbersbyusing[*number*.toExponential](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toExponential)ratherthan[Math.log](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log)toextractthemantissaandexponent.Negativezero(-0,anIEEE754construct)andverysmallnumbersthatroundtozeroarenowformattedasunsignedzero.Theinherentlyunsafed3.roundmethodhasbeenremoved,alongwithd3.requote.The[d3.formatPrefix](https://github.com/d3/d3-format/blob/master/README.md#formatPrefix)methodhasbeenchanged.RatherthanreturninganSI-prefixstring,itreturnsanSI-prefixformatfunctionforagiven*specifier*andreference*value*.Forexample,toformatthousands:```jsvarf=d3.formatPrefix(",.0",1e3);f(1e3);//"1k"f(1e4);//"10k"f(1e5);//"100k"f(1e6);//"1,000k"```Unlikethe`s`formatdirective,d3.formatPrefixalwaysemploysthesameSI-prefix,producingconsistentresults:```jsvarf=d3.format(".0s");f(1e3);//"1k"f(1e4);//"10k"f(1e5);//"100k"f(1e6);//"1M"```Thenew`(`signoptionusesparenthesesfornegativevalues.Thisisparticularlyusefulinconjunctionwith`$`.Forexample:```jsd3.format("+.0f")(-42);//"-42"d3.format("(.0f")(-42);//"(42)"d3.format("+$.0f")(-42);//"-$42"d3.format("($.0f")(-42);//"($42)"```Thenew`=`alignoptionplacesanysignandsymboltotheleftofanypadding:```jsd3.format(">6d")(-42);//"-42"d3.format("=6d")(-42);//"-42"d3.format(">(6d")(-42);//"(42)"d3.format("=(6d")(-42);//"(42)"```The`b`,`o`,`d`and`x`directivesnowroundtothenearestinteger,ratherthanreturningtheemptystringfornon-integers:```jsd3.format("b")(41.9);//"101010"d3.format("o")(41.9);//"52"d3.format("d")(41.9);//"42"d3.format("x")(41.9);//"2a"```The`c`directiveisnowforcharacterdata(*i.e.*,literalstrings),notforcharactercodes.Theisusefulifyoujustwanttoapplypaddingandalignmentanddon’tcareaboutformattingnumbers.Forexample,theinfamous[left-pad](http://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm)(aswellascenter-andright-pad!)canbeconvenientlyimplementedas:```jsd3.format(">10c")("foo");//"foo"d3.format("^10c")("foo");//"foo"d3.format("<10c")("foo");//"foo"```Thereareseveralnewmethodsforcomputingsuggesteddecimalprecisions;theseareusedby[d3-scale](#scales-d3-scale)fortickformatting,andarehelpfulforimplementingcustomnumberformats:[d3.precisionFixed](https://github.com/d3/d3-format/blob/master/README.md#precisionFixed),[d3.precisionPrefix](https://github.com/d3/d3-format/blob/master/README.md#precisionPrefix)and[d3.precisionRound](https://github.com/d3/d3-format/blob/master/README.md#precisionRound).There’salsoanew[d3.formatSpecifier](https://github.com/d3/d3-format/blob/master/README.md#formatSpecifier)methodforparsing,validatinganddebuggingformatspecifiers;it’salsogoodforderivingrelatedformatspecifiers,suchaswhenyouwanttosubstitutetheprecisionautomatically.Youcannowsetthedefaultlocaleusing[d3.formatDefaultLocale](https://github.com/d3/d3-format/blob/master/README.md#formatDefaultLocale)!Thelocalesarepublishedas[JSON](https://github.com/d3/d3-request/blob/master/README.md#json)to[npm](https://unpkg.com/d3-format/locale/).##[Geographies(d3-geo)](https://github.com/d3/d3-geo/blob/master/README.md)Pursuanttothegreatnamespaceflattening,variousmethodshavenewnames:*d3.geo.graticule↦[d3.geoGraticule](https://github.com/d3/d3-geo/blob/master/README.md#geoGraticule)*d3.geo.circle↦[d3.geoCircle](https://github.com/d3/d3-geo/blob/master/README.md#geoCircle)*d3.geo.area↦[d3.geoArea](https://github.com/d3/d3-geo/blob/master/README.md#geoArea)*d3.geo.bounds↦[d3.geoBounds](https://github.com/d3/d3-geo/blob/master/README.md#geoBounds)*d3.geo.centroid↦[d3.geoCentroid](https://github.com/d3/d3-geo/blob/master/README.md#geoCentroid)*d3.geo.distance↦[d3.geoDistance](https://github.com/d3/d3-geo/blob/master/README.md#geoDistance)*d3.geo.interpolate↦[d3.geoInterpolate](https://github.com/d3/d3-geo/blob/master/README.md#geoInterpolate)*d3.geo.length↦[d3.geoLength](https://github.com/d3/d3-geo/blob/master/README.md#geoLength)*d3.geo.rotation↦[d3.geoRotation](https://github.com/d3/d3-geo/blob/master/README.md#geoRotation)*d3.geo.stream↦[d3.geoStream](https://github.com/d3/d3-geo/blob/master/README.md#geoStream)*d3.geo.path↦[d3.geoPath](https://github.com/d3/d3-geo/blob/master/README.md#geoPath)*d3.geo.projection↦[d3.geoProjection](https://github.com/d3/d3-geo/blob/master/README.md#geoProjection)*d3.geo.projectionMutator↦[d3.geoProjectionMutator](https://github.com/d3/d3-geo/blob/master/README.md#geoProjectionMutator)*d3.geo.albers↦[d3.geoAlbers](https://github.com/d3/d3-geo/blob/master/README.md#geoAlbers)*d3.geo.albersUsa↦[d3.geoAlbersUsa](https://github.com/d3/d3-geo/blob/master/README.md#geoAlbersUsa)*d3.geo.azimuthalEqualArea↦[d3.geoAzimuthalEqualArea](https://github.com/d3/d3-geo/blob/master/README.md#geoAzimuthalEqualArea)*d3.geo.azimuthalEquidistant↦[d3.geoAzimuthalEquidistant](https://github.com/d3/d3-geo/blob/master/README.md#geoAzimuthalEquidistant)*d3.geo.conicConformal↦[d3.geoConicConformal](https://github.com/d3/d3-geo/blob/master/README.md#geoConicConformal)*d3.geo.conicEqualArea↦[d3.geoConicEqualArea](https://github.com/d3/d3-geo/blob/master/README.md#geoConicEqualArea)*d3.geo.conicEquidistant↦[d3.geoConicEquidistant](https://github.com/d3/d3-geo/blob/master/README.md#geoConicEquidistant)*d3.geo.equirectangular↦[d3.geoEquirectangular](https://github.com/d3/d3-geo/blob/master/README.md#geoEquirectangular)*d3.geo.gnomonic↦[d3.geoGnomonic](https://github.com/d3/d3-geo/blob/master/README.md#geoGnomonic)*d3.geo.mercator↦[d3.geoMercator](https://github.com/d3/d3-geo/blob/master/README.md#geoMercator)*d3.geo.orthographic↦[d3.geoOrthographic](https://github.com/d3/d3-geo/blob/master/README.md#geoOrthographic)*d3.geo.stereographic↦[d3.geoStereographic](https://github.com/d3/d3-geo/blob/master/README.md#geoStereographic)*d3.geo.transverseMercator↦[d3.geoTransverseMercator](https://github.com/d3/d3-geo/blob/master/README.md#geoTransverseMercator)Alsorenamedforconsistency:**circle*.origin↦[*circle*.center](https://github.com/d3/d3-geo/blob/master/README.md#circle_center)**circle*.angle↦[*circle*.radius](https://github.com/d3/d3-geo/blob/master/README.md#circle_radius)**graticule*.majorExtent↦[*graticule*.extentMajor](https://github.com/d3/d3-geo/blob/master/README.md#graticule_extentMajor)**graticule*.minorExtent↦[*graticule*.extentMinor](https://github.com/d3/d3-geo/blob/master/README.md#graticule_extentMinor)**graticule*.majorStep↦[*graticule*.stepMajor](https://github.com/d3/d3-geo/blob/master/README.md#graticule_stepMajor)**graticule*.minorStep↦[*graticule*.stepMinor](https://github.com/d3/d3-geo/blob/master/README.md#graticule_stepMinor)Projectionsnowhavemoreappropriatedefaults.Forexample,[d3.geoOrthographic](https://github.com/d3/d3-geo/blob/master/README.md#geoOrthographic)hasa90°clipanglebydefault,showingonlythefronthemisphere,and[d3.geoGnomonic](https://github.com/d3/d3-geo/blob/master/README.md#geoGnomonic)hasadefault60°clipangle.Thedefault[projection](https://github.com/d3/d3-geo/blob/master/README.md#path_projection)for[d3.geoPath](https://github.com/d3/d3-geo/blob/master/README.md#geoPath)isnownullratherthan[d3.geoAlbersUsa](https://github.com/d3/d3-geo/blob/master/README.md#geoAlbersUsa);anullprojectionisusedwith[pre-projectedgeometry](https://bl.ocks.org/mbostock/5557726)andistypicallyfastertorender.“Fallbackprojections”—whenyoupassafunctionratherthanaprojectionto[*path*.projection](https://github.com/d3/d3-geo/blob/master/README.md#path_projection)—arenolongersupported.Forgeographicprojections,use[d3.geoProjection](https://github.com/d3/d3-geo/blob/master/README.md#geoProjection)or[d3.geoProjectionMutator](https://github.com/d3/d3-geo/blob/master/README.md#geoProjectionMutator)todefineacustomprojection.Forarbitrarygeometrytransformations,implementthe[streaminterface](https://github.com/d3/d3-geo/blob/master/README.md#streams);seealso[d3.geoTransform](https://github.com/d3/d3-geo/blob/master/README.md#geoTransform).The“raw”projections(e.g.,d3.geo.equirectangular.raw)arenolongerexported.##[Hierarchies(d3-hierarchy)](https://github.com/d3/d3-hierarchy/blob/master/README.md)Pursuanttothegreatnamespaceflattening:*d3.layout.cluster↦[d3.cluster](https://github.com/d3/d3-hierarchy/blob/master/README.md#cluster)*d3.layout.hierarchy↦[d3.hierarchy](https://github.com/d3/d3-hierarchy/blob/master/README.md#hierarchy)*d3.layout.pack↦[d3.pack](https://github.com/d3/d3-hierarchy/blob/master/README.md#pack)*d3.layout.partition↦[d3.partition](https://github.com/d3/d3-hierarchy/blob/master/README.md#partition)*d3.layout.tree↦[d3.tree](https://github.com/d3/d3-hierarchy/blob/master/README.md#tree)*d3.layout.treemap↦[d3.treemap](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap)AsanalternativetousingJSONtorepresenthierarchicaldata(suchasthe“flare.jsonformat”usedbymanyD3examples),thenew[d3.stratify](https://github.com/d3/d3-hierarchy/blob/master/README.md#stratify)operatorsimplifiestheconversionoftabulardatatohierarchicaldata!Thisisconvenientifyoualreadyhavedatainatabularformat,suchastheresultofaSQLqueryoraCSVfile:```name,parentEve,Cain,EveSeth,EveEnos,SethNoam,SethAbel,EveAwan,EveEnoch,AwanAzura,Eve```Toconvertthistoaroot[*node*](https://github.com/d3/d3-hierarchy/blob/master/README.md#hierarchy):```jsvarroot=d3.stratify().id(function(d){returnd.name;}).parentId(function(d){returnd.parent;})(nodes);```Theresulting*root*canbepassedto[d3.tree](https://github.com/d3/d3-hierarchy/blob/master/README.md#tree)toproduceatreediagramlikethis:<imgsrc="https://raw.githubusercontent.com/d3/d3/master/img/stratify.png"width="298"height="137">RootnodescanalsobecreatedfromJSONdatausing[d3.hierarchy](https://github.com/d3/d3-hierarchy/blob/master/README.md#hierarchy).ThehierarchylayoutsnowtaketheserootnodesasinputratherthanoperatingdirectlyonJSONdata,whichhelpstoprovideacleanerseparationbetweentheinputdataandthecomputedlayout.(Forexample,use[*node*.copy](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_copy)toisolatelayoutchanges.)ItalsosimplifiestheAPI:ratherthaneachhierarchylayoutneedingtoimplementvalueandsortingaccessors,therearenowgeneric[*node*.sum](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_sum)and[*node*.sort](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_sort)methodsthatworkwithanyhierarchylayout.Thenewd3.hierarchyAPIalsoprovidesarichersetofmethodsformanipulatinghierarchicaldata.Forexample,togenerateanarrayofallnodesintopologicalorder,use[*node*.descendants](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_descendants);forjustleafnodes,use[*node*.leaves](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_leaves).Tohighlighttheancestorsofagiven*node*onmouseover,use[*node*.ancestors](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_ancestors).Togenerateanarrayof{source,target}linksforagivenhierarchy,use[*node*.links](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_links);thisreplaces*treemap*.linksandsimilarmethodsontheotherlayouts.Thenew[*node*.path](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_path)methodreplacesd3.layout.bundle;seealso[d3.curveBundle](https://github.com/d3/d3-shape/blob/master/README.md#curveBundle)forhierarchicaledgebundling.Thehierarchylayoutshavebeenrewrittenusingnew,non-recursivetraversalmethods([*node*.each](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_each),[*node*.eachAfter](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_eachAfter)and[*node*.eachBefore](https://github.com/d3/d3-hierarchy/blob/master/README.md#node_eachBefore)),improvingperformanceonlargedatasets.Thed3.treelayoutnolongerusesa*node*.\_fieldtostoretemporarystateduringlayout.Treemaptilingisnow[extensible](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap-tiling)via[*treemap*.tile](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_tile)!Thedefaultsquarifiedtilingalgorithm,[d3.treemapSquarify](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapSquarify),hasbeencompletelyrewritten,improvingperformanceandfixingbugsinpaddingandrounding.The*treemap*.stickymethodhasbeenreplacedwiththe[d3.treemapResquarify](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapResquarify),whichisidenticaltod3.treemapSquarifyexceptitperformsstableneighbor-preservingupdates.The*treemap*.ratiomethodhasbeenreplacedwith[*squarify*.ratio](https://github.com/d3/d3-hierarchy/blob/master/README.md#squarify_ratio).Andthere’sanew[d3.treemapBinary](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemapBinary)forbinarytreemaps!Treemappaddinghasalsobeenimproved.Thetreemapnowdistinguishesbetween[outerpadding](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingOuter)thatseparatesaparentfromitschildren,and[innerpadding](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingInner)thatseparatesadjacentsiblings.Youcansetthe[top-](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingTop),[right-](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingRight),[bottom-](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingBottom)and[left-](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap_paddingLeft)outerpaddingseparately.Therearenewexamplesforthetraditional[nestedtreemap](https://bl.ocks.org/mbostock/911ad09bdead40ec0061)andforLüandFogarty’s[cascadedtreemap](https://bl.ocks.org/mbostock/f85ffb3a5ac518598043).Andthere’sanewexampledemonstrating[d3.nestwithd3.treemap](https://bl.ocks.org/mbostock/2838bf53e0e65f369f476afd653663a2).Thespace-fillinglayouts[d3.treemap](https://github.com/d3/d3-hierarchy/blob/master/README.md#treemap)and[d3.partition](https://github.com/d3/d3-hierarchy/blob/master/README.md#partition)nowoutput*x0*,*x1*,*y0*,*y1*oneachnodeinsteadof*x0*,*dx*,*y0*,*dy*.Thisimprovesaccuracybyensuringthattheedgesofadjacentcellsareexactlyequal,ratherthansometimesbeingslightlyoffduetofloatingpointmath.Thepartitionlayoutnowsupports[rounding](https://github.com/d3/d3-hierarchy/blob/master/README.md#partition_round)and[padding](https://github.com/d3/d3-hierarchy/blob/master/README.md#partition_padding).Thecircle-packinglayout,[d3.pack](https://github.com/d3/d3-hierarchy/blob/master/README.md#pack),hasbeencompletelyrewrittentobetterimplementWangetal.’salgorithm,fixingmajorbugsandimprovingresults!Welzl’salgorithmisnowusedtocomputetheexact[smallestenclosingcircle](https://bl.ocks.org/mbostock/29c534ff0b270054a01c)foreachparent,ratherthantheapproximateanswerusedbyWangetal.The3.xoutputisshownontheleft;4.0isshownontheright:<imgalt="CirclePackingin3.x"src="https://raw.githubusercontent.com/d3/d3/master/img/pack-v3.png"width="420"height="420"><imgalt="CirclePackingin4.0"src="https://raw.githubusercontent.com/d3/d3/master/img/pack-v4.png"width="420"height="420">Anon-hierarchicalimplementationisalsoavailableas[d3.packSiblings](https://github.com/d3/d3-hierarchy/blob/master/README.md#packSiblings),andthesmallestenclosingcircleimplementationisavailableas[d3.packEnclose](https://github.com/d3/d3-hierarchy/blob/master/README.md#packEnclose).[Packpadding](https://github.com/d3/d3-hierarchy/blob/master/README.md#pack_padding)nowappliesbetweenaparentanditschildren,aswellasbetweenadjacentsiblings.Inaddition,youcannowspecifypaddingasafunctionthatiscomputeddynamicallyforeachparent.##InternalsThed3.rebindmethodhasbeenremoved.(Seethe[3.xsource](https://github.com/d3/d3/blob/v3.5.17/src/core/rebind.js).)Ifyouwanttowrapagetter-settermethod,therecommendpatternistoimplementawrappermethodandcheckthereturnvalue.Forexample,givena*component*thatusesaninternal[*dispatch*](#dispatches-d3-dispatch),*component*.oncanrebind*dispatch*.onasfollows:```jscomponent.on=function(){varvalue=dispatch.on.apply(dispatch,arguments);returnvalue===dispatch?component:value;};```Thed3.functormethodhasbeenremoved.(Seethe[3.xsource](https://github.com/d3/d3/blob/v3.5.17/src/core/functor.js).)Ifyouwanttopromoteaconstantvaluetoafunction,therecommendedpatternistoimplementaclosurethatreturnstheconstantvalue.Ifdesired,youcanuseahelpermethodasfollows:```jsfunctionconstant(x){returnfunction(){returnx;};}```Givenavalue*x*,topromote*x*toafunctionifitisnotalready:```jsvarfx=typeofx==="function"?x:constant(x);```##[Interpolators(d3-interpolate)](https://github.com/d3/d3-interpolate/blob/master/README.md)The[d3.interpolate](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolate)methodnolongerdelegatestod3.interpolators,whichhasbeenremoved;itsbehaviorisnowdefinedbythelibrary.Itisnowslightlyfasterinthecommoncasethat*b*isanumber.Itonlyuses[d3.interpolateRgb](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateRgb)if*b*isavalidCSScolorspecifier(andnotapproximatelyone).Andiftheendvalue*b*isnull,undefined,trueorfalse,d3.interpolatenowreturnsaconstantfunctionwhichalwaysreturns*b*.Thebehaviorof[d3.interpolateObject](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateObject)and[d3.interpolateArray](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateArray)haschangedslightlywithrespecttopropertiesorelementsinthestartvalue*a*thatdonotexistintheendvalue*b*:thesepropertiesandelementsarenowignored,suchthattheendingvalueoftheinterpolatorat*t*=1isnowpreciselyequalto*b*.So,in3.x:```jsd3.interpolateObject({foo:2,bar:1},{foo:3})(0.5);//{bar:1,foo:2.5}in3.x```Whereasin4.0,*a*.barisignored:```jsd3.interpolateObject({foo:2,bar:1},{foo:3})(0.5);//{foo:2.5}in4.0```If*a*or*b*areundefinedornotanobject,theyarenowimplicitlyconvertedtotheemptyobjectoremptyarrayasappropriate,ratherthanthrowingaTypeError.Thed3.interpolateTransforminterpolatorhasbeenrenamedto[d3.interpolateTransformSvg](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformSvg),andthereisanew[d3.interpolateTransformCss](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformCss)tointerpolateCSStransforms!Thisallows[d3-transition](#transitions-d3-transition)toautomaticallyinterpolateboththeSVG[transformattribute](https://www.w3.org/TR/SVG/coords.html#TransformAttribute)andtheCSS[transformstyleproperty](https://www.w3.org/TR/css-transforms-1/#transform-property).(Note,however,thatonly2DCSStransformsaresupported.)Thed3.transformmethodhasbeenremoved.Colorspaceinterpolatorsnowinterpolateopacity(see[d3-color](#colors-d3-color))andreturnrgb(…)orrgba(…)CSScolorspecifierstringsratherthanusingtheRGBhexadecimalformat.Thisisnecessarytosupportopacityinterpolation,butisalsobeneficialbecauseitmatchesCSScomputedvalues.Whenachannelinthestartcolor*a*isundefined,colorinterpolatorsnowusethecorrespondingchannelvaluefromtheendcolor*b*,or*viceversa*.Thislogicpreviouslyappliedtosomechannels(suchassaturationinHSL),butnowappliestoallchannelsinallcolorspaces,andisespeciallyusefulwheninterpolatingtoorfromtransparent.Therearenow“long”versionsofcylindricalcolorspaceinterpolators:[d3.interpolateHslLong](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateHslLong),[d3.interpolateHclLong](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateHclLong)and[d3.interpolateCubehelixLong](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateCubehelixLong).Theseinterpolatorsuselinearinterpolationofhue,ratherthanusingtheshortestpatharoundthe360°huecircle.See[d3.interpolateRainbow](https://github.com/d3/d3-scale/blob/master/README.md#interpolateRainbow)foranexample.TheCubehelixcolorspaceisnowsupportedby[d3-color](#colors-d3-color),andsotherearenow[d3.interpolateCubehelix](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateCubehelix)and[d3.interpolateCubehelixLong](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateCubehelixLong)interpolators.[Gamma-correctedcolorinterpolation](https://web.archive.org/web/20160112115812/http://www.4p8.com/eric.brasseur/gamma.html)isnowsupportedforbothRGBandCubehelixcolorspacesas[*interpolate*.gamma](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolate_gamma).Forexample,tointerpolatefrompurpletoorangewithagammaof2.2inRGBspace:```jsvarinterpolate=d3.interpolateRgb.gamma(2.2)("purple","orange");```Therearenewinterpolatorsforuniformnon-rational[B-splines](https://en.wikipedia.org/wiki/B-spline)!Theseareusefulforsmoothlyinterpolatingbetweenanarbitrarysequenceofvaluesfrom*t*=0to*t*=1,suchastogenerateasmoothcolorgradientfromadiscretesetofcolors.The[d3.interpolateBasis](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateBasis)and[d3.interpolateBasisClosed](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateBasisClosed)interpolatorsgenerateone-dimensionalB-splines,while[d3.interpolateRgbBasis](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateRgbBasis)and[d3.interpolateRgbBasisClosed](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateRgbBasisClosed)generatethree-dimensionalB-splinesthroughRGBcolorspace.Theseareusedby[d3-scale-chromatic](https://github.com/d3/d3-scale-chromatic)togeneratecontinuouscolorscalesfromColorBrewer’sdiscretecolorschemes,suchas[PiYG](https://bl.ocks.org/mbostock/048d21cf747371b11884f75ad896e5a5).There’salsonowa[d3.quantize](https://github.com/d3/d3-interpolate/blob/master/README.md#quantize)methodforgeneratinguniformly-spaceddiscretesamplesfromacontinuousinterpolator.Thisisusefulfortakingoneofthebuilt-incolorscales(suchas[d3.interpolateViridis](https://github.com/d3/d3-scale/blob/master/README.md#interpolateViridis))andquantizingitforusewith[d3.scaleQuantize](https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantize),[d3.scaleQuantile](https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantile)or[d3.scaleThreshold](https://github.com/d3/d3-scale/blob/master/README.md#scaleThreshold).##[Paths(d3-path)](https://github.com/d3/d3-path/blob/master/README.md)The[d3.path](https://github.com/d3/d3-path/blob/master/README.md#path)serializerimplementsthe[CanvasPathMethodsAPI](https://www.w3.org/TR/2dcontext/#canvaspathmethods),allowingyoutowritecodethatcanrendertoeitherCanvasorSVG.Forexample,givensomecodethatdrawstoacanvas:```jsfunctiondrawCircle(context,radius){context.moveTo(radius,0);context.arc(0,0,radius,0,2*Math.PI);}```YoucanrendertoSVGasfollows:```jsvarcontext=d3.path();drawCircle(context,40);pathElement.setAttribute("d",context.toString());```Thepathserializerenables[d3-shape](#shapes-d3-shape)tosupportbothCanvasandSVG;see[*line*.context](https://github.com/d3/d3-shape/blob/master/README.md#line_context)and[*area*.context](https://github.com/d3/d3-shape/blob/master/README.md#area_context),forexample.##[Polygons(d3-polygon)](https://github.com/d3/d3-polygon/blob/master/README.md)There’snolongerad3.geom.polygonconstructor;insteadyoujustpassanarrayofverticestothepolygonmethods.Soinsteadof*polygon*.areaand*polygon*.centroid,there’s[d3.polygonArea](https://github.com/d3/d3-polygon/blob/master/README.md#polygonArea)and[d3.polygonCentroid](https://github.com/d3/d3-polygon/blob/master/README.md#polygonCentroid).Therearealsonew[d3.polygonContains](https://github.com/d3/d3-polygon/blob/master/README.md#polygonContains)and[d3.polygonLength](https://github.com/d3/d3-polygon/blob/master/README.md#polygonLength)methods.There’snolongeranequivalentto*polygon*.clip,butif[Sutherland–Hodgmanclipping](https://en.wikipedia.org/wiki/Sutherland–Hodgman_algorithm)isneeded,please[fileafeaturerequest](https://github.com/d3/d3-polygon/issues).Thed3.geom.hulloperatorhasbeensimplified:insteadofanoperatorwith*hull*.xand*hull*.yaccessors,there’sjustthe[d3.polygonHull](https://github.com/d3/d3-polygon/blob/master/README.md#polygonHull)methodwhichtakesanarrayofpointsandreturnstheconvexhull.##[Quadtrees(d3-quadtree)](https://github.com/d3/d3-quadtree/blob/master/README.md)Thed3.geom.quadtreemethodhasbeenreplacedby[d3.quadtree](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree).4.0removestheconceptofquadtree“generators”(configurablefunctionsthatbuildaquadtreefromanarrayofdata);therearenowjustquadtrees,whichyoucancreateviad3.quadtreeandadddatatovia[*quadtree*.add](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_add)and[*quadtree*.addAll](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_addAll).Thiscodein3.x:```jsvarquadtree=d3.geom.quadtree().extent([[0,0],[width,height]])(data);```Canberewrittenin4.0as:```jsvarquadtree=d3.quadtree().extent([[0,0],[width,height]]).addAll(data);```Thenewquadtreeimplementationisvastlyimproved!Itisnolongerrecursive,avoidingstackoverflowswhentherearelargenumbersofcoincidentpoints.Theinternalstorageisnowmoreefficient,andtheimplementationisalsofaster;constructingaquadtreeof1Mnormally-distributedpointstakesaboutonesecondin4.0,ascomparedtothreesecondsin3.x.Thechangein[internal*node*structure](https://github.com/d3/d3-quadtree/blob/master/README.md#nodes)affects[*quadtree*.visit](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_visit):use*node*.lengthtodistinguishleafnodesfrominternalnodes.Forexample,toiterateoveralldatainaquadtree:```jsquadtree.visit(function(node){if(!node.length){do{console.log(node.data);}while(node=node.next)}});```There’sanew[*quadtree*.visitAfter](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_visitAfter)methodforvisitingnodesinpost-ordertraversal.Thisfeatureisusedin[d3-force](#forces-d3-force)toimplementthe[Barnes–Hutapproximation](https://en.wikipedia.org/wiki/Barnes–Hut_simulation).Youcannowremovedatafromaquadtreeusing[*quadtree*.remove](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_remove)and[*quadtree*.removeAll](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_removeAll).Whenaddingdatatoaquadtree,thequadtreewillnowexpanditsextentbyrepeateddoublingifthenewpointisoutsidetheexistingextentofthequadtree.Therearealso[*quadtree*.extent](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_extent)and[*quadtree*.cover](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_cover)methodsforexplicitlyexpandingtheextentofthequadtreeaftercreation.Quadtreessupportseveralnewutilitymethods:[*quadtree*.copy](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_copy)returnsacopyofthequadtreesharingthesamedata;[*quadtree*.data](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_data)generatesanarrayofalldatainthequadtree;[*quadtree*.size](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_size)returnsthenumberofdatapointsinthequadtree;and[*quadtree*.root](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_root)returnstherootnode,whichisusefulformanualtraversalofthequadtree.The[*quadtree*.find](https://github.com/d3/d3-quadtree/blob/master/README.md#quadtree_find)methodnowtakesanoptionalsearchradius,whichisusefulforpointer-basedselectionin[force-directedgraphs](https://bl.ocks.org/mbostock/ad70335eeef6d167bc36fd3c04378048).##[Queues(d3-queue)](https://github.com/d3/d3-queue/blob/master/README.md)FormerlyknownasQueue.jsandqueue-async,[d3.queue](https://github.com/d3/d3-queue)isnowincludedinthedefaultbundle,makingiteasytoloaddatafilesinparallel.Ithasbeenrewrittenwithfewerclosurestoimproveperformance,andtherearenowstricterchecksinplacetoguaranteewell-definedbehavior.Youcannowuseinstanceofd3.queueandinspectthequeue’sinternalprivatestate.##[RandomNumbers(d3-random)](https://github.com/d3/d3-random/blob/master/README.md)Pursuanttothegreatnamespaceflattening,therandomnumbergeneratorshavenewnames:*d3.random.normal↦[d3.randomNormal](https://github.com/d3/d3-random/blob/master/README.md#randomNormal)*d3.random.logNormal↦[d3.randomLogNormal](https://github.com/d3/d3-random/blob/master/README.md#randomLogNormal)*d3.random.bates↦[d3.randomBates](https://github.com/d3/d3-random/blob/master/README.md#randomBates)*d3.random.irwinHall↦[d3.randomIrwinHall](https://github.com/d3/d3-random/blob/master/README.md#randomIrwinHall)Therearealsonewrandomnumbergeneratorsfor[exponential](https://github.com/d3/d3-random/blob/master/README.md#randomExponential)and[uniform](https://github.com/d3/d3-random/blob/master/README.md#randomUniform)distributions.The[normal](https://github.com/d3/d3-random/blob/master/README.md#randomNormal)and[log-normal](https://github.com/d3/d3-random/blob/master/README.md#randomLogNormal)randomgeneratorshavebeenoptimized.##[Requests(d3-request)](https://github.com/d3/d3-request/blob/master/README.md)Thed3.xhrmethodhasbeenrenamedto[d3.request](https://github.com/d3/d3-request/blob/master/README.md#request).Basicauthenticationisnowsupportedusing[*request*.user](https://github.com/d3/d3-request/blob/master/README.md#request_user)and[*request*.password](https://github.com/d3/d3-request/blob/master/README.md#request_password).Youcannowconfigureatimeoutusing[*request*.timeout](https://github.com/d3/d3-request/blob/master/README.md#request_timeout).Ifanerroroccurs,thecorresponding[ProgressEvent](https://xhr.spec.whatwg.org/#interface-progressevent)oftype“error”isnowpassedtotheerrorlistener,ratherthanthe[XMLHttpRequest](https://xhr.spec.whatwg.org/#interface-xmlhttprequest).Likewise,theProgressEventispassedtoprogresseventlisteners,ratherthanusing[d3.event](https://github.com/d3/d3-selection/blob/master/README.md#event).If[d3.xml](https://github.com/d3/d3-request/blob/master/README.md#xml)encountersanerrorparsingXML,thiserrorisnowreportedtoerrorlistenersratherthanreturninganullresponse.The[d3.request](https://github.com/d3/d3-request/blob/master/README.md#request),[d3.text](https://github.com/d3/d3-request/blob/master/README.md#text)and[d3.xml](https://github.com/d3/d3-request/blob/master/README.md#xml)methodsnolongertakeanoptionalmimetypeasthesecondargument;use[*request*.mimeType](https://github.com/d3/d3-request/blob/master/README.md#request_mimeType)instead.Forexample:```jsd3.xml("file.svg").mimeType("image/svg+xml").get(function(error,svg){…});```Withtheexceptionof[d3.html](https://github.com/d3/d3-request/blob/master/README.md#html)and[d3.xml](https://github.com/d3/d3-request/blob/master/README.md#xml),Nodeisnowsupportedvia[node-XMLHttpRequest](https://github.com/driverdan/node-XMLHttpRequest).##[Scales(d3-scale)](https://github.com/d3/d3-scale/blob/master/README.md)Pursuanttothegreatnamespaceflattening:*d3.scale.linear↦[d3.scaleLinear](https://github.com/d3/d3-scale/blob/master/README.md#scaleLinear)*d3.scale.sqrt↦[d3.scaleSqrt](https://github.com/d3/d3-scale/blob/master/README.md#scaleSqrt)*d3.scale.pow↦[d3.scalePow](https://github.com/d3/d3-scale/blob/master/README.md#scalePow)*d3.scale.log↦[d3.scaleLog](https://github.com/d3/d3-scale/blob/master/README.md#scaleLog)*d3.scale.quantize↦[d3.scaleQuantize](https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantize)*d3.scale.threshold↦[d3.scaleThreshold](https://github.com/d3/d3-scale/blob/master/README.md#scaleThreshold)*d3.scale.quantile↦[d3.scaleQuantile](https://github.com/d3/d3-scale/blob/master/README.md#scaleQuantile)*d3.scale.identity↦[d3.scaleIdentity](https://github.com/d3/d3-scale/blob/master/README.md#scaleIdentity)*d3.scale.ordinal↦[d3.scaleOrdinal](https://github.com/d3/d3-scale/blob/master/README.md#scaleOrdinal)*d3.time.scale↦[d3.scaleTime](https://github.com/d3/d3-scale/blob/master/README.md#scaleTime)*d3.time.scale.utc↦[d3.scaleUtc](https://github.com/d3/d3-scale/blob/master/README.md#scaleUtc)Scalesnowgenerateticksinthesameorderasthedomain:ifyouhaveadescendingdomain,younowgetdescendingticks.Thischangeaffectstheorderoftickelementsgeneratedby[axes](#axes-d3-axis).Forexample:```jsd3.scaleLinear().domain([10,0]).ticks(5);//[10,8,6,4,2,0]```[Logtickformatting](https://github.com/d3/d3-scale/blob/master/README.md#log_tickFormat)nowassumesadefault*count*often,notInfinity,ifnotspecified.Logscaleswithdomainsthatspanmanypowers(suchasfrom1e+3to1e+29)nowreturnonlyone[tick](https://github.com/d3/d3-scale/blob/master/README.md#log_ticks)perpowerratherthanreturning*base*ticksperpower.Non-linearquantitativescalesareslightlymoreaccurate.Youcannowcontrolwhetheranordinalscale’sdomainisimplicitlyextendedwhenthescaleispassedavaluethatisnotalreadyinitsdomain.Bydefault,[*ordinal*.unknown](https://github.com/d3/d3-scale/blob/master/README.md#ordinal_unknown)is[d3.scaleImplicit](https://github.com/d3/d3-scale/blob/master/README.md#scaleImplicit),causingunknownvaluestobeaddedtothedomain:```jsvarx=d3.scaleOrdinal().domain([0,1]).range(["red","green","blue"]);x.domain();//[0,1]x(2);//"blue"x.domain();//[0,1,2]```Bysetting*ordinal*.unknown,youinsteaddefinetheoutputvalueforunknowninputs.Thisisparticularlyusefulforchoroplethmapswhereyouwanttoassignacolortomissingdata.```jsvarx=d3.scaleOrdinal().domain([0,1]).range(["red","green","blue"]).unknown(undefined);x.domain();//[0,1]x(2);//undefinedx.domain();//[0,1]```The*ordinal*.rangeBandsand*ordinal*.rangeRoundBandsmethodshavebeenreplacedwithanewsubclassofordinalscale:[bandscales](https://github.com/d3/d3-scale/blob/master/README.md#band-scales).Thefollowingcodein3.x:```jsvarx=d3.scale.ordinal().domain(["a","b","c"]).rangeBands([0,width]);```Isequivalenttothisin4.0:```jsvarx=d3.scaleBand().domain(["a","b","c"]).range([0,width]);```Thenew[*band*.padding](https://github.com/d3/d3-scale/blob/master/README.md#band_padding),[*band*.paddingInner](https://github.com/d3/d3-scale/blob/master/README.md#band_paddingInner)and[*band*.paddingOuter](https://github.com/d3/d3-scale/blob/master/README.md#band_paddingOuter)methodsreplacetheoptionalargumentsto*ordinal*.rangeBands.Thenew[*band*.bandwidth](https://github.com/d3/d3-scale/blob/master/README.md#band_bandwidth)and[*band*.step](https://github.com/d3/d3-scale/blob/master/README.md#band_step)methodsreplace*ordinal*.rangeBand.There’salsoanew[*band*.align](https://github.com/d3/d3-scale/blob/master/README.md#band_align)methodwhichyoucanusetocontrolhowtheextraspaceoutsidethebandsisdistributed,saytoshiftcolumnsclosertothe*y*-axis.Similarly,the*ordinal*.rangePointsand*ordinal*.rangeRoundPointsmethodshavebeenreplacedwithanewsubclassofordinalscale:[pointscales](https://github.com/d3/d3-scale/blob/master/README.md#point-scales).Thefollowingcodein3.x:```jsvarx=d3.scale.ordinal().domain(["a","b","c"]).rangePoints([0,width]);```Isequivalenttothisin4.0:```jsvarx=d3.scalePoint().domain(["a","b","c"]).range([0,width]);```Thenew[*point*.padding](https://github.com/d3/d3-scale/blob/master/README.md#point_padding)methodreplacestheoptional*padding*argumentto*ordinal*.rangePoints.Like*ordinal*.rangeBandwith*ordinal*.rangePoints,the[*point*.bandwidth](https://github.com/d3/d3-scale/blob/master/README.md#point_bandwidth)methodalwaysreturnszero;anew[*point*.step](https://github.com/d3/d3-scale/blob/master/README.md#point_step)methodreturnstheintervalbetweenadjacentpoints.The[ordinalscaleconstructor](https://github.com/d3/d3-scale/blob/master/README.md#ordinal-scales)nowtakesanoptional*range*forashorteralternativeto[*ordinal*.range](https://github.com/d3/d3-scale/blob/master/README.md#ordinal_range).Thisisespeciallyusefulnowthatthecategoricalcolorscaleshavebeenchangedtosimplearraysofcolorsratherthanspecializedordinalscaleconstructors:*d3.scale.category10↦[d3.schemeCategory10](https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory10)*d3.scale.category20↦[d3.schemeCategory20](https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory20)*d3.scale.category20b↦[d3.schemeCategory20b](https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory20b)*d3.scale.category20c↦[d3.schemeCategory20c](https://github.com/d3/d3-scale/blob/master/README.md#schemeCategory20c)Thefollowingcodein3.x:```jsvarcolor=d3.scale.category10();```Isequivalenttothisin4.0:```jsvarcolor=d3.scaleOrdinal(d3.schemeCategory10);```[Sequentialscales](https://github.com/d3/d3-scale/blob/master/README.md#scaleSequential),areanewclassofscaleswithafixedoutput[interpolator](https://github.com/d3/d3-scale/blob/master/README.md#sequential_interpolator)insteadofa[range](https://github.com/d3/d3-scale/blob/master/README.md#continuous_range).Typicallythesescalesareusedtoimplementcontinuoussequentialordivergingcolorschemes.InspiredbyMatplotlib’snew[perceptually-motivedcolormaps](https://bids.github.io/colormap/),4.0nowfeatures[viridis](https://github.com/d3/d3-scale/blob/master/README.md#interpolateViridis),[inferno](https://github.com/d3/d3-scale/blob/master/README.md#interpolateInferno),[magma](https://github.com/d3/d3-scale/blob/master/README.md#interpolateMagma),[plasma](https://github.com/d3/d3-scale/blob/master/README.md#interpolatePlasma)interpolatorsforusewithsequentialscales.Using[d3.quantize](https://github.com/d3/d3-interpolate/blob/master/README.md#quantize),theseinterpolatorscanalsobeappliedto[quantile](https://github.com/d3/d3-scale/blob/master/README.md#quantile-scales),[quantize](https://github.com/d3/d3-scale/blob/master/README.md#quantize-scales)and[threshold](https://github.com/d3/d3-scale/blob/master/README.md#threshold-scales)scales.[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/viridis.png"width="100%"height="40"alt="viridis">](https://github.com/d3/d3-scale/blob/master/README.md#interpolateViridis)[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/inferno.png"width="100%"height="40"alt="inferno">](https://github.com/d3/d3-scale/blob/master/README.md#interpolateInferno)[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/magma.png"width="100%"height="40"alt="magma">](https://github.com/d3/d3-scale/blob/master/README.md#interpolateMagma)[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/plasma.png"width="100%"height="40"alt="plasma">](https://github.com/d3/d3-scale/blob/master/README.md#interpolatePlasma)4.0alsoshipsnewCubehelixschemes,including[DaveGreen’sdefault](https://github.com/d3/d3-scale/blob/master/README.md#interpolateCubehelixDefault)anda[cyclicalrainbow](https://github.com/d3/d3-scale/blob/master/README.md#interpolateRainbow)inspiredby[MatteoNiccoli](https://mycarta.wordpress.com/2013/02/21/perceptual-rainbow-palette-the-method/):[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/cubehelix.png"width="100%"height="40"alt="cubehelix">](https://github.com/d3/d3-scale/blob/master/README.md#interpolateCubehelixDefault)[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/rainbow.png"width="100%"height="40"alt="rainbow">](https://github.com/d3/d3-scale/blob/master/README.md#interpolateRainbow)[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/warm.png"width="100%"height="40"alt="warm">](https://github.com/d3/d3-scale/blob/master/README.md#interpolateWarm)[<imgsrc="https://raw.githubusercontent.com/d3/d3-scale/v1.0.0/img/cool.png"width="100%"height="40"alt="cool">](https://github.com/d3/d3-scale/blob/master/README.md#interpolateCool)Forevenmoresequentialandcategoricalcolorschemes,see[d3-scale-chromatic](https://github.com/d3/d3-scale-chromatic).Foranintroductiontoscales,see[Introducingd3-scale](https://medium.com/@mbostock/introducing-d3-scale-61980c51545f).##[Selections(d3-selection)](https://github.com/d3/d3-selection/blob/master/README.md)SelectionsnolongersubclassArrayusing[prototypechaininjection](http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection);theyarenowplainobjects,improvingperformance.Theinternalfields(*selection*.\_groups,*selection*.\_parents)areprivate;pleaseusethedocumentedpublicAPItomanipulateselections.Thenew[*selection*.nodes](https://github.com/d3/d3-selection/blob/master/README.md#selection_nodes)methodgeneratesanarrayofallnodesinaselection.Selectionsarenowimmutable:theelementsandparentsinaselectionneverchange.(Theelements’attributesandcontentwillofcoursestillbemodified!)The[*selection*.sort](https://github.com/d3/d3-selection/blob/master/README.md#selection_sort)and[*selection*.data](https://github.com/d3/d3-selection/blob/master/README.md#selection_data)methodsnowreturnnewselectionsratherthanmodifyingtheselectionin-place.Inaddition,[*selection*.append](https://github.com/d3/d3-selection/blob/master/README.md#selection_append)nolongermergesenteringnodesintotheupdateselection;use[*selection*.merge](https://github.com/d3/d3-selection/blob/master/README.md#selection_merge)tocombineenterandupdateafteradatajoin.Forexample,thefollowing[generalupdatepattern](https://bl.ocks.org/mbostock/a8a5baa4c4a470cda598)in3.x:```jsvarcircle=svg.selectAll("circle").data(data)//UPDATE.style("fill","blue");circle.exit().remove();//EXITcircle.enter().append("circle")//ENTER;modifiesUPDATE!🌶.style("fill","green");circle//ENTER+UPDATE.style("stroke","black");```Wouldberewrittenin4.0as:```jsvarcircle=svg.selectAll("circle").data(data)//UPDATE.style("fill","blue");circle.exit().remove();//EXITcircle.enter().append("circle")//ENTER.style("fill","green").merge(circle)//ENTER+UPDATE.style("stroke","black");```Thischangeisdiscussedfurtherin[WhatMakesSoftwareGood](https://medium.com/@mbostock/what-makes-software-good-943557f8a488).In3.x,the[*selection*.enter](https://github.com/d3/d3-selection/blob/master/README.md#selection_enter)and[*selection*.exit](https://github.com/d3/d3-selection/blob/master/README.md#selection_exit)methodswereundefineduntilyoucalled*selection*.data,resultinginaTypeErrorifyouattemptedtoaccessthem.In4.0,nowtheysimplyreturntheemptyselectioniftheselectionhasnotbeenjoinedtodata.In3.x,[*selection*.append](https://github.com/d3/d3-selection/blob/master/README.md#selection_append)wouldalwaysappendthenewelementasthelastchildofitsparent.Alittle-knowntrickwastouse[*selection*.insert](https://github.com/d3/d3-selection/blob/master/README.md#selection_insert)withoutspecifyinga*before*selectorwhenenteringnodes,causingtheenteringnodestobeinsertedbeforethefollowingelementintheupdateselection.In4.0,thisisnowthedefaultbehaviorof*selection*.append;ifyoudonotspecifya*before*selectorto*selection*.insert,theinsertedelementisappendedasthelastchild.Thischangemakesthegeneralupdatepatternpreservetherelativeorderofelementsanddata.Forexample,giventhefollowingDOM:```html<div>a</div><div>b</div><div>f</div>```Andthefollowingcode:```jsvardiv=d3.select("body").selectAll("div").data(["a","b","c","d","e","f"],function(d){returnd||this.textContent;});div.enter().append("div").text(function(d){returnd;});```TheresultingDOMwillbe:```html<div>a</div><div>b</div><div>c</div><div>d</div><div>e</div><div>f</div>```Thus,theentering*c*,*d*and*e*areinsertedbefore*f*,since*f*isthefollowingelementintheupdateselection.Althoughthisbehaviorissufficienttopreserveorderifthenewdata’sorderisstable,ifthedatachangesorder,youmuststilluse[*selection*.order](https://github.com/d3/d3-selection/blob/master/README.md#selection_order)toreorderelements.Thereisnowonlyoneclassofselection.3.ximplementedenterselectionsusingaspecialclasswithdifferentbehaviorfor*enter*.appendand*enter*.select;aconsequenceofthisdesignwasthatenterselectionsin3.xlacked[certainmethods](https://github.com/d3/d3/issues/2043).In4.0,enterselectionsaresimplynormalselections;theyhavethesamemethodsandthesamebehavior.Placeholder[enternodes](https://github.com/d3/d3-selection/blob/master/src/selection/enter.js)nowimplement[*node*.appendChild](https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild),[*node*.insertBefore](https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore),[*node*.querySelector](https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelector),and[*node*.querySelectorAll](https://developer.mozilla.org/en-US/docs/Web/API/Element/querySelectorAll).The[*selection*.data](https://github.com/d3/d3-selection/blob/master/README.md#selection_data)methodhasbeenchangedslightlywithrespecttoduplicatekeys.In3.x,ifmultipledatahadthesamekey,theduplicatedatawouldbeignoredandnotincludedinenter,updateorexit;in4.0theduplicatedataisalwaysputintheenterselection.Inboth3.xand4.0,ifmultipleelementshavethesamekey,theduplicateelementsareputintheexitselection.Thus,4.0’sbehaviorisnowsymmetricforenterandexit,andthegeneralupdatepatternwillnowproduceaDOMthatmatchesthedataevenifthereareduplicatekeys.Selectionshaveseveralnewmethods!Use[*selection*.raise](https://github.com/d3/d3-selection/blob/master/README.md#selection_raise)tomovetheselectedelementstothefrontoftheirsiblings,sothattheyaredrawnontop;use[*selection*.lower](https://github.com/d3/d3-selection/blob/master/README.md#selection_lower)tomovethemtotheback.Use[*selection*.dispatch](https://github.com/d3/d3-selection/blob/master/README.md#selection_dispatch)todispatcha[customevent](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent)toeventlisteners.Whencalledingettermode,[*selection*.data](https://github.com/d3/d3-selection/blob/master/README.md#selection_data)nowreturnsthedataforallelementsintheselection,ratherthanjustthedataforthefirstgroupofelements.The[*selection*.call](https://github.com/d3/d3-selection/blob/master/README.md#selection_call)methodnolongersetsthe`this`contextwheninvokingthespecifiedfunction;the*selection*ispassedasthefirstargumenttothefunction,sousethat.The[*selection*.on](https://github.com/d3/d3-selection/blob/master/README.md#selection_on)methodnowacceptsmultiplewhitespace-separatedtypenames,soyoucanaddorremovemultiplelistenerssimultaneously.Forexample:```jsselection.on("mousedowntouchstart",function(){console.log(d3.event.type);});```Theargumentspassedtocallbackfunctionshaschangedslightlyin4.0tobemoreconsistent.Thestandardargumentsaretheelement’sdatum(*d*),theelement’sindex(*i*),andtheelement’sgroup(*nodes*),with*this*astheelement.Theslightexceptiontothisconventionis*selection*.data,whichisevaluatedforeachgroupratherthaneachelement;itispassedthegroup’sparentdatum(*d*),thegroupindex(*i*),andtheselection’sparents(*parents*),with*this*asthegroup’sparent.Thenew[d3.local](https://github.com/d3/d3-selection/blob/master/README.md#local-variables)providesamechanismfordefining[localvariables](https://bl.ocks.org/mbostock/e1192fe405703d8321a5187350910e08):statethatisboundtoDOMelements,andavailabletoanydescendantelement.Thiscanbeaconvenientalternativetousing[*selection*.each](https://github.com/d3/d3-selection/blob/master/README.md#selection_each)orstoringlocalstateindata.Thed3.ns.prefixnamespaceprefixmaphasbeenrenamedto[d3.namespaces](https://github.com/d3/d3-selection/blob/master/README.md#namespaces),andthed3.ns.qualifymethodhasbeenrenamedto[d3.namespace](https://github.com/d3/d3-selection/blob/master/README.md#namespace).Severalnewlow-levelmethodsarenowavailable,aswell.[d3.matcher](https://github.com/d3/d3-selection/blob/master/README.md#matcher)isusedinternallyby[*selection*.filter](https://github.com/d3/d3-selection/blob/master/README.md#selection_filter);[d3.selector](https://github.com/d3/d3-selection/blob/master/README.md#selector)isusedby[*selection*.select](https://github.com/d3/d3-selection/blob/master/README.md#selection_select);[d3.selectorAll](https://github.com/d3/d3-selection/blob/master/README.md#selectorAll)isusedby[*selection*.selectAll](https://github.com/d3/d3-selection/blob/master/README.md#selection_selectAll);[d3.creator](https://github.com/d3/d3-selection/blob/master/README.md#creator)isusedby[*selection*.append](https://github.com/d3/d3-selection/blob/master/README.md#selection_append)and[*selection*.insert](https://github.com/d3/d3-selection/blob/master/README.md#selection_insert).Thenew[d3.window](https://github.com/d3/d3-selection/blob/master/README.md#window)returnstheownerwindowforagivenelement,windowordocument.Thenew[d3.customEvent](https://github.com/d3/d3-selection/blob/master/README.md#customEvent)temporarilysets[d3.event](https://github.com/d3/d3-selection/blob/master/README.md#event)whileinvokingafunction,allowingyoutoimplementcontrolswhichdispatchcustomevents;thisisusedby[d3-drag](https://github.com/d3/d3-drag),[d3-zoom](https://github.com/d3/d3-zoom)and[d3-brush](https://github.com/d3/d3-brush).Forthesakeofparsimony,themulti-valuemethods—whereyoupassanobjecttosetmultipleattributes,stylesorpropertiessimultaneously—havebeenextractedto[d3-selection-multi](https://github.com/d3/d3-selection-multi)andarenolongerpartofthedefaultbundle.Themulti-valuemapmethodshavealsobeenrenamedtopluralformtoreduceoverload:[*selection*.attrs](https://github.com/d3/d3-selection-multi/blob/master/README.md#selection_attrs),[*selection*.styles](https://github.com/d3/d3-selection-multi/blob/master/README.md#selection_styles)and[*selection*.properties](https://github.com/d3/d3-selection-multi/blob/master/README.md#selection_properties).##[Shapes(d3-shape)](https://github.com/d3/d3-shape/blob/master/README.md)Pursuanttothegreatnamespaceflattening:*d3.svg.line↦[d3.line](https://github.com/d3/d3-shape/blob/master/README.md#lines)*d3.svg.line.radial↦[d3.radialLine](https://github.com/d3/d3-shape/blob/master/README.md#radialLine)*d3.svg.area↦[d3.area](https://github.com/d3/d3-shape/blob/master/README.md#areas)*d3.svg.area.radial↦[d3.radialArea](https://github.com/d3/d3-shape/blob/master/README.md#radialArea)*d3.svg.arc↦[d3.arc](https://github.com/d3/d3-shape/blob/master/README.md#arcs)*d3.svg.symbol↦[d3.symbol](https://github.com/d3/d3-shape/blob/master/README.md#symbols)*d3.svg.symbolTypes↦[d3.symbolTypes](https://github.com/d3/d3-shape/blob/master/README.md#symbolTypes)*d3.layout.pie↦[d3.pie](https://github.com/d3/d3-shape/blob/master/README.md#pies)*d3.layout.stack↦[d3.stack](https://github.com/d3/d3-shape/blob/master/README.md#stacks)*d3.svg.diagonal↦REMOVED(see[d3/d3-shape#27](https://github.com/d3/d3-shape/issues/27))*d3.svg.diagonal.radial↦REMOVEDShapesarenolongerlimitedtoSVG;theycannowrendertoCanvas!Shapegeneratorsnowsupportanoptional*context*:givena[CanvasRenderingContext2D](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D),youcanrenderashapeasacanvaspathtobefilledorstroked.Forexample,a[canvaspiechart](https://bl.ocks.org/mbostock/8878e7fd82034f1d63cf)mightuseanarcgenerator:```jsvararc=d3.arc().outerRadius(radius-10).innerRadius(0).context(context);```Torenderanarcforagivendatum*d*:```jscontext.beginPath();arc(d);context.fill();```See[*line*.context](https://github.com/d3/d3-shape/blob/master/README.md#line_context),[*area*.context](https://github.com/d3/d3-shape/blob/master/README.md#area_context)and[*arc*.context](https://github.com/d3/d3-shape/blob/master/README.md#arc_context)formore.Underthehood,shapesuse[d3-path](#paths-d3-path)toserializecanvaspathmethodstoSVGpathdatawhenthecontextisnull;thus,shapesareoptimizedforrenderingtocanvas.Youcanalsonowderivelinesfromareas.Thelinesharesmostofthesameaccessors,suchas[*line*.defined](https://github.com/d3/d3-shape/blob/master/README.md#line_defined)and[*line*.curve](https://github.com/d3/d3-shape/blob/master/README.md#line_curve),withtheareafromwhichitisderived.Forexample,torenderthetoplineofanarea,use[*area*.lineY1](https://github.com/d3/d3-shape/blob/master/README.md#area_lineY1);forthebaseline,use[*area*.lineY0](https://github.com/d3/d3-shape/blob/master/README.md#area_lineY0).4.0introducesanewcurveAPIforspecifyinghowlineandareashapesinterpolatebetweendatapoints.The*line*.interpolateand*area*.interpolatemethodshavebeenreplacedwith[*line*.curve](https://github.com/d3/d3-shape/blob/master/README.md#line_curve)and[*area*.curve](https://github.com/d3/d3-shape/blob/master/README.md#area_curve).Curvesareimplementedusingthe[curveinterface](https://github.com/d3/d3-shape/blob/master/README.md#custom-curves)ratherthanasafunctionthatreturnsanSVGpathdatastring;thisallowscurvestorendertoeitherSVGorCanvas.Inaddition,*line*.curveand*area*.curvenowtakeafunctionwhichinstantiatesacurveforagiven*context*,ratherthanastring.Thefulllistofequivalents:*linear↦[d3.curveLinear](https://github.com/d3/d3-shape/blob/master/README.md#curveLinear)*linear-closed↦[d3.curveLinearClosed](https://github.com/d3/d3-shape/blob/master/README.md#curveLinearClosed)*step↦[d3.curveStep](https://github.com/d3/d3-shape/blob/master/README.md#curveStep)*step-before↦[d3.curveStepBefore](https://github.com/d3/d3-shape/blob/master/README.md#curveStepBefore)*step-after↦[d3.curveStepAfter](https://github.com/d3/d3-shape/blob/master/README.md#curveStepAfter)*basis↦[d3.curveBasis](https://github.com/d3/d3-shape/blob/master/README.md#curveBasis)*basis-open↦[d3.curveBasisOpen](https://github.com/d3/d3-shape/blob/master/README.md#curveBasisOpen)*basis-closed↦[d3.curveBasisClosed](https://github.com/d3/d3-shape/blob/master/README.md#curveBasisClosed)*bundle↦[d3.curveBundle](https://github.com/d3/d3-shape/blob/master/README.md#curveBundle)*cardinal↦[d3.curveCardinal](https://github.com/d3/d3-shape/blob/master/README.md#curveCardinal)*cardinal-open↦[d3.curveCardinalOpen](https://github.com/d3/d3-shape/blob/master/README.md#curveCardinalOpen)*cardinal-closed↦[d3.curveCardinalClosed](https://github.com/d3/d3-shape/blob/master/README.md#curveCardinalClosed)*monotone↦[d3.curveMonotoneX](https://github.com/d3/d3-shape/blob/master/README.md#curveMonotoneX)Butthat’snotall!4.0nowprovidesparameterizedCatmull–Romsplinesasproposedby[Yuksel*etal.*](http://www.cemyuksel.com/research/catmullrom_param/).Theseareavailableas[d3.curveCatmullRom](https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRom),[d3.curveCatmullRomClosed](https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRomClosed)and[d3.curveCatmullRomOpen](https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRomOpen).<imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/catmullRom.png"width="888"height="240"alt="catmullRom"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/catmullRomOpen.png"width="888"height="240"alt="catmullRomOpen"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/catmullRomClosed.png"width="888"height="330"alt="catmullRomClosed">Eachcurvetypecandefineitsownnamedparameters,replacing*line*.tensionand*area*.tension.Forexample,Catmull–Romsplinesareparameterizedusing[*catmullRom*.alpha](https://github.com/d3/d3-shape/blob/master/README.md#curveCatmullRom_alpha)anddefaultsto0.5,whichcorrespondstoacentripetalsplinethatavoidsself-intersectionsandovershoot.ForauniformCatmull–Romsplineinstead:```jsvarline=d3.line().curve(d3.curveCatmullRom.alpha(0));```4.0fixestheinterpretationofthecardinalspline*tension*parameter,whichisnowspecifiedas[*cardinal*.tension](https://github.com/d3/d3-shape/blob/master/README.md#curveCardinal_tension)anddefaultstozeroforauniformCatmull–Romspline;atensionofoneproducesalinearcurve.Thefirstandlastsegmentsofbasisandcardinalcurveshavealsobeenfixed!Theundocumented*interpolate*.reversefieldhasbeenremoved.Curvescandefinedifferentbehaviorfortoplinesandbaselinesbycountingthesequenceof[*curve*.lineStart](https://github.com/d3/d3-shape/blob/master/README.md#curve_lineStart)within[*curve*.areaStart](https://github.com/d3/d3-shape/blob/master/README.md#curve_areaStart).Seethe[d3.curveStepimplementation](https://github.com/d3/d3-shape/blob/master/src/curve/step.js)foranexample.4.0fixesnumerousbugsinthemonotonecurveimplementation,andintroduces[d3.curveMonotoneY](https://github.com/d3/d3-shape/blob/master/README.md#curveMonotoneY);thisisliked3.curveMonotoneX,exceptitrequiresthattheinputpointsaremonotonein*y*ratherthan*x*,suchasforavertically-orientedlinechart.Thenew[d3.curveNatural](https://github.com/d3/d3-shape/blob/master/README.md#curveNatural)producesa[naturalcubicspline](http://mathworld.wolfram.com/CubicSpline.html).Thedefault[β](https://github.com/d3/d3-shape/blob/master/README.md#bundle_beta)for[d3.curveBundle](https://github.com/d3/d3-shape/blob/master/README.md#curveBundle)isnow0.85,ratherthan0.7,matchingthevaluesusedby[Holten](https://www.win.tue.nl/vis1/home/dholten/papers/bundles_infovis.pdf).4.0alsohasamorerobustimplementationofarcpadding;see[*arc*.padAngle](https://github.com/d3/d3-shape/blob/master/README.md#arc_padAngle)and[*arc*.padRadius](https://github.com/d3/d3-shape/blob/master/README.md#arc_padRadius).4.0introducesanewsymboltypeAPI.Symboltypesarepassedto[*symbol*.type](https://github.com/d3/d3-shape/blob/master/README.md#symbol_type)inplaceofstrings.Theequivalentsare:*circle↦[d3.symbolCircle](https://github.com/d3/d3-shape/blob/master/README.md#symbolCircle)*cross↦[d3.symbolCross](https://github.com/d3/d3-shape/blob/master/README.md#symbolCross)*diamond↦[d3.symbolDiamond](https://github.com/d3/d3-shape/blob/master/README.md#symbolDiamond)*square↦[d3.symbolSquare](https://github.com/d3/d3-shape/blob/master/README.md#symbolSquare)*triangle-down↦REMOVED*triangle-up↦[d3.symbolTriangle](https://github.com/d3/d3-shape/blob/master/README.md#symbolTriangle)*ADDED↦[d3.symbolStar](https://github.com/d3/d3-shape/blob/master/README.md#symbolStar)*ADDED↦[d3.symbolWye](https://github.com/d3/d3-shape/blob/master/README.md#symbolWye)Thefullsetofsymboltypesisnow:<ahref="#symbolCircle"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/circle.png"width="100"height="100"></a><ahref="#symbolCross"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/cross.png"width="100"height="100"></a><ahref="#symbolDiamond"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/diamond.png"width="100"height="100"></a><ahref="#symbolSquare"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/square.png"width="100"height="100"></a><ahref="#symbolStar"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/star.png"width="100"height="100"></a><ahref="#symbolTriangle"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/triangle.png"width="100"height="100"><ahref="#symbolWye"><imgsrc="https://raw.githubusercontent.com/d3/d3-shape/master/img/wye.png"width="100"height="100"></a>Lastly,4.0overhaulsthestacklayoutAPI,replacingd3.layout.stackwith[d3.stack](https://github.com/d3/d3-shape/blob/master/README.md#stacks).Thestackgeneratornolongerneedsan*x*-accessor.Inaddition,theAPIhasbeensimplified:the*stack*generatornowacceptstabularinput,suchasthisarrayofobjects:```jsvardata=[{month:newDate(2015,0,1),apples:3840,bananas:1920,cherries:960,dates:400},{month:newDate(2015,1,1),apples:1600,bananas:1440,cherries:960,dates:400},{month:newDate(2015,2,1),apples:640,bananas:960,cherries:640,dates:400},{month:newDate(2015,3,1),apples:320,bananas:480,cherries:640,dates:400}];```Togeneratethestacklayout,firstdefineastackgenerator,andthenapplyittothedata:```jsvarstack=d3.stack().keys(["apples","bananas","cherries","dates"]).order(d3.stackOrderNone).offset(d3.stackOffsetNone);varseries=stack(data);```Theresultingarrayhasoneelementper*series*.Eachserieshasonepointpermonth,andeachpointhasaloweranduppervaluedefiningthebaselineandtopline:```js[[[0,3840],[0,1600],[0,640],[0,320]],//apples[[3840,5760],[1600,3040],[640,1600],[320,800]],//bananas[[5760,6720],[3040,4000],[1600,2240],[800,1440]],//cherries[[6720,7120],[4000,4400],[2240,2640],[1440,1840]],//dates]```Eachseriesinthentypicallypassedtoan[areagenerator](https://github.com/d3/d3-shape/blob/master/README.md#areas)torenderanareachart,orusedtoconstructrectanglesforabarchart.Stackgeneratorsnolongermodifytheinputdata,so*stack*.outhasbeenremoved.Foranintroductiontoshapes,see[Introducingd3-shape](https://medium.com/@mbostock/introducing-d3-shape-73f8367e6d12).##[TimeFormats(d3-time-format)](https://github.com/d3/d3-time-format/blob/master/README.md)Pursuanttothegreatnamespaceflattening,theformatconstructorshavenewnames:*d3.time.format↦[d3.timeFormat](https://github.com/d3/d3-time-format/blob/master/README.md#timeFormat)*d3.time.format.utc↦[d3.utcFormat](https://github.com/d3/d3-time-format/blob/master/README.md#utcFormat)*d3.time.format.iso↦[d3.isoFormat](https://github.com/d3/d3-time-format/blob/master/README.md#isoFormat)The*format*.parsemethodhasalsobeenremovedinfavorofseparate[d3.timeParse](https://github.com/d3/d3-time-format/blob/master/README.md#timeParse),[d3.utcParse](https://github.com/d3/d3-time-format/blob/master/README.md#utcParse)and[d3.isoParse](https://github.com/d3/d3-time-format/blob/master/README.md#isoParse)parserconstructors.Thus,thiscodein3.x:```jsvarparseTime=d3.time.format("%c").parse;```Canberewrittenin4.0as:```jsvarparseTime=d3.timeParse("%c");```Themulti-scaletimeformatd3.time.format.multihasbeenreplacedby[d3.scaleTime](https://github.com/d3/d3-scale/blob/master/README.md#scaleTime)’s[tickformat](https://github.com/d3/d3-scale/blob/master/README.md#time_tickFormat).Timeformatsnowcoerceinputstodates,andtimeparserscoerceinputstostrings.The`%Z`directivenowallowsmoreflexibleparsingoftimezoneoffsets,suchas`-0700`,`-07:00`,`-07`,and`Z`.The`%p`directiveisnowparsedcorrectlywhenthelocale’speriodnameislongerthantwocharacters(*e.g.*,“a.m.”).ThedefaultU.S.Englishlocalenowuses12-hourtimeandamoreconciserepresentationofthedate.Thisalignswithlocalconventionandisconsistentwith[*date*.toLocaleString](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleString)inChrome,FirefoxandNode:```jsvarnow=newDate;d3.timeFormat("%c")(newDate);//"6/23/2016,2:01:33PM"d3.timeFormat("%x")(newDate);//"6/23/2016"d3.timeFormat("%X")(newDate);//"2:01:38PM"```Youcannowsetthedefaultlocaleusing[d3.timeFormatDefaultLocale](https://github.com/d3/d3-time-format/blob/master/README.md#timeFormatDefaultLocale)!Thelocalesarepublishedas[JSON](https://github.com/d3/d3-request/blob/master/README.md#json)to[npm](https://unpkg.com/d3-time-format/locale/).Theperformanceoftimeformattingandparsinghasbeenimproved,andtheUTCformatterandparserhaveacleanerimplementation(thatavoidstemporarilyoverridingtheDateglobal).##[TimeIntervals(d3-time)](https://github.com/d3/d3-time/blob/master/README.md)Pursuanttothegreatnamespaceflattening,thelocaltimeintervalshavebeenrenamed:*ADDED↦[d3.timeMillisecond](https://github.com/d3/d3-time/blob/master/README.md#timeMillisecond)*d3.time.second↦[d3.timeSecond](https://github.com/d3/d3-time/blob/master/README.md#timeSecond)*d3.time.minute↦[d3.timeMinute](https://github.com/d3/d3-time/blob/master/README.md#timeMinute)*d3.time.hour↦[d3.timeHour](https://github.com/d3/d3-time/blob/master/README.md#timeHour)*d3.time.day↦[d3.timeDay](https://github.com/d3/d3-time/blob/master/README.md#timeDay)*d3.time.sunday↦[d3.timeSunday](https://github.com/d3/d3-time/blob/master/README.md#timeSunday)*d3.time.monday↦[d3.timeMonday](https://github.com/d3/d3-time/blob/master/README.md#timeMonday)*d3.time.tuesday↦[d3.timeTuesday](https://github.com/d3/d3-time/blob/master/README.md#timeTuesday)*d3.time.wednesday↦[d3.timeWednesday](https://github.com/d3/d3-time/blob/master/README.md#timeWednesday)*d3.time.thursday↦[d3.timeThursday](https://github.com/d3/d3-time/blob/master/README.md#timeThursday)*d3.time.friday↦[d3.timeFriday](https://github.com/d3/d3-time/blob/master/README.md#timeFriday)*d3.time.saturday↦[d3.timeSaturday](https://github.com/d3/d3-time/blob/master/README.md#timeSaturday)*d3.time.week↦[d3.timeWeek](https://github.com/d3/d3-time/blob/master/README.md#timeWeek)*d3.time.month↦[d3.timeMonth](https://github.com/d3/d3-time/blob/master/README.md#timeMonth)*d3.time.year↦[d3.timeYear](https://github.com/d3/d3-time/blob/master/README.md#timeYear)TheUTCtimeintervalshavelikewisebeenrenamed:*ADDED↦[d3.utcMillisecond](https://github.com/d3/d3-time/blob/master/README.md#utcMillisecond)*d3.time.second.utc↦[d3.utcSecond](https://github.com/d3/d3-time/blob/master/README.md#utcSecond)*d3.time.minute.utc↦[d3.utcMinute](https://github.com/d3/d3-time/blob/master/README.md#utcMinute)*d3.time.hour.utc↦[d3.utcHour](https://github.com/d3/d3-time/blob/master/README.md#utcHour)*d3.time.day.utc↦[d3.utcDay](https://github.com/d3/d3-time/blob/master/README.md#utcDay)*d3.time.sunday.utc↦[d3.utcSunday](https://github.com/d3/d3-time/blob/master/README.md#utcSunday)*d3.time.monday.utc↦[d3.utcMonday](https://github.com/d3/d3-time/blob/master/README.md#utcMonday)*d3.time.tuesday.utc↦[d3.utcTuesday](https://github.com/d3/d3-time/blob/master/README.md#utcTuesday)*d3.time.wednesday.utc↦[d3.utcWednesday](https://github.com/d3/d3-time/blob/master/README.md#utcWednesday)*d3.time.thursday.utc↦[d3.utcThursday](https://github.com/d3/d3-time/blob/master/README.md#utcThursday)*d3.time.friday.utc↦[d3.utcFriday](https://github.com/d3/d3-time/blob/master/README.md#utcFriday)*d3.time.saturday.utc↦[d3.utcSaturday](https://github.com/d3/d3-time/blob/master/README.md#utcSaturday)*d3.time.week.utc↦[d3.utcWeek](https://github.com/d3/d3-time/blob/master/README.md#utcWeek)*d3.time.month.utc↦[d3.utcMonth](https://github.com/d3/d3-time/blob/master/README.md#utcMonth)*d3.time.year.utc↦[d3.utcYear](https://github.com/d3/d3-time/blob/master/README.md#utcYear)Thelocaltimerangealiaseshavebeenrenamed:*d3.time.seconds↦[d3.timeSeconds](https://github.com/d3/d3-time/blob/master/README.md#timeSeconds)*d3.time.minutes↦[d3.timeMinutes](https://github.com/d3/d3-time/blob/master/README.md#timeMinutes)*d3.time.hours↦[d3.timeHours](https://github.com/d3/d3-time/blob/master/README.md#timeHours)*d3.time.days↦[d3.timeDays](https://github.com/d3/d3-time/blob/master/README.md#timeDays)*d3.time.sundays↦[d3.timeSundays](https://github.com/d3/d3-time/blob/master/README.md#timeSundays)*d3.time.mondays↦[d3.timeMondays](https://github.com/d3/d3-time/blob/master/README.md#timeMondays)*d3.time.tuesdays↦[d3.timeTuesdays](https://github.com/d3/d3-time/blob/master/README.md#timeTuesdays)*d3.time.wednesdays↦[d3.timeWednesdays](https://github.com/d3/d3-time/blob/master/README.md#timeWednesdays)*d3.time.thursdays↦[d3.timeThursdays](https://github.com/d3/d3-time/blob/master/README.md#timeThursdays)*d3.time.fridays↦[d3.timeFridays](https://github.com/d3/d3-time/blob/master/README.md#timeFridays)*d3.time.saturdays↦[d3.timeSaturdays](https://github.com/d3/d3-time/blob/master/README.md#timeSaturdays)*d3.time.weeks↦[d3.timeWeeks](https://github.com/d3/d3-time/blob/master/README.md#timeWeeks)*d3.time.months↦[d3.timeMonths](https://github.com/d3/d3-time/blob/master/README.md#timeMonths)*d3.time.years↦[d3.timeYears](https://github.com/d3/d3-time/blob/master/README.md#timeYears)TheUTCtimerangealiaseshavebeenrenamed:*d3.time.seconds.utc↦[d3.utcSeconds](https://github.com/d3/d3-time/blob/master/README.md#utcSeconds)*d3.time.minutes.utc↦[d3.utcMinutes](https://github.com/d3/d3-time/blob/master/README.md#utcMinutes)*d3.time.hours.utc↦[d3.utcHours](https://github.com/d3/d3-time/blob/master/README.md#utcHours)*d3.time.days.utc↦[d3.utcDays](https://github.com/d3/d3-time/blob/master/README.md#utcDays)*d3.time.sundays.utc↦[d3.utcSundays](https://github.com/d3/d3-time/blob/master/README.md#utcSundays)*d3.time.mondays.utc↦[d3.utcMondays](https://github.com/d3/d3-time/blob/master/README.md#utcMondays)*d3.time.tuesdays.utc↦[d3.utcTuesdays](https://github.com/d3/d3-time/blob/master/README.md#utcTuesdays)*d3.time.wednesdays.utc↦[d3.utcWednesdays](https://github.com/d3/d3-time/blob/master/README.md#utcWednesdays)*d3.time.thursdays.utc↦[d3.utcThursdays](https://github.com/d3/d3-time/blob/master/README.md#utcThursdays)*d3.time.fridays.utc↦[d3.utcFridays](https://github.com/d3/d3-time/blob/master/README.md#utcFridays)*d3.time.saturdays.utc↦[d3.utcSaturdays](https://github.com/d3/d3-time/blob/master/README.md#utcSaturdays)*d3.time.weeks.utc↦[d3.utcWeeks](https://github.com/d3/d3-time/blob/master/README.md#utcWeeks)*d3.time.months.utc↦[d3.utcMonths](https://github.com/d3/d3-time/blob/master/README.md#utcMonths)*d3.time.years.utc↦[d3.utcYears](https://github.com/d3/d3-time/blob/master/README.md#utcYears)Thebehaviorof[*interval*.range](https://github.com/d3/d3-time/blob/master/README.md#interval_range)(andtheconveniencealiasessuchas[d3.timeDays](https://github.com/d3/d3-time/blob/master/README.md#timeDays))hasbeenchangedwhen*step*isgreaterthanone.Ratherthanfilteringthereturneddatesusingthefieldnumber,*interval*.rangenowbehaveslike[d3.range](https://github.com/d3/d3-array/blob/master/README.md#range):itsimplyskips,returningevery*step*thdate.Forexample,thefollowingcodein3.xreturnsonlyodddaysofthemonth:```jsd3.time.days(newDate(2016,4,28),newDate(2016,5,5),2);//[SunMay29201600:00:00GMT-0700(PDT),//TueMay31201600:00:00GMT-0700(PDT),//WedJun01201600:00:00GMT-0700(PDT),//FriJun03201600:00:00GMT-0700(PDT)]```Notethereturnedarrayofdatesdoesnotstartonthe*start*datebecauseMay28iseven.AlsonotethatMay31andJune1areonedayapart,nottwo!Thebehaviorofd3.timeDaysin4.0isprobablyclosertowhatyouexpect:```jsd3.timeDays(newDate(2016,4,28),newDate(2016,5,5),2);//[SatMay28201600:00:00GMT-0700(PDT),//MonMay30201600:00:00GMT-0700(PDT),//WedJun01201600:00:00GMT-0700(PDT),//FriJun03201600:00:00GMT-0700(PDT)]```Ifyouwantafilteredviewofatimeinterval(saytoguaranteethattwooverlappingrangesareconsistent,suchaswhengenerating[timescaleticks](https://github.com/d3/d3-scale/blob/master/README.md#time_ticks)),youcanusethenew[*interval*.every](https://github.com/d3/d3-time/blob/master/README.md#interval_every)methodoritsmoregeneralcousin[*interval*.filter](https://github.com/d3/d3-time/blob/master/README.md#interval_filter):```jsd3.timeDay.every(2).range(newDate(2016,4,28),newDate(2016,5,5));//[SunMay29201600:00:00GMT-0700(PDT),//TueMay31201600:00:00GMT-0700(PDT),//WedJun01201600:00:00GMT-0700(PDT),//FriJun03201600:00:00GMT-0700(PDT)]```Timeintervalsnowexposean[*interval*.count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)methodforcountingthenumberofintervalboundariesaftera*start*dateandbeforeorequaltoan*end*date.Thisreplacesd3.time.dayOfYearandrelatedmethodsin3.x.Forexample,thiscodein3.x:```jsvarnow=newDate;d3.time.dayOfYear(now);//165```Canberewrittenin4.0as:```jsvarnow=newDate;d3.timeDay.count(d3.timeYear(now),now);//165```Likewise,inplaceof3.x’sd3.time.weekOfYear,in4.0youwouldsay:```jsd3.timeWeek.count(d3.timeYear(now),now);//24```Thenew*interval*.countisofcoursemoregeneral.Forexample,youcanuseittocomputehour-of-weekforaheatmap:```jsd3.timeHour.count(d3.timeWeek(now),now);//64```Herearealltheequivalencesfrom3.xto4.0:*d3.time.dayOfYear↦[d3.timeDay](https://github.com/d3/d3-time/blob/master/README.md#timeDay).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.sundayOfYear↦[d3.timeSunday](https://github.com/d3/d3-time/blob/master/README.md#timeSunday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.mondayOfYear↦[d3.timeMonday](https://github.com/d3/d3-time/blob/master/README.md#timeMonday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.tuesdayOfYear↦[d3.timeTuesday](https://github.com/d3/d3-time/blob/master/README.md#timeTuesday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.wednesdayOfYear↦[d3.timeWednesday](https://github.com/d3/d3-time/blob/master/README.md#timeWednesday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.thursdayOfYear↦[d3.timeThursday](https://github.com/d3/d3-time/blob/master/README.md#timeThursday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.fridayOfYear↦[d3.timeFriday](https://github.com/d3/d3-time/blob/master/README.md#timeFriday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.saturdayOfYear↦[d3.timeSaturday](https://github.com/d3/d3-time/blob/master/README.md#timeSaturday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.weekOfYear↦[d3.timeWeek](https://github.com/d3/d3-time/blob/master/README.md#timeWeek).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.dayOfYear.utc↦[d3.utcDay](https://github.com/d3/d3-time/blob/master/README.md#utcDay).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.sundayOfYear.utc↦[d3.utcSunday](https://github.com/d3/d3-time/blob/master/README.md#utcSunday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.mondayOfYear.utc↦[d3.utcMonday](https://github.com/d3/d3-time/blob/master/README.md#utcMonday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.tuesdayOfYear.utc↦[d3.utcTuesday](https://github.com/d3/d3-time/blob/master/README.md#utcTuesday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.wednesdayOfYear.utc↦[d3.utcWednesday](https://github.com/d3/d3-time/blob/master/README.md#utcWednesday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.thursdayOfYear.utc↦[d3.utcThursday](https://github.com/d3/d3-time/blob/master/README.md#utcThursday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.fridayOfYear.utc↦[d3.utcFriday](https://github.com/d3/d3-time/blob/master/README.md#utcFriday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.saturdayOfYear.utc↦[d3.utcSaturday](https://github.com/d3/d3-time/blob/master/README.md#utcSaturday).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)*d3.time.weekOfYear.utc↦[d3.utcWeek](https://github.com/d3/d3-time/blob/master/README.md#utcWeek).[count](https://github.com/d3/d3-time/blob/master/README.md#interval_count)D34.0nowalsoletsyoudefinecustomtimeintervalsusing[d3.timeInterval](https://github.com/d3/d3-time/blob/master/README.md#timeInterval).The[d3.timeYear](https://github.com/d3/d3-time/blob/master/README.md#timeYear),[d3.utcYear](https://github.com/d3/d3-time/blob/master/README.md#utcYear),[d3.timeMillisecond](https://github.com/d3/d3-time/blob/master/README.md#timeMillisecond)and[d3.utcMillisecond](https://github.com/d3/d3-time/blob/master/README.md#utcMillisecond)intervalshaveoptimizedimplementationsof[*interval*.every](https://github.com/d3/d3-time/blob/master/README.md#interval_every),whichisnecessarytogeneratetimeticksforverylargeorverysmalldomainsefficiently.Moregenerally,theperformanceoftimeintervalshasbeenimproved,andtimeintervalsnowdoabetterjobwithrespecttodaylightsavingsinvariouslocales.##[Timers(d3-timer)](https://github.com/d3/d3-timer/blob/master/README.md)InD33.x,theonlywaytostopatimerwasforitscallbacktoreturntrue.Forexample,thistimerstopsafteronesecond:```jsd3.timer(function(elapsed){console.log(elapsed);returnelapsed>=1000;});```In4.0,use[*timer*.stop](https://github.com/d3/d3-timer/blob/master/README.md#timer_stop)instead:```jsvart=d3.timer(function(elapsed){console.log(elapsed);if(elapsed>=1000){t.stop();}});```Theprimarybenefitof*timer*.stopisthattimersarenotrequiredtoself-terminate:theycanbestoppedexternally,allowingfortheimmediateandsynchronousdisposalofassociatedresources,andtheseparationofconcerns.Theaboveisequivalentto:```jsvart=d3.timer(function(elapsed){console.log(elapsed);});d3.timeout(function(){t.stop();},1000);```Thisimprovementextendsto[d3-transition](#transitions-d3-transition):nowwhenatransitionisinterrupted,itsresourcesareimmediatelyfreedratherthanhavingtowaitfortransitiontostart.4.0alsointroducesanew[*timer*.restart](https://github.com/d3/d3-timer/blob/master/README.md#timer_restart)methodforrestartingtimers,forreplacingthecallbackofarunningtimer,orforchangingitsdelayorreferencetime.Unlike*timer*.stopfollowedby[d3.timer](https://github.com/d3/d3-timer/blob/master/README.md#timer),*timer*.restartmaintainstheinvocationpriorityofanexistingtimer:itguaranteesthattheorderofinvocationofactivetimersremainsthesame.Thed3.timer.flushmethodhasbeenrenamedto[d3.timerFlush](https://github.com/d3/d3-timer/blob/master/README.md#timerFlush).SomeusagepatternsinD33.xcouldcausethebrowsertohangwhenabackgroundpagereturnedtotheforeground.Forexample,thefollowingcodeschedulesatransitioneverysecond:```jssetInterval(function(){d3.selectAll("div").transition().call(someAnimation);//BAD},1000);```Ifsuchcoderunsinthebackgroundforhours,thousandsofqueuedtransitionswilltrytorunsimultaneouslywhenthepageisforegrounded.D34.0avoidsthishangbyfreezingtimeinthebackground:whenapageisinthebackground,timedoesnotadvance,andsonoqueueoftimersaccumulatestorunwhenthepagereturnstotheforeground.Used3.timerinsteadoftransitionstoschedulealong-runninganimation,oruse[d3.timeout](https://github.com/d3/d3-timer/blob/master/README.md#timeout)and[d3.interval](https://github.com/d3/d3-timer/blob/master/README.md#interval)inplaceofsetTimeoutandsetIntervaltopreventtransitionsfrombeingqueuedinthebackground:```jsd3.interval(function(){d3.selectAll("div").transition().call(someAnimation);//GOOD},1000);```Byfreezingtimeinthebackground,timersareeffectively“unaware”ofbeingbackgrounded.It’slikenothinghappened!4.0alsonowuseshigh-precisiontime([performance.now](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now))whereavailable;thecurrenttimeisavailableas[d3.now](https://github.com/d3/d3-timer/blob/master/README.md#now).##[Transitions(d3-transition)](https://github.com/d3/d3-transition/blob/master/README.md)The[*selection*.transition](https://github.com/d3/d3-transition/blob/master/README.md#selection_transition)methodnowtakesanoptional*transition*instancewhichcanbeusedtosynchronizeanewtransitionwithanexistingtransition.(Thischangeisdiscussedfurtherin[WhatMakesSoftwareGood?](https://medium.com/@mbostock/what-makes-software-good-943557f8a488))Forexample:```jsvart=d3.transition().duration(750).ease(d3.easeLinear);d3.selectAll(".apple").transition(t).style("fill","red");d3.selectAll(".orange").transition(t).style("fill","orange");```Transitionscreatedthiswayinherittimingfromtheclosestancestorelement,andthusaresynchronizedevenwhenthereferenced*transition*hasvariabletimingsuchasastaggereddelay.Thismethodreplacesthedeeplymagicalbehaviorof*transition*.eachin3.x;in4.0,[*transition*.each](https://github.com/d3/d3-transition/blob/master/README.md#transition_each)isidenticalto[*selection*.each](https://github.com/d3/d3-selection/blob/master/README.md#selection_each).Usethenew[*transition*.on](https://github.com/d3/d3-transition/blob/master/README.md#transition_on)methodtolistentotransitionevents.Themeaningof[*transition*.delay](https://github.com/d3/d3-transition/blob/master/README.md#transition_delay)haschangedforchainedtransitionscreatedby[*transition*.transition](https://github.com/d3/d3-transition/blob/master/README.md#transition_transition).Thespecifieddelayisnowrelativetothe*previous*transitioninthechain,ratherthanthe*first*transitioninthechain;thismakesiteasiertoinsertinterstitialpauses.Forexample:```jsd3.selectAll(".apple").transition()//Firstfadetogreen..style("fill","green").transition()//Thenred..style("fill","red").transition()//Waitonesecond.Thenbrown,andremove..delay(1000).style("fill","brown").remove();```Timeisnowfrozeninthebackground;see[d3-timer](#timers-d3-timer)formoreinformation.Whileitwaspreviouslythecasethattransitionsdidnotruninthebackground,nowtheypickupwheretheyleftoffwhenthepagereturnstotheforeground.Thisavoidspagehangsbynotschedulinganunboundednumberoftransitionsinthebackground.Ifyouwanttoscheduleaninfinitely-repeatingtransition,usetransitionevents,oruse[d3.timeout](https://github.com/d3/d3-timer/blob/master/README.md#timeout)and[d3.interval](https://github.com/d3/d3-timer/blob/master/README.md#interval)inplaceof[setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setTimeout)and[setInterval](https://developer.mozilla.org/en-US/docs/Web/API/WindowTimers/setInterval).The[*selection*.interrupt](https://github.com/d3/d3-transition/blob/master/README.md#selection_interrupt)methodnowcancelsallscheduledtransitionsontheselectedelements,inadditiontointerruptinganyactivetransition.Whentransitionsareinterrupted,anyresourcesassociatedwiththetransitionarenowreleasedimmediately,ratherthanwaitinguntilthetransitionstarts,improvingperformance.(Seealso[*timer*.stop](https://github.com/d3/d3-timer/blob/master/README.md#timer_stop).)Thenew[d3.interrupt](https://github.com/d3/d3-transition/blob/master/README.md#interrupt)methodisanalternativeto[*selection*.interrupt](https://github.com/d3/d3-transition/blob/master/README.md#selection_interrupt)forquicklyinterruptingasinglenode.Thenew[d3.active](https://github.com/d3/d3-transition/blob/master/README.md#active)methodallowsyoutoselectthecurrently-activetransitiononagiven*node*,ifany.Thisisusefulformodifyingin-progresstransitionsandforschedulinginfinitely-repeatingtransitions.Forexample,thistransitioncontinuouslyoscillatesbetweenredandblue:```jsd3.select("circle").transition().on("start",functionrepeat(){d3.active(this).style("fill","red").transition().style("fill","blue").transition().on("start",repeat);});```The[lifecycleofatransition](https://github.com/d3/d3-transition/blob/master/README.md#the-life-of-a-transition)isnowmoreformallydefinedandenforced.Forexample,attemptingtochangethedurationofarunningtransitionnowthrowsanerrorratherthansilentlyfailing.The[*transition*.remove](https://github.com/d3/d3-transition/blob/master/README.md#transition_remove)methodhasbeenfixedifmultipletransitionnamesareinuse:theelementisonlyremovedifithasnoscheduledtransitions,regardlessofname.The[*transition*.ease](https://github.com/d3/d3-transition/blob/master/README.md#transition_ease)methodnowalwaystakesan[easingfunction](#easings-d3-ease),notastring.Whenatransitionends,thetweensareinvokedonelasttimewith*t*equaltoexactly1,regardlessoftheassociatedeasingfunction.Aswith[selections](#selections-d3-selection)in4.0,alltransitioncallbackfunctionsnowreceivethestandardarguments:theelement’sdatum(*d*),theelement’sindex(*i*),andtheelement’sgroup(*nodes*),with*this*astheelement.Thisnotablyaffects[*transition*.attrTween](https://github.com/d3/d3-transition/blob/master/README.md#transition_attrTween)and[*transition*.styleTween](https://github.com/d3/d3-transition/blob/master/README.md#transition_styleTween),whichnolongerpassthe*tween*functionthecurrentattributeorstylevalueasthethirdargument.The*transition*.attrTweenand*transition*.styleTweenmethodscannowbecalledingettermodesfordebuggingortosharetweendefinitionsbetweentransitions.Homogenoustransitionsarenowoptimized!Ifallelementsinatransitionsharethesametween,interpolator,oreventlisteners,thisstateisnowsharedacrossthetransitionratherthanseparatelyallocatedforeachelement.4.0alsousesanoptimizeddefaultinterpolatorinplaceof[d3.interpolate](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolate)for[*transition*.attr](https://github.com/d3/d3-transition/blob/master/README.md#transition_attr)and[*transition*.style](https://github.com/d3/d3-transition/blob/master/README.md#transition_style).Andtransitionscannowinterpolateboth[CSS](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformCss)and[SVG](https://github.com/d3/d3-interpolate/blob/master/README.md#interpolateTransformSvg)transforms.Forreusablecomponentsthatsupporttransitions,suchas[axes](#axes-d3-axis),anew[*transition*.selection](https://github.com/d3/d3-transition/blob/master/README.md#transition_selection)methodreturnsthe[selection](#selections-d3-selection)thatcorrespondstoagiventransition.Thereisalsoanew[*transition*.merge](https://github.com/d3/d3-transition/blob/master/README.md#transition_merge)methodthatisequivalentto[*selection*.merge](https://github.com/d3/d3-selection/blob/master/README.md#selection_merge).Forthesakeofparsimony,themulti-valuemapmethodshavebeenextractedto[d3-selection-multi](https://github.com/d3/d3-selection-multi)andarenolongerpartofthedefaultbundle.Themulti-valuemapmethodshavealsobeenrenamedtopluralformtoreduceoverload:[*transition*.attrs](https://github.com/d3/d3-selection-multi/blob/master/README.md#transition_attrs)and[*transition*.styles](https://github.com/d3/d3-selection-multi/blob/master/README.md#transition_styles).##[VoronoiDiagrams(d3-voronoi)](https://github.com/d3/d3-voronoi/blob/master/README.md)Thed3.geom.voronoimethodhasbeenrenamedto[d3.voronoi](https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi),andthe*voronoi*.clipExtentmethodhasbeenrenamedto[*voronoi*.extent](https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_extent).Theundocumented*polygon*.pointpropertyin3.x,whichistheelementintheinput*data*correspondingtothepolygon,hasbeenrenamedto*polygon*.data.Calling[*voronoi*](https://github.com/d3/d3-voronoi/blob/master/README.md#_voronoi)nowreturnsthefull[Voronoidiagram](https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi-diagrams),whichincludestopologicalinformation:eachVoronoiedgeexposes*edge*.leftand*edge*.rightspecifyingthesitesoneithersideoftheedge,andeachVoronoicellisdefinedasanarrayoftheseedgesandacorrespondingsite.TheVoronoidiagramcanbeusedtoefficientlycomputeboththeVoronoiandDelaunaytessellationsforasetofpoints:[*diagram*.polygons](https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_polygons),[*diagram*.links](https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_links),and[*diagram*.triangles](https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_triangles).ThenewtopologyisalsousefulinconjunctionwithTopoJSON;seethe[Voronoitopologyexample](https://bl.ocks.org/mbostock/cd52a201d7694eb9d890).The[*voronoi*.polygons](https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_polygons)and[*diagram*.polygons](https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_polygons)nowrequirean[extent](https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_extent);thereisnolongeranimplicitextentof±1e6.The[*voronoi*.links](https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_links),[*voronoi*.triangles](https://github.com/d3/d3-voronoi/blob/master/README.md#voronoi_triangles),[*diagram*.links](https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_links)and[*diagram*.triangles](https://github.com/d3/d3-voronoi/blob/master/README.md#diagram_triangles)arenowaffectedbytheclipextent:astheDelaunayiscomputedasthedualoftheVoronoi,twositesareonlylinkediftheclippedcellsaretouching.TocomputetheDelaunaytriangulationwithoutrespecttoclipping,settheextenttonull.TheVoronoigeneratorfinallyhaswell-definedbehaviorforcoincidentvertices:thefirstofasetofcoincidentpointshasadefinedcell,whilethesubsequentduplicatepointshavenullcells.Thereturnedarrayofpolygonsissparse,sobyusing*array*.forEachor*array*.map,youcaneasilyskipundefinedcells.TheVoronoigeneratoralsonowcorrectlyhandlesthecasewherenocelledgesintersecttheextent.##[Zooming(d3-zoom)](https://github.com/d3/d3-zoom/blob/master/README.md)Thezoombehaviord3.behavior.zoomhasbeenrenamedtod3.zoom.Zoombehaviorsnolongerstoretheactivezoomtransform(*i.e.*,thevisibleregion;thescaleandtranslate)internally.Thezoomtransformisnowstoredonanyelementstowhichthezoombehaviorhasbeenapplied.Thezoomtransformisavailableas*event*.transformwithinazoomeventorbycalling[d3.zoomTransform](https://github.com/d3/d3-zoom/blob/master/README.md#zoomTransform)onagiven*element*.Tozoomprogrammatically,use[*zoom*.transform](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_transform)withagiven[selection](#selections-d3-selection)or[transition](#transitions-d3-transition);seethe[zoomtransitionsexample](https://bl.ocks.org/mbostock/b783fbb2e673561d214e09c7fb5cedee).The*zoom*.eventmethodhasbeenremoved.Tomakeprogrammaticzoomingeasier,thereareseveralnewconveniencemethodsontopof*zoom*.transform:[*zoom*.translateBy](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_translateBy),[*zoom*.scaleBy](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_scaleBy)and[*zoom*.scaleTo](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_scaleTo).ThereisalsoanewAPIfordescribing[zoomtransforms](https://github.com/d3/d3-zoom/blob/master/README.md#zoom-transforms).Zoombehaviorsarenolongerdependenton[scales](#scales-d3-scale),butyoucanuse[*transform*.rescaleX](https://github.com/d3/d3-zoom/blob/master/README.md#transform_rescaleX),[*transform*.rescaleY](https://github.com/d3/d3-zoom/blob/master/README.md#transform_rescaleY),[*transform*.invertX](https://github.com/d3/d3-zoom/blob/master/README.md#transform_invertX)or[*transform*.invertY](https://github.com/d3/d3-zoom/blob/master/README.md#transform_invertY)totransformascale’sdomain.3.x’s*event*.scaleisreplacedwith*event*.transform.k,and*event*.translateisreplacedwith*event*.transform.xand*event*.transform.y.The*zoom*.centermethodhasbeenremovedinfavorofprogrammaticzooming.Thezoombehaviorfinallysupportssimpleconstraintsonpanning!Thenew[*zoom*.translateExtent](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_translateExtent)letsyoudefinetheviewableextentoftheworld:thecurrently-visibleextent(theextentoftheviewport,asdefinedby[*zoom*.extent](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_extent))isalwayscontainedwithinthetranslateextent.The*zoom*.sizemethodhasbeenreplacedby*zoom*.extent,andthedefaultbehaviorisnowsmarter:itdefaultstotheextentofthezoombehavior’sownerelement,ratherthanbeinghardcodedto960×500.(Thisalsoimprovesthedefaultpathchosenduringsmoothzoomtransitions!)Thezoombehavior’sinteractionhasalsoimproved.Itnowcorrectlyhandlesconcurrentwheelinganddragging,aswellasconcurrenttouchingandmousing.Thezoombehaviornowignoreswheeleventsatthelimitsofitsscaleextent,allowingyoutoscrollpastazoomablearea.The*zoomstart*and*zoomend*eventshavebeenrenamed*start*and*end*.Bydefault,zoombehaviorsnowignoreright-clicksintendedforthecontextmenu;use[*zoom*.filter](https://github.com/d3/d3-zoom/blob/master/README.md#zoom_filter)tocontrolwhicheventsareignored.ThezoombehavioralsoignoresemulatedmouseeventsoniOS.Thezoombehaviornowconsumeshandledevents,makingiteasiertocombinewithotherinteractivebehaviorssuchas[dragging](#dragging-d3-drag).